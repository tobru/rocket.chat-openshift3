{"version":3,"sources":["meteor://ðŸ’»app/server/ldap.js","meteor://ðŸ’»app/server/sync.js","meteor://ðŸ’»app/server/loginHandler.js","meteor://ðŸ’»app/server/settings.js","meteor://ðŸ’»app/server/testConnection.js","meteor://ðŸ’»app/server/syncUsers.js"],"names":[],"mappings":"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","file":"/packages/rocketchat_ldap.js","sourcesContent":["/* globals LDAP:true, LDAPJS */\n/* exported LDAP */\n\nconst ldapjs = LDAPJS;\n\nconst logger = new Logger('LDAP', {\n\tsections: {\n\t\tconnection: 'Connection',\n\t\tbind: 'Bind',\n\t\tsearch: 'Search',\n\t\tauth: 'Auth'\n\t}\n});\n\nLDAP = class LDAP {\n\tconstructor() {\n\t\tconst self = this;\n\n\t\tself.ldapjs = ldapjs;\n\n\t\tself.connected = false;\n\n\t\tself.options = {\n\t\t\thost: RocketChat.settings.get('LDAP_Host'),\n\t\t\tport: RocketChat.settings.get('LDAP_Port'),\n\t\t\tencryption: RocketChat.settings.get('LDAP_Encryption'),\n\t\t\tca_cert: RocketChat.settings.get('LDAP_CA_Cert'),\n\t\t\treject_unauthorized: RocketChat.settings.get('LDAP_Reject_Unauthorized') || false,\n\t\t\tdomain_base: RocketChat.settings.get('LDAP_Domain_Base'),\n\t\t\tuse_custom_domain_search: RocketChat.settings.get('LDAP_Use_Custom_Domain_Search'),\n\t\t\tcustom_domain_search: RocketChat.settings.get('LDAP_Custom_Domain_Search'),\n\t\t\tdomain_search_user: RocketChat.settings.get('LDAP_Domain_Search_User'),\n\t\t\tdomain_search_password: RocketChat.settings.get('LDAP_Domain_Search_Password'),\n\t\t\tdomain_search_filter: RocketChat.settings.get('LDAP_Domain_Search_Filter'),\n\t\t\tdomain_search_user_id: RocketChat.settings.get('LDAP_Domain_Search_User_ID'),\n\t\t\tdomain_search_object_class: RocketChat.settings.get('LDAP_Domain_Search_Object_Class'),\n\t\t\tdomain_search_object_category: RocketChat.settings.get('LDAP_Domain_Search_Object_Category')\n\t\t};\n\n\t\tself.connectSync = Meteor.wrapAsync(self.connectAsync, self);\n\t\tself.searchAllSync = Meteor.wrapAsync(self.searchAllAsync, self);\n\t}\n\n\tconnectAsync(callback) {\n\t\tconst self = this;\n\n\t\tlogger.connection.info('Init setup');\n\n\t\tlet replied = false;\n\n\t\tconst connectionOptions = {\n\t\t\turl: `${self.options.host}:${self.options.port}`,\n\t\t\ttimeout: 1000 * 5,\n\t\t\tconnectTimeout: 1000 * 10,\n\t\t\tidleTimeout: 1000 * 10,\n\t\t\treconnect: false\n\t\t};\n\n\t\tconst tlsOptions = {\n\t\t\trejectUnauthorized: self.options.reject_unauthorized\n\t\t};\n\n\t\tif (self.options.ca_cert && self.options.ca_cert !== '') {\n\t\t\t// Split CA cert into array of strings\n\t\t\tvar chainLines = RocketChat.settings.get('LDAP_CA_Cert').split('\\n');\n\t\t\tvar cert = [];\n\t\t\tvar ca = [];\n\t\t\tchainLines.forEach(function(line) {\n\t\t\t\tcert.push(line);\n\t\t\t\tif (line.match(/-END CERTIFICATE-/)) {\n\t\t\t\t\tca.push(cert.join('\\n'));\n\t\t\t\t\tcert = [];\n\t\t\t\t}\n\t\t\t});\n\t\t\ttlsOptions.ca = ca;\n\t\t}\n\n\t\tif (self.options.encryption === 'ssl') {\n\t\t\tconnectionOptions.url = `ldaps://${connectionOptions.url}`;\n\t\t\tconnectionOptions.tlsOptions = tlsOptions;\n\t\t} else {\n\t\t\tconnectionOptions.url = `ldap://${connectionOptions.url}`;\n\t\t}\n\n\t\tlogger.connection.info('Connecting', connectionOptions.url);\n\t\tlogger.connection.debug('connectionOptions', connectionOptions);\n\n\t\tself.client = ldapjs.createClient(connectionOptions);\n\n\t\tself.bindSync = Meteor.wrapAsync(self.client.bind, self.client);\n\n\t\tself.client.on('error', function(error) {\n\t\t\tlogger.connection.error('connection', error);\n\t\t\tif (replied === false) {\n\t\t\t\treplied = true;\n\t\t\t\tcallback(error, null);\n\t\t\t}\n\t\t});\n\n\t\tif (self.options.encryption === 'tls') {\n\n\t\t\t// Set host parameter for tls.connect which is used by ldapjs starttls. This shouldn't be needed in newer nodejs versions (e.g v5.6.0).\n\t\t\t// https://github.com/RocketChat/Rocket.Chat/issues/2035\n\t\t\t// https://github.com/mcavage/node-ldapjs/issues/349\n\t\t\ttlsOptions.host = [self.options.host];\n\n\t\t\tlogger.connection.info('Starting TLS');\n\t\t\tlogger.connection.debug('tlsOptions', tlsOptions);\n\n\t\t\tself.client.starttls(tlsOptions, null, function(error, response) {\n\t\t\t\tif (error) {\n\t\t\t\t\tlogger.connection.error('TLS connection', error);\n\t\t\t\t\tif (replied === false) {\n\t\t\t\t\t\treplied = true;\n\t\t\t\t\t\tcallback(error, null);\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tlogger.connection.info('TLS connected');\n\t\t\t\tself.connected = true;\n\t\t\t\tif (replied === false) {\n\t\t\t\t\treplied = true;\n\t\t\t\t\tcallback(null, response);\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tself.client.on('connect', function(response) {\n\t\t\t\tlogger.connection.info('LDAP connected');\n\t\t\t\tself.connected = true;\n\t\t\t\tif (replied === false) {\n\t\t\t\t\treplied = true;\n\t\t\t\t\tcallback(null, response);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tsetTimeout(function() {\n\t\t\tif (replied === false) {\n\t\t\t\tlogger.connection.error('connection time out', connectionOptions.timeout);\n\t\t\t\treplied = true;\n\t\t\t\tcallback(new Error('Timeout'));\n\t\t\t}\n\t\t}, connectionOptions.timeout);\n\t}\n\n\tgetDomainBindSearch() {\n\t\tconst self = this;\n\n\t\tif (self.options.use_custom_domain_search === true) {\n\t\t\tlet custom_domain_search;\n\t\t\ttry {\n\t\t\t\tcustom_domain_search = JSON.parse(self.options.custom_domain_search);\n\t\t\t} catch (error) {\n\t\t\t\tthrow new Error('Invalid Custom Domain Search JSON');\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tfilter: custom_domain_search.filter,\n\t\t\t\tdomain_search_user: custom_domain_search.userDN || '',\n\t\t\t\tdomain_search_password: custom_domain_search.password || ''\n\t\t\t};\n\t\t}\n\n\t\tlet filter = ['(&'];\n\n\t\tif (self.options.domain_search_object_category !== '') {\n\t\t\tfilter.push(`(objectCategory=${self.options.domain_search_object_category})`);\n\t\t}\n\n\t\tif (self.options.domain_search_object_class !== '') {\n\t\t\tfilter.push(`(objectclass=${self.options.domain_search_object_class})`);\n\t\t}\n\n\t\tif (self.options.domain_search_filter !== '') {\n\t\t\tfilter.push(`(${self.options.domain_search_filter})`);\n\t\t}\n\n\t\tconst domain_search_user_id = self.options.domain_search_user_id.split(',');\n\t\tif (domain_search_user_id.length === 1) {\n\t\t\tfilter.push(`(${domain_search_user_id[0]}=#{username})`);\n\t\t} else {\n\t\t\tfilter.push('(|');\n\t\t\tdomain_search_user_id.forEach((item) => {\n\t\t\t\tfilter.push(`(${item}=#{username})`);\n\t\t\t});\n\t\t\tfilter.push(')');\n\t\t}\n\n\t\tfilter.push(')');\n\n\t\treturn {\n\t\t\tfilter: filter.join(''),\n\t\t\tdomain_search_user: self.options.domain_search_user || '',\n\t\t\tdomain_search_password: self.options.domain_search_password || ''\n\t\t};\n\t}\n\n\tbindIfNecessary() {\n\t\tconst self = this;\n\n\t\tif (self.domainBinded === true) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst domain_search = self.getDomainBindSearch();\n\n\t\tif (domain_search.domain_search_user !== '' && domain_search.domain_search_password !== '') {\n\t\t\tlogger.bind.info('Binding admin user', domain_search.domain_search_user);\n\t\t\tself.bindSync(domain_search.domain_search_user, domain_search.domain_search_password);\n\t\t\tself.domainBinded = true;\n\t\t}\n\t}\n\n\tsearchUsersSync(username) {\n\t\tconst self = this;\n\n\t\tself.bindIfNecessary();\n\n\t\tconst domain_search = self.getDomainBindSearch();\n\n\t\tconst searchOptions = {\n\t\t\tfilter: domain_search.filter.replace(/#{username}/g, username),\n\t\t\tscope: 'sub'\n\t\t};\n\n\t\tlogger.search.info('Searching user', username);\n\t\tlogger.search.debug('searchOptions', searchOptions);\n\t\tlogger.search.debug('domain_base', self.options.domain_base);\n\n\t\treturn self.searchAllSync(self.options.domain_base, searchOptions);\n\t}\n\n\tgetUserByIdSync(id, attribute) {\n\t\tconst self = this;\n\n\t\tself.bindIfNecessary();\n\n\t\tlet Unique_Identifier_Field = RocketChat.settings.get('LDAP_Unique_Identifier_Field').split(',');\n\n\t\tlet filter;\n\n\t\tif (attribute) {\n\t\t\tfilter = new self.ldapjs.filters.EqualityFilter({\n\t\t\t\tattribute: attribute,\n\t\t\t\tvalue: new Buffer(id, 'hex')\n\t\t\t});\n\t\t} else {\n\t\t\tconst filters = [];\n\t\t\tUnique_Identifier_Field.forEach(function(item) {\n\t\t\t\tfilters.push(new self.ldapjs.filters.EqualityFilter({\n\t\t\t\t\tattribute: item,\n\t\t\t\t\tvalue: new Buffer(id, 'hex')\n\t\t\t\t}));\n\t\t\t});\n\n\t\t\tfilter = new self.ldapjs.filters.OrFilter({filters: filters});\n\t\t}\n\n\t\tconst searchOptions = {\n\t\t\tfilter: filter,\n\t\t\tscope: 'sub'\n\t\t};\n\n\t\tlogger.search.info('Searching by id', id);\n\t\tlogger.search.debug('search filter', searchOptions.filter.toString());\n\t\tlogger.search.debug('domain_base', self.options.domain_base);\n\n\t\tconst result = self.searchAllSync(self.options.domain_base, searchOptions);\n\n\t\tif (!Array.isArray(result) || result.length === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (result.length > 1) {\n\t\t\tlogger.search.error('Search by id', id, 'returned', result.length, 'records');\n\t\t}\n\n\t\treturn result[0];\n\t}\n\n\tgetUserByUsernameSync(username) {\n\t\tconst self = this;\n\n\t\tself.bindIfNecessary();\n\n\t\tconst domain_search = self.getDomainBindSearch();\n\n\t\tconst searchOptions = {\n\t\t\tfilter: domain_search.filter.replace(/#{username}/g, username),\n\t\t\tscope: 'sub'\n\t\t};\n\n\t\tlogger.search.info('Searching user', username);\n\t\tlogger.search.debug('searchOptions', searchOptions);\n\t\tlogger.search.debug('domain_base', self.options.domain_base);\n\n\t\tconst result = self.searchAllSync(self.options.domain_base, searchOptions);\n\n\t\tif (!Array.isArray(result) || result.length === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (result.length > 1) {\n\t\t\tlogger.search.error('Search by username', username, 'returned', result.length, 'records');\n\t\t}\n\n\t\treturn result[0];\n\t}\n\n\tsearchAllAsync(domain_base, options, callback) {\n\t\tconst self = this;\n\n\t\tself.client.search(domain_base, options, function(error, res) {\n\t\t\tif (error) {\n\t\t\t\tlogger.search.error(error);\n\t\t\t\tcallback(error);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tres.on('error', function(error) {\n\t\t\t\tlogger.search.error(error);\n\t\t\t\tcallback(error);\n\t\t\t\treturn;\n\t\t\t});\n\n\t\t\tconst entries = [];\n\t\t\tconst jsonEntries = [];\n\n\t\t\tres.on('searchEntry', function(entry) {\n\t\t\t\tentries.push(entry);\n\t\t\t\tjsonEntries.push(entry.json);\n\t\t\t});\n\n\t\t\tres.on('end', function(/*result*/) {\n\t\t\t\tlogger.search.info('Search result count', entries.length);\n\t\t\t\tlogger.search.debug('Search result', JSON.stringify(jsonEntries, null, 2));\n\t\t\t\tcallback(null, entries);\n\t\t\t});\n\t\t});\n\t}\n\n\tauthSync(dn, password) {\n\t\tconst self = this;\n\n\t\tlogger.auth.info('Authenticating', dn);\n\n\t\ttry {\n\t\t\tself.bindSync(dn, password);\n\t\t\tlogger.auth.info('Authenticated', dn);\n\t\t\treturn true;\n\t\t} catch (error) {\n\t\t\tlogger.auth.info('Not authenticated', dn);\n\t\t\tlogger.auth.debug('error', error);\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tdisconnect() {\n\t\tconst self = this;\n\n\t\tself.connected = false;\n\t\tlogger.connection.info('Disconecting');\n\t\tself.client.unbind();\n\t}\n};\n","/* globals slug:true, slugify, LDAP, getLdapUsername:true, getLdapUserUniqueID:true, getDataToSyncUserData:true, syncUserData:true, sync:true  */\n\nconst logger = new Logger('LDAPSync', {});\n\nslug = function slug(text) {\n\tif (RocketChat.settings.get('UTF8_Names_Slugify') !== true) {\n\t\treturn text;\n\t}\n\ttext = slugify(text, '.');\n\treturn text.replace(/[^0-9a-z-_.]/g, '');\n};\n\n\ngetLdapUsername = function getLdapUsername(ldapUser) {\n\tlet usernameField = RocketChat.settings.get('LDAP_Username_Field');\n\n\tif (usernameField.indexOf('#{') > -1) {\n\t\treturn usernameField.replace(/#{(.+?)}/g, function(match, field) {\n\t\t\treturn ldapUser.object[field];\n\t\t});\n\t}\n\n\treturn ldapUser.object[usernameField];\n};\n\n\ngetLdapUserUniqueID = function getLdapUserUniqueID(ldapUser) {\n\tlet Unique_Identifier_Field = RocketChat.settings.get('LDAP_Unique_Identifier_Field');\n\n\tif (Unique_Identifier_Field !== '') {\n\t\tUnique_Identifier_Field = Unique_Identifier_Field.replace(/\\s/g, '').split(',');\n\t} else {\n\t\tUnique_Identifier_Field = [];\n\t}\n\n\tlet LDAP_Domain_Search_User_ID = RocketChat.settings.get('LDAP_Domain_Search_User_ID');\n\n\tif (LDAP_Domain_Search_User_ID !== '') {\n\t\tLDAP_Domain_Search_User_ID = LDAP_Domain_Search_User_ID.replace(/\\s/g, '').split(',');\n\t} else {\n\t\tLDAP_Domain_Search_User_ID = [];\n\t}\n\n\tUnique_Identifier_Field = Unique_Identifier_Field.concat(LDAP_Domain_Search_User_ID);\n\n\tif (Unique_Identifier_Field.length > 0) {\n\t\tUnique_Identifier_Field = Unique_Identifier_Field.find((field) => {\n\t\t\treturn !_.isEmpty(ldapUser.object[field]);\n\t\t});\n\t\tif (Unique_Identifier_Field) {\n\t\t\tUnique_Identifier_Field = {\n\t\t\t\tattribute: Unique_Identifier_Field,\n\t\t\t\tvalue: ldapUser.raw[Unique_Identifier_Field].toString('hex')\n\t\t\t};\n\t\t}\n\t\treturn Unique_Identifier_Field;\n\t}\n};\n\n\ngetDataToSyncUserData = function getDataToSyncUserData(ldapUser, user) {\n\tconst syncUserData = RocketChat.settings.get('LDAP_Sync_User_Data');\n\tconst syncUserDataFieldMap = RocketChat.settings.get('LDAP_Sync_User_Data_FieldMap').trim();\n\n\tif (syncUserData && syncUserDataFieldMap) {\n\t\tconst fieldMap = JSON.parse(syncUserDataFieldMap);\n\t\tlet userData = {};\n\n\t\tlet emailList = [];\n\t\t_.map(fieldMap, function(userField, ldapField) {\n\t\t\tif (!ldapUser.object.hasOwnProperty(ldapField)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tswitch (userField) {\n\t\t\t\tcase 'email':\n\t\t\t\t\tif (_.isObject(ldapUser.object[ldapField] === 'object')) {\n\t\t\t\t\t\t_.map(ldapUser.object[ldapField], function(item) {\n\t\t\t\t\t\t\temailList.push({ address: item, verified: true });\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\temailList.push({ address: ldapUser.object[ldapField], verified: true });\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'name':\n\t\t\t\t\tif (user.name !== ldapUser.object[ldapField]) {\n\t\t\t\t\t\tuserData.name = ldapUser.object[ldapField];\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t});\n\n\t\tif (emailList.length > 0) {\n\t\t\tif (JSON.stringify(user.emails) !== JSON.stringify(emailList)) {\n\t\t\t\tuserData.emails = emailList;\n\t\t\t}\n\t\t}\n\n\t\tconst uniqueId = getLdapUserUniqueID(ldapUser);\n\n\t\tif (uniqueId && (!user.services || !user.services.ldap || user.services.ldap.id !== uniqueId.value || user.services.ldap.idAttribute !== uniqueId.attribute)) {\n\t\t\tuserData['services.ldap.id'] = uniqueId.value;\n\t\t\tuserData['services.ldap.idAttribute'] = uniqueId.attribute;\n\t\t}\n\n\t\tif (_.size(userData)) {\n\t\t\treturn userData;\n\t\t}\n\t}\n};\n\n\nsyncUserData = function syncUserData(user, ldapUser) {\n\tlogger.info('Syncing user data');\n\tlogger.debug('user', user);\n\tlogger.debug('ldapUser', ldapUser);\n\n\tconst userData = getDataToSyncUserData(ldapUser, user);\n\tif (user && user._id && userData) {\n\t\tMeteor.users.update(user._id, { $set: userData });\n\t\tuser = Meteor.users.findOne({_id: user._id});\n\t\tlogger.debug('setting', JSON.stringify(userData, null, 2));\n\t}\n\n\tconst username = slug(getLdapUsername(ldapUser));\n\tif (user && user._id && username !== user.username) {\n\t\tlogger.info('Syncing user username', user.username, '->', username);\n\t\tRocketChat._setUsername(user._id, username);\n\t}\n\n\tif (user && user._id && RocketChat.settings.get('LDAP_Sync_User_Avatar') === true) {\n\t\tconst avatar = ldapUser.raw.thumbnailPhoto || ldapUser.raw.jpegPhoto;\n\t\tif (avatar) {\n\t\t\tlogger.info('Syncing user avatar');\n\t\t\tconst rs = RocketChatFile.bufferToStream(avatar);\n\t\t\tRocketChatFileAvatarInstance.deleteFile(encodeURIComponent(`${user.username}.jpg`));\n\t\t\tconst ws = RocketChatFileAvatarInstance.createWriteStream(encodeURIComponent(`${user.username}.jpg`), 'image/jpeg');\n\t\t\tws.on('end', Meteor.bindEnvironment(function() {\n\t\t\t\tMeteor.setTimeout(function() {\n\t\t\t\t\tRocketChat.models.Users.setAvatarOrigin(user._id, 'ldap');\n\t\t\t\t\tRocketChat.Notifications.notifyAll('updateAvatar', {username: user.username});\n\t\t\t\t}, 500);\n\t\t\t}));\n\t\t\trs.pipe(ws);\n\t\t}\n\t}\n};\n\n\nsync = function sync() {\n\tif (RocketChat.settings.get('LDAP_Enable') !== true) {\n\t\treturn;\n\t}\n\n\tconst ldap = new LDAP();\n\n\ttry {\n\t\tldap.connectSync();\n\n\t\tconst users = RocketChat.models.Users.findLDAPUsers();\n\n\t\tusers.forEach(function(user) {\n\t\t\tlet ldapUser;\n\n\t\t\tif (user.services && user.services.ldap && user.services.ldap.id) {\n\t\t\t\tldapUser = ldap.getUserByIdSync(user.services.ldap.id, user.services.ldap.idAttribute);\n\t\t\t} else {\n\t\t\t\tldapUser = ldap.getUserByUsernameSync(user.username);\n\t\t\t}\n\n\t\t\tif (ldapUser) {\n\t\t\t\tsyncUserData(user, ldapUser);\n\t\t\t} else {\n\t\t\t\tlogger.info('Can\\'t sync user', user.username);\n\t\t\t}\n\t\t});\n\t} catch (error) {\n\t\tlogger.error(error);\n\t\treturn error;\n\t}\n\n\tldap.disconnect();\n\treturn true;\n};\n\nlet interval;\nlet timeout;\n\nRocketChat.settings.get('LDAP_Sync_User_Data', function(key, value) {\n\tMeteor.clearInterval(interval);\n\tMeteor.clearTimeout(timeout);\n\n\tif (value === true) {\n\t\tlogger.info('Enabling LDAP user sync');\n\t\tinterval = Meteor.setInterval(sync, 1000 * 60 * 60);\n\t\ttimeout = Meteor.setTimeout(function() {\n\t\t\tsync();\n\t\t}, 1000 * 30);\n\t} else {\n\t\tlogger.info('Disabling LDAP user sync');\n\t}\n});\n","/* globals LDAP, slug, getLdapUsername, getLdapUserUniqueID, syncUserData, getDataToSyncUserData */\n/* eslint new-cap: [2, {\"capIsNewExceptions\": [\"SHA256\"]}] */\n\nconst logger = new Logger('LDAPHandler', {});\n\nfunction fallbackDefaultAccountSystem(bind, username, password) {\n\tif (typeof username === 'string') {\n\t\tif (username.indexOf('@') === -1) {\n\t\t\tusername = {username: username};\n\t\t} else {\n\t\t\tusername = {email: username};\n\t\t}\n\t}\n\n\tlogger.info('Fallback to default account systen', username);\n\n\tconst loginRequest = {\n\t\tuser: username,\n\t\tpassword: {\n\t\t\tdigest: SHA256(password),\n\t\t\talgorithm: 'sha-256'\n\t\t}\n\t};\n\n\treturn Accounts._runLoginHandlers(bind, loginRequest);\n}\n\n\nAccounts.registerLoginHandler('ldap', function(loginRequest) {\n\tconst self = this;\n\n\tif (!loginRequest.ldapOptions) {\n\t\treturn undefined;\n\t}\n\n\tlogger.info('Init login', loginRequest.username);\n\n\tif (RocketChat.settings.get('LDAP_Enable') !== true) {\n\t\treturn fallbackDefaultAccountSystem(self, loginRequest.username, loginRequest.ldapPass);\n\t}\n\n\tconst ldap = new LDAP();\n\tlet ldapUser;\n\n\ttry {\n\t\tldap.connectSync();\n\t\tconst users = ldap.searchUsersSync(loginRequest.username);\n\n\t\tif (users.length !== 1) {\n\t\t\tlogger.info('Search returned', users.length, 'record(s) for', loginRequest.username);\n\t\t\tthrow new Error('User not Found');\n\t\t}\n\n\t\tif (ldap.authSync(users[0].dn, loginRequest.ldapPass) === true) {\n\t\t\tldapUser = users[0];\n\t\t} else {\n\t\t\tlogger.info('Wrong password for', loginRequest.username);\n\t\t}\n\t} catch (error) {\n\t\tlogger.error(error);\n\t}\n\n\tldap.disconnect();\n\n\tif (ldapUser === undefined) {\n\t\treturn fallbackDefaultAccountSystem(self, loginRequest.username, loginRequest.ldapPass);\n\t}\n\n\tlet username;\n\n\tif (RocketChat.settings.get('LDAP_Username_Field') !== '') {\n\t\tusername = slug(getLdapUsername(ldapUser));\n\t} else {\n\t\tusername = slug(loginRequest.username);\n\t}\n\n\t// Look to see if user already exists\n\tlet userQuery;\n\n\tlet Unique_Identifier_Field = getLdapUserUniqueID(ldapUser);\n\tlet user;\n\n\tif (Unique_Identifier_Field) {\n\t\tuserQuery = {\n\t\t\t'services.ldap.id': Unique_Identifier_Field.value\n\t\t};\n\n\t\tlogger.info('Querying user');\n\t\tlogger.debug('userQuery', userQuery);\n\n\t\tuser = Meteor.users.findOne(userQuery);\n\t}\n\n\tif (!user) {\n\t\tuserQuery = {\n\t\t\tusername: username\n\t\t};\n\n\t\tlogger.debug('userQuery', userQuery);\n\n\t\tuser = Meteor.users.findOne(userQuery);\n\t}\n\n\t// Login user if they exist\n\tif (user) {\n\t\tif (user.ldap !== true) {\n\t\t\tlogger.info('User exists without \"ldap: true\"');\n\t\t\tthrow new Meteor.Error('LDAP-login-error', 'LDAP Authentication succeded, but there\\'s already an existing user with provided username ['+username+'] in Mongo.');\n\t\t}\n\n\t\tlogger.info('Logging user');\n\n\t\tconst stampedToken = Accounts._generateStampedLoginToken();\n\n\t\tMeteor.users.update(user._id, {\n\t\t\t$push: {\n\t\t\t\t'services.resume.loginTokens': Accounts._hashStampedToken(stampedToken)\n\t\t\t}\n\t\t});\n\n\t\tsyncUserData(user, ldapUser);\n\t\tAccounts.setPassword(user._id, loginRequest.ldapPass, {logout: false});\n\t\treturn {\n\t\t\tuserId: user._id,\n\t\t\ttoken: stampedToken.token\n\t\t};\n\t}\n\n\tlogger.info('User does not exist, creating', username);\n\t// Create new user\n\tvar userObject = {\n\t\tusername: username\n\t};\n\n\tlet userData = getDataToSyncUserData(ldapUser, {});\n\n\tif (userData && userData.emails) {\n\t\tuserObject.email = userData.emails[0].address;\n\t} else if (ldapUser.object.mail && ldapUser.object.mail.indexOf('@') > -1) {\n\t\tuserObject.email = ldapUser.object.mail;\n\t} else if (RocketChat.settings.get('LDAP_Default_Domain') !== '') {\n\t\tuserObject.email = username + '@' + RocketChat.settings.get('LDAP_Default_Domain');\n\t} else {\n\t\tconst error = new Meteor.Error('LDAP-login-error', 'LDAP Authentication succeded, there is no email to create an account. Have you tried setting your Default Domain in LDAP Settings?');\n\t\tlogger.error(error);\n\t\tthrow error;\n\t}\n\n\tlogger.debug('New user data', userObject);\n\n\tuserObject.password = loginRequest.ldapPass;\n\n\ttry {\n\t\tuserObject._id = Accounts.createUser(userObject);\n\t} catch (error) {\n\t\tlogger.error('Error creating user', error);\n\t\tthrow error;\n\t}\n\n\tsyncUserData(userObject, ldapUser);\n\n\tlet ldapUserService = {\n\t\tldap: true\n\t};\n\n\tif (Unique_Identifier_Field) {\n\t\tldapUserService['services.ldap.idAttribute'] = Unique_Identifier_Field.attribute;\n\t\tldapUserService['services.ldap.id'] = Unique_Identifier_Field.value;\n\t}\n\n\tMeteor.users.update(userObject._id, {\n\t\t$set: ldapUserService\n\t});\n\n\tlogger.info('Joining user to default channels');\n\tMeteor.runAsUser(userObject._id, function() {\n\t\tMeteor.call('joinDefaultChannels');\n\t});\n\n\treturn {\n\t\tuserId: userObject._id\n\t};\n});\n","Meteor.startup(function() {\n\tRocketChat.settings.addGroup('LDAP', function() {\n\t\tconst enableQuery = {_id: 'LDAP_Enable', value: true};\n\t\tconst enableTLSQuery = [\n\t\t\t{_id: 'LDAP_Enable', value: true},\n\t\t\t{_id: 'LDAP_Encryption', value: {$in: ['tls', 'ssl']}}\n\t\t];\n\t\tconst customBindSearchEnabledQuery = [\n\t\t\t{_id: 'LDAP_Enable', value: true},\n\t\t\t{_id: 'LDAP_Use_Custom_Domain_Search', value: true}\n\t\t];\n\t\tconst customBindSearchDisabledQuery = [\n\t\t\t{_id: 'LDAP_Enable', value: true},\n\t\t\t{_id: 'LDAP_Use_Custom_Domain_Search', value: false}\n\t\t];\n\t\tconst syncDataQuery = [\n\t\t\t{_id: 'LDAP_Enable', value: true},\n\t\t\t{_id: 'LDAP_Sync_User_Data', value: true}\n\t\t];\n\n\t\tthis.add('LDAP_Enable', false, { type: 'boolean', public: true });\n\t\tthis.add('LDAP_Host', '', { type: 'string', enableQuery: enableQuery });\n\t\tthis.add('LDAP_Port', '389', { type: 'string', enableQuery: enableQuery });\n\t\tthis.add('LDAP_Encryption', 'plain', { type: 'select', values: [ { key: 'plain', i18nLabel: 'No_Encryption' }, { key: 'tls', i18nLabel: 'StartTLS' }, { key: 'ssl', i18nLabel: 'SSL/LDAPS' } ], enableQuery: enableQuery });\n\t\tthis.add('LDAP_CA_Cert', '', { type: 'string', multiline: true, enableQuery: enableTLSQuery });\n\t\tthis.add('LDAP_Reject_Unauthorized', true, { type: 'boolean', enableQuery: enableTLSQuery });\n\t\tthis.add('LDAP_Domain_Base', '', { type: 'string', enableQuery: enableQuery });\n\t\tthis.add('LDAP_Use_Custom_Domain_Search', false, { type: 'boolean', enableQuery: enableQuery });\n\t\tthis.add('LDAP_Custom_Domain_Search', '', { type: 'string', enableQuery: customBindSearchEnabledQuery });\n\t\tthis.add('LDAP_Domain_Search_User', '', { type: 'string', enableQuery: customBindSearchDisabledQuery });\n\t\tthis.add('LDAP_Domain_Search_Password', '', { type: 'password', enableQuery: customBindSearchDisabledQuery });\n\t\tthis.add('LDAP_Domain_Search_Filter', '', { type: 'string', enableQuery: customBindSearchDisabledQuery });\n\t\tthis.add('LDAP_Domain_Search_User_ID', 'sAMAccountName', { type: 'string', enableQuery: customBindSearchDisabledQuery });\n\t\tthis.add('LDAP_Domain_Search_Object_Class', 'user', { type: 'string', enableQuery: customBindSearchDisabledQuery });\n\t\tthis.add('LDAP_Domain_Search_Object_Category', 'person', { type: 'string', enableQuery: customBindSearchDisabledQuery });\n\t\tthis.add('LDAP_Username_Field', 'sAMAccountName', { type: 'string', enableQuery: enableQuery });\n\t\tthis.add('LDAP_Unique_Identifier_Field', 'objectGUID,ibm-entryUUID,GUID,dominoUNID,nsuniqueId,uidNumber', { type: 'string', enableQuery: enableQuery });\n\t\tthis.add('LDAP_Sync_User_Data', false, { type: 'boolean', enableQuery: enableQuery });\n\t\tthis.add('LDAP_Sync_User_Avatar', true, { type: 'boolean', enableQuery: syncDataQuery });\n\t\tthis.add('LDAP_Sync_User_Data_FieldMap', '{\"cn\":\"name\", \"mail\":\"email\"}', { type: 'string', enableQuery: syncDataQuery });\n\t\tthis.add('LDAP_Default_Domain', '', { type: 'string', enableQuery: enableQuery });\n\t\tthis.add('LDAP_Test_Connection', 'ldap_test_connection', { type: 'action', actionText: 'Test_Connection' });\n\t\tthis.add('LDAP_Sync_Users', 'ldap_sync_users', { type: 'action', actionText: 'Sync_Users' });\n\t});\n});\n","/* globals LDAP */\n\nMeteor.methods({\n\tldap_test_connection: function() {\n\t\tconst user = Meteor.user();\n\t\tif (!user) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'ldap_test_connection' });\n\t\t}\n\n\t\tif (!RocketChat.authz.hasRole(user._id, 'admin')) {\n\t\t\tthrow new Meteor.Error('error-not-authorized', 'Not authorized', { method: 'ldap_test_connection' });\n\t\t}\n\n\t\tif (RocketChat.settings.get('LDAP_Enable') !== true) {\n\t\t\tthrow new Meteor.Error('LDAP_disabled');\n\t\t}\n\n\t\tlet ldap;\n\t\ttry {\n\t\t\tldap = new LDAP();\n\t\t\tldap.connectSync();\n\t\t} catch (error) {\n\t\t\tconsole.log(error);\n\t\t\tthrow new Meteor.Error(error.message);\n\t\t}\n\n\t\ttry {\n\t\t\tldap.bindIfNecessary();\n\t\t\tldap.disconnect();\n\t\t} catch (error) {\n\t\t\tthrow new Meteor.Error(error.name || error.message);\n\t\t}\n\n\t\treturn {\n\t\t\tmessage: 'Connection_success',\n\t\t\tparams: []\n\t\t};\n\t}\n});\n","/* globals sync */\n\nMeteor.methods({\n\tldap_sync_users: function() {\n\t\tconst user = Meteor.user();\n\t\tif (!user) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'ldap_sync_users' });\n\t\t}\n\n\t\tif (!RocketChat.authz.hasRole(user._id, 'admin')) {\n\t\t\tthrow new Meteor.Error('error-not-authorized', 'Not authorized', { method: 'ldap_sync_users' });\n\t\t}\n\n\t\tif (RocketChat.settings.get('LDAP_Enable') !== true) {\n\t\t\tthrow new Meteor.Error('LDAP_disabled');\n\t\t}\n\n\t\tconst result = sync();\n\n\t\tif (result === true) {\n\t\t\treturn {\n\t\t\t\tmessage: 'Sync_success',\n\t\t\t\tparams: []\n\t\t\t};\n\t\t}\n\n\t\tthrow result;\n\t}\n});\n"]}