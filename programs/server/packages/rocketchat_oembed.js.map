{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat_oembed/server/server.coffee","meteor://ðŸ’»app/packages/rocketchat_oembed/server/providers.coffee","meteor://ðŸ’»app/server/jumpToMessage.js","meteor://ðŸ’»app/packages/rocketchat_oembed/server/models/OEmbedCache.coffee"],"names":[],"mappings":"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","file":"/packages/rocketchat_oembed.js","sourcesContent":["URL = Npm.require('url')\nquerystring = Npm.require('querystring')\nrequest = HTTPInternals.NpmModules.request.module\niconv = Npm.require('iconv-lite')\nipRangeCheck = Npm.require('ip-range-check')\n\nOEmbed = {}\n\n# Detect encoding\ngetCharset = (body) ->\n\tbinary = body.toString 'binary'\n\tmatches = binary.match /<meta\\b[^>]*charset=[\"']?([\\w\\-]+)/i\n\tif matches\n\t\treturn matches[1]\n\treturn 'utf-8'\n\ntoUtf8 = (body) ->\n\treturn iconv.decode body, getCharset(body)\n\ngetUrlContent = (urlObj, redirectCount = 5, callback) ->\n\tif _.isString(urlObj)\n\t\turlObj = URL.parse urlObj\n\n\tparsedUrl = _.pick urlObj, ['host', 'hash', 'pathname', 'protocol', 'port', 'query', 'search', 'hostname']\n\n\tignoredHosts = RocketChat.settings.get('API_EmbedIgnoredHosts').replace(/\\s/g, '').split(',') or []\n\tif parsedUrl.hostname in ignoredHosts or ipRangeCheck(parsedUrl.hostname, ignoredHosts)\n\t\treturn callback()\n\n\tsafePorts = RocketChat.settings.get('API_EmbedSafePorts').replace(/\\s/g, '').split(',') or []\n\tif parsedUrl.port and safePorts.length > 0 and parsedUrl.port not in safePorts\n\t\treturn callback()\n\n\tdata = RocketChat.callbacks.run 'oembed:beforeGetUrlContent',\n\t\turlObj: urlObj\n\t\tparsedUrl: parsedUrl\n\n\tif data.attachments?\n\t\treturn callback null, data\n\n\turl = URL.format data.urlObj\n\topts =\n\t\turl: url\n\t\tstrictSSL: !RocketChat.settings.get 'Allow_Invalid_SelfSigned_Certs'\n\t\tgzip: true\n\t\tmaxRedirects: redirectCount\n\t\theaders:\n\t\t\t'User-Agent': 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2227.0 Safari/537.36'\n\n\theaders = null\n\tchunks = []\n\tchunksTotalLength = 0\n\n\tstream = request opts\n\tstream.on 'response', (response) ->\n\t\tif response.statusCode isnt 200\n\t\t\treturn stream.abort()\n\t\theaders = response.headers\n\n\tstream.on 'data', (chunk) ->\n\t\tchunks.push chunk\n\t\tchunksTotalLength += chunk.length\n\t\tif chunksTotalLength > 250000\n\t\t\tstream.abort()\n\n\tstream.on 'end', Meteor.bindEnvironment ->\n\t\tbuffer = Buffer.concat(chunks)\n\n\t\tcallback null, {\n\t\t\theaders: headers\n\t\t\tbody: toUtf8 buffer\n\t\t\tparsedUrl: parsedUrl\n\t\t}\n\n\tstream.on 'error', (error) ->\n\t\tcallback null, {\n\t\t\terror: error\n\t\t\tparsedUrl: parsedUrl\n\t\t}\n\nOEmbed.getUrlMeta = (url, withFragment) ->\n\tgetUrlContentSync = Meteor.wrapAsync getUrlContent\n\n\turlObj = URL.parse url\n\n\tif withFragment?\n\t\tqueryStringObj = querystring.parse urlObj.query\n\t\tqueryStringObj._escaped_fragment_ = ''\n\t\turlObj.query = querystring.stringify queryStringObj\n\n\t\tpath = urlObj.pathname\n\t\tif urlObj.query?\n\t\t\tpath += '?' + urlObj.query\n\n\t\turlObj.path = path\n\n\tcontent = getUrlContentSync urlObj, 5\n\tif !content\n\t\treturn\n\n\tif content.attachments?\n\t\treturn content\n\n\tmetas = undefined\n\n\tif content?.body?\n\t\tmetas = {}\n\t\tcontent.body.replace /<title>((.|\\n)+?)<\\/title>/gmi, (meta, title) ->\n\t\t\tmetas.pageTitle = title\n\n\t\tcontent.body.replace /<meta[^>]*(?:name|property)=[']([^']*)['][^>]*content=[']([^']*)['][^>]*>/gmi, (meta, name, value) ->\n\t\t\tmetas[changeCase.camelCase(name)] = value\n\n\t\tcontent.body.replace /<meta[^>]*(?:name|property)=[\"]([^\"]*)[\"][^>]*content=[\"]([^\"]*)[\"][^>]*>/gmi, (meta, name, value) ->\n\t\t\tmetas[changeCase.camelCase(name)] = value\n\n\t\tcontent.body.replace /<meta[^>]*content=[']([^']*)['][^>]*(?:name|property)=[']([^']*)['][^>]*>/gmi, (meta, value, name) ->\n\t\t\tmetas[changeCase.camelCase(name)] = value\n\n\t\tcontent.body.replace /<meta[^>]*content=[\"]([^\"]*)[\"][^>]*(?:name|property)=[\"]([^\"]*)[\"][^>]*>/gmi, (meta, value, name) ->\n\t\t\tmetas[changeCase.camelCase(name)] = value\n\n\n\t\tif metas.fragment is '!' and not withFragment?\n\t\t\treturn OEmbed.getUrlMeta url, true\n\n\theaders = undefined\n\n\tif content?.headers?\n\t\theaders = {}\n\t\tfor header, value of content.headers\n\t\t\theaders[changeCase.camelCase(header)] = value\n\n\tdata = RocketChat.callbacks.run 'oembed:afterParseContent',\n\t\tmeta: metas\n\t\theaders: headers\n\t\tparsedUrl: content.parsedUrl\n\t\tcontent: content\n\n\treturn data\n\nOEmbed.getUrlMetaWithCache = (url, withFragment) ->\n\tcache = RocketChat.models.OEmbedCache.findOneById url\n\tif cache?\n\t\treturn cache.data\n\n\tdata = OEmbed.getUrlMeta url, withFragment\n\n\tif data?\n\t\ttry\n\t\t\tRocketChat.models.OEmbedCache.createWithIdAndData url, data\n\t\tcatch e\n\t\t\tconsole.error 'OEmbed duplicated record', url\n\n\t\treturn data\n\n\treturn\n\ngetRelevantHeaders = (headersObj) ->\n\theaders = {}\n\tfor key, value of headersObj\n\t\tif key.toLowerCase() in ['contenttype', 'contentlength'] and value?.trim() isnt ''\n\t\t\theaders[key] = value\n\n\tif Object.keys(headers).length > 0\n\t\treturn headers\n\treturn\n\ngetRelevantMetaTags = (metaObj) ->\n\ttags = {}\n\tfor key, value of metaObj\n\t\tif /^(og|fb|twitter|oembed).+|description|title|pageTitle$/.test(key.toLowerCase()) and value?.trim() isnt ''\n\t\t\ttags[key] = value\n\n\tif Object.keys(tags).length > 0\n\t\treturn tags\n\treturn\n\nOEmbed.RocketUrlParser = (message) ->\n\tif Array.isArray message.urls\n\t\tattachments = []\n\t\tchanged = false\n\t\tmessage.urls.forEach (item) ->\n\t\t\tif item.ignoreParse is true then return\n\t\t\tif not /^https?:\\/\\//i.test item.url then return\n\n\t\t\tdata = OEmbed.getUrlMetaWithCache item.url\n\n\t\t\tif data?\n\t\t\t\tif data.attachments\n\t\t\t\t\tattachments = _.union attachments, data.attachments\n\t\t\t\telse\n\t\t\t\t\tif data.meta?\n\t\t\t\t\t\titem.meta = getRelevantMetaTags data.meta\n\n\t\t\t\t\tif data.headers?\n\t\t\t\t\t\titem.headers = getRelevantHeaders data.headers\n\n\t\t\t\t\titem.parsedUrl = data.parsedUrl\n\t\t\t\t\tchanged = true\n\n\t\tif attachments.length\n\t\t\tRocketChat.models.Messages.setMessageAttachments message._id, attachments\n\n\t\tif changed is true\n\t\t\tRocketChat.models.Messages.setUrlsById message._id, message.urls\n\n\treturn message\n\nRocketChat.settings.get 'API_Embed', (key, value) ->\n\tif value\n\t\tRocketChat.callbacks.add 'afterSaveMessage', OEmbed.RocketUrlParser, RocketChat.callbacks.priority.LOW, 'API_Embed'\n\telse\n\t\tRocketChat.callbacks.remove 'afterSaveMessage', 'API_Embed'\n","URL = Npm.require('url')\nQueryString = Npm.require('querystring')\n\nclass Providers\n\tproviders: []\n\n\t@getConsumerUrl: (provider, url) ->\n\t\turlObj = URL.parse provider.endPoint, true\n\t\turlObj.query['url'] = url\n\t\tdelete urlObj.search\n\t\treturn URL.format urlObj\n\n\tregisterProvider: (provider) ->\n\t\tthis.providers.push(provider)\n\n\tgetProviders: () ->\n\t\treturn this.providers\n\n\tgetProviderForUrl: (url) ->\n\t\treturn _.find this.providers, (provider) ->\n\t\t\tcandidate = _.find provider.urls, (re) ->\n\t\t\t\treturn re.test url\n\t\t\treturn candidate?\n\nproviders = new Providers()\nproviders.registerProvider\n\turls: [new RegExp('https?://soundcloud.com/\\\\S+')]\n\tendPoint: 'https://soundcloud.com/oembed?format=json&maxheight=150'\nproviders.registerProvider\n\turls: [new RegExp('https?://vimeo.com/[^/]+'), new RegExp('https?://vimeo.com/channels/[^/]+/[^/]+'), new RegExp('https://vimeo.com/groups/[^/]+/videos/[^/]+')]\n\tendPoint: 'https://vimeo.com/api/oembed.json?maxheight=200'\nproviders.registerProvider\n\turls: [new RegExp('https?://www.youtube.com/\\\\S+'), new RegExp('https?://youtu.be/\\\\S+')]\n\tendPoint: 'https://www.youtube.com/oembed?maxheight=200'\nproviders.registerProvider\n\turls: [new RegExp('https?://www.rdio.com/\\\\S+'), new RegExp('https?://rd.io/\\\\S+')]\n\tendPoint: 'https://www.rdio.com/api/oembed/?format=json&maxheight=150'\nproviders.registerProvider\n\turls: [new RegExp('https?://www.slideshare.net/[^/]+/[^/]+')]\n\tendPoint: 'https://www.slideshare.net/api/oembed/2?format=json&maxheight=200'\nproviders.registerProvider\n\turls: [new RegExp('https?://www.dailymotion.com/video/\\\\S+')]\n\tendPoint: 'https://www.dailymotion.com/services/oembed?maxheight=200'\n\nRocketChat.oembed = {}\nRocketChat.oembed.providers = providers\n\nRocketChat.callbacks.add 'oembed:beforeGetUrlContent', (data) ->\n\tif data.parsedUrl?\n\t\turl = URL.format data.parsedUrl\n\t\tprovider = providers.getProviderForUrl url\n\t\tif provider?\n\t\t\tconsumerUrl = Providers.getConsumerUrl provider, url\n\t\t\tconsumerUrl = URL.parse consumerUrl, true\n\t\t\t_.extend data.parsedUrl, consumerUrl\n\t\t\tdata.urlObj.port = consumerUrl.port\n\t\t\tdata.urlObj.hostname = consumerUrl.hostname\n\t\t\tdata.urlObj.pathname = consumerUrl.pathname\n\t\t\tdata.urlObj.query = consumerUrl.query\n\t\t\tdelete data.urlObj.search\n\n\treturn data\n\nRocketChat.callbacks.add 'oembed:afterParseContent', (data) ->\n\tif data.parsedUrl?.query?\n\t\tqueryString = data.parsedUrl.query\n\t\tif _.isString data.parsedUrl.query\n\t\t\tqueryString = QueryString.parse data.parsedUrl.query\n\t\tif queryString.url?\n\t\t\turl = queryString.url\n\t\t\tprovider = providers.getProviderForUrl url\n\t\t\tif provider?\n\t\t\t\tif data.content?.body?\n\t\t\t\t\tmetas = JSON.parse data.content.body;\n\t\t\t\t\t_.each metas, (value, key) ->\n\t\t\t\t\t\tif _.isString value\n\t\t\t\t\t\t\tdata.meta[changeCase.camelCase('oembed_' + key)] = value\n\t\t\t\t\tdata.meta['oembedUrl'] = url\n\n\treturn data\n","/* globals getAvatarUrlFromUsername */\n\nconst URL = Npm.require('url');\nconst QueryString = Npm.require('querystring');\n\nRocketChat.callbacks.add('beforeSaveMessage', (msg) => {\n\tif (msg && msg.urls) {\n\t\tmsg.urls.forEach((item) => {\n\t\t\tif (item.url.indexOf(Meteor.absoluteUrl()) === 0) {\n\t\t\t\tconst urlObj = URL.parse(item.url);\n\t\t\t\tif (urlObj.query) {\n\t\t\t\t\tconst queryString = QueryString.parse(urlObj.query);\n\t\t\t\t\tif (_.isString(queryString.msg)) { // Jump-to query param\n\t\t\t\t\t\tlet jumpToMessage = RocketChat.models.Messages.findOneById(queryString.msg);\n\t\t\t\t\t\tif (jumpToMessage) {\n\t\t\t\t\t\t\tmsg.attachments = msg.attachments || [];\n\t\t\t\t\t\t\tmsg.attachments.push({\n\t\t\t\t\t\t\t\t'text' : jumpToMessage.msg,\n\t\t\t\t\t\t\t\t'author_name' : jumpToMessage.u.username,\n\t\t\t\t\t\t\t\t'author_icon' : getAvatarUrlFromUsername(jumpToMessage.u.username),\n\t\t\t\t\t\t\t\t'message_link' : item.url,\n\t\t\t\t\t\t\t\t'ts': jumpToMessage.ts\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\titem.ignoreParse = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\treturn msg;\n}, RocketChat.callbacks.priority.LOW);\n","RocketChat.models.OEmbedCache = new class extends RocketChat.models._Base\n\tconstructor: ->\n\t\t@_initModel 'oembed_cache'\n\n\n\t# FIND ONE\n\tfindOneById: (_id, options) ->\n\t\tquery =\n\t\t\t_id: _id\n\n\t\treturn @findOne query, options\n\n\n\t# INSERT\n\tcreateWithIdAndData: (_id, data) ->\n\t\trecord =\n\t\t\t_id: _id\n\t\t\tdata: data\n\t\t\tupdatedAt: new Date\n\n\t\trecord._id = @insert record\n\t\treturn record\n"]}