{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat_integrations/lib/rocketchat.coffee","meteor://ðŸ’»app/packages/rocketchat_integrations/client/stylesheets/load.coffee","meteor://ðŸ’»app/server/logger.js","meteor://ðŸ’»app/packages/rocketchat_integrations/server/models/Integrations.coffee","meteor://ðŸ’»app/packages/rocketchat_integrations/server/publications/integrations.coffee","meteor://ðŸ’»app/packages/rocketchat_integrations/server/methods/incoming/addIncomingIntegration.coffee","meteor://ðŸ’»app/packages/rocketchat_integrations/server/methods/incoming/updateIncomingIntegration.coffee","meteor://ðŸ’»app/packages/rocketchat_integrations/server/methods/incoming/deleteIncomingIntegration.coffee","meteor://ðŸ’»app/packages/rocketchat_integrations/server/methods/outgoing/addOutgoingIntegration.coffee","meteor://ðŸ’»app/packages/rocketchat_integrations/server/methods/outgoing/updateOutgoingIntegration.coffee","meteor://ðŸ’»app/packages/rocketchat_integrations/server/methods/outgoing/deleteOutgoingIntegration.coffee","meteor://ðŸ’»app/packages/rocketchat_integrations/server/api/api.coffee","meteor://ðŸ’»app/packages/rocketchat_integrations/server/triggers.coffee","meteor://ðŸ’»app/server/processWebhookMessage.js"],"names":[],"mappings":"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","file":"/packages/rocketchat_integrations.js","sourcesContent":["RocketChat.integrations = {}\n","RocketChat.theme.addPackageAsset ->\n\treturn Assets.getText 'client/stylesheets/integrations.less'\n","/* globals logger:true */\n/* exported logger */\n\nlogger = new Logger('Integrations', {\n\tsections: {\n\t\tincoming: 'Incoming WebHook',\n\t\toutgoing: 'Outgoing WebHook'\n\t}\n});\n","RocketChat.models.Integrations = new class extends RocketChat.models._Base\n\tconstructor: ->\n\t\t@_initModel 'integrations'\n\n\n\t# FIND\n\t# findByRole: (role, options) ->\n\t# \tquery =\n\t# \t\troles: role\n\n\t# \treturn @find query, options\n\n\t# CREATE\n","Meteor.publish 'integrations', ->\n\tunless @userId\n\t\treturn @ready()\n\n\tif RocketChat.authz.hasPermission @userId, 'manage-integrations'\n\t\treturn RocketChat.models.Integrations.find()\n\telse if RocketChat.authz.hasPermission @userId, 'manage-own-integrations'\n\t\treturn RocketChat.models.Integrations.find({\"_createdBy._id\": @userId})\n\telse\n\t\tthrow new Meteor.Error \"not-authorized\"\n","Meteor.methods\n\taddIncomingIntegration: (integration) ->\n\t\tif (not RocketChat.authz.hasPermission @userId, 'manage-integrations') and (not RocketChat.authz.hasPermission @userId, 'manage-own-integrations')\n\t\t\tthrow new Meteor.Error 'not_authorized'\n\n\t\tif not _.isString(integration.channel)\n\t\t\tthrow new Meteor.Error 'error-invalid-channel', 'Invalid channel', { method: 'addIncomingIntegration' }\n\n\t\tif integration.channel.trim() is ''\n\t\t\tthrow new Meteor.Error 'error-invalid-channel', 'Invalid channel', { method: 'addIncomingIntegration' }\n\n\t\tchannels = _.map(integration.channel.split(','), (channel) -> s.trim(channel))\n\n\t\tfor channel in channels\n\t\t\tif channel[0] not in ['@', '#']\n\t\t\t\tthrow new Meteor.Error 'error-invalid-channel-start-with-chars', 'Invalid channel. Start with @ or #', { method: 'updateIncomingIntegration' }\n\n\t\tif not _.isString(integration.username)\n\t\t\tthrow new Meteor.Error 'error-invalid-username', 'Invalid username', { method: 'addIncomingIntegration' }\n\n\t\tif integration.username.trim() is ''\n\t\t\tthrow new Meteor.Error 'error-invalid-username', 'Invalid username', { method: 'addIncomingIntegration' }\n\n\t\tif integration.scriptEnabled is true and integration.script? and integration.script.trim() isnt ''\n\t\t\ttry\n\t\t\t\tbabelOptions = Babel.getDefaultOptions()\n\t\t\t\tbabelOptions.externalHelpers = false\n\n\t\t\t\tintegration.scriptCompiled = Babel.compile(integration.script, babelOptions).code\n\t\t\t\tintegration.scriptError = undefined\n\t\t\tcatch e\n\t\t\t\tintegration.scriptCompiled = undefined\n\t\t\t\tintegration.scriptError = _.pick e, 'name', 'message', 'pos', 'loc', 'codeFrame'\n\n\t\tfor channel in channels\n\t\t\trecord = undefined\n\t\t\tchannelType = channel[0]\n\t\t\tchannel = channel.substr(1)\n\n\t\t\tswitch channelType\n\t\t\t\twhen '#'\n\t\t\t\t\trecord = RocketChat.models.Rooms.findOne\n\t\t\t\t\t\t$or: [\n\t\t\t\t\t\t\t{_id: channel}\n\t\t\t\t\t\t\t{name: channel}\n\t\t\t\t\t\t]\n\t\t\t\twhen '@'\n\t\t\t\t\trecord = RocketChat.models.Users.findOne\n\t\t\t\t\t\t$or: [\n\t\t\t\t\t\t\t{_id: channel}\n\t\t\t\t\t\t\t{username: channel}\n\t\t\t\t\t\t]\n\n\t\t\tif record is undefined\n\t\t\t\tthrow new Meteor.Error 'error-invalid-room', 'Invalid room', { method: 'addIncomingIntegration' }\n\n\t\t\tif record.usernames? and\n\t\t\t(not RocketChat.authz.hasPermission @userId, 'manage-integrations') and\n\t\t\t(RocketChat.authz.hasPermission @userId, 'manage-own-integrations') and\n\t\t\tMeteor.user()?.username not in record.usernames\n\t\t\t\tthrow new Meteor.Error 'error-invalid-channel', 'Invalid Channel', { method: 'addIncomingIntegration' }\n\n\t\tuser = RocketChat.models.Users.findOne({username: integration.username})\n\n\t\tif not user?\n\t\t\tthrow new Meteor.Error 'error-invalid-user', 'Invalid user', { method: 'addIncomingIntegration' }\n\n\t\ttoken = Random.id(48)\n\n\t\tintegration.type = 'webhook-incoming'\n\t\tintegration.token = token\n\t\tintegration.userId = user._id\n\t\tintegration._createdAt = new Date\n\t\tintegration._createdBy = RocketChat.models.Users.findOne @userId, {fields: {username: 1}}\n\n\t\tRocketChat.models.Roles.addUserRoles user._id, 'bot'\n\n\t\tintegration._id = RocketChat.models.Integrations.insert integration\n\n\t\treturn integration\n","Meteor.methods\n\tupdateIncomingIntegration: (integrationId, integration) ->\n\t\tif not _.isString(integration.channel)\n\t\t\tthrow new Meteor.Error 'error-invalid-channel', 'Invalid channel', { method: 'updateIncomingIntegration' }\n\n\t\tif integration.channel.trim() is ''\n\t\t\tthrow new Meteor.Error 'error-invalid-channel', 'Invalid channel', { method: 'updateIncomingIntegration' }\n\n\t\tchannels = _.map(integration.channel.split(','), (channel) -> s.trim(channel))\n\n\t\tfor channel in channels\n\t\t\tif channel[0] not in ['@', '#']\n\t\t\t\tthrow new Meteor.Error 'error-invalid-channel-start-with-chars', 'Invalid channel. Start with @ or #', { method: 'updateIncomingIntegration' }\n\n\t\tcurrentIntegration = null\n\n\t\tif RocketChat.authz.hasPermission @userId, 'manage-integrations'\n\t\t\tcurrentIntegration = RocketChat.models.Integrations.findOne(integrationId)\n\t\telse if RocketChat.authz.hasPermission @userId, 'manage-own-integrations'\n\t\t\tcurrentIntegration = RocketChat.models.Integrations.findOne({\"_id\": integrationId, \"_createdBy._id\": @userId})\n\t\telse\n\t\t\tthrow new Meteor.Error 'not_authorized'\n\n\t\tif not currentIntegration?\n\t\t\tthrow new Meteor.Error 'error-invalid-integration', 'Invalid integration', { method: 'updateIncomingIntegration' }\n\n\t\tif integration.scriptEnabled is true and integration.script? and integration.script.trim() isnt ''\n\t\t\ttry\n\t\t\t\tbabelOptions = Babel.getDefaultOptions()\n\t\t\t\tbabelOptions.externalHelpers = false\n\n\t\t\t\tintegration.scriptCompiled = Babel.compile(integration.script, babelOptions).code\n\t\t\t\tintegration.scriptError = undefined\n\t\t\tcatch e\n\t\t\t\tintegration.scriptCompiled = undefined\n\t\t\t\tintegration.scriptError = _.pick e, 'name', 'message', 'pos', 'loc', 'codeFrame'\n\n\t\tfor channel in channels\n\t\t\trecord = undefined\n\t\t\tchannelType = channel[0]\n\t\t\tchannel = channel.substr(1)\n\n\t\t\tswitch channelType\n\t\t\t\twhen '#'\n\t\t\t\t\trecord = RocketChat.models.Rooms.findOne\n\t\t\t\t\t\t$or: [\n\t\t\t\t\t\t\t{_id: channel}\n\t\t\t\t\t\t\t{name: channel}\n\t\t\t\t\t\t]\n\t\t\t\twhen '@'\n\t\t\t\t\trecord = RocketChat.models.Users.findOne\n\t\t\t\t\t\t$or: [\n\t\t\t\t\t\t\t{_id: channel}\n\t\t\t\t\t\t\t{username: channel}\n\t\t\t\t\t\t]\n\n\t\t\tif record is undefined\n\t\t\t\tthrow new Meteor.Error 'error-invalid-room', 'Invalid room', { method: 'updateIncomingIntegration' }\n\n\t\t\tif record.usernames? and\n\t\t\t(not RocketChat.authz.hasPermission @userId, 'manage-integrations') and\n\t\t\t(RocketChat.authz.hasPermission @userId, 'manage-own-integrations') and\n\t\t\tMeteor.user()?.username not in record.usernames\n\t\t\t\tthrow new Meteor.Error 'error-invalid-channel', 'Invalid Channel', { method: 'updateIncomingIntegration' }\n\n\t\tuser = RocketChat.models.Users.findOne({username: currentIntegration.username})\n\t\tRocketChat.models.Roles.addUserRoles user._id, 'bot'\n\n\t\tRocketChat.models.Integrations.update integrationId,\n\t\t\t$set:\n\t\t\t\tenabled: integration.enabled\n\t\t\t\tname: integration.name\n\t\t\t\tavatar: integration.avatar\n\t\t\t\temoji: integration.emoji\n\t\t\t\talias: integration.alias\n\t\t\t\tchannel: channels\n\t\t\t\tscript: integration.script\n\t\t\t\tscriptEnabled: integration.scriptEnabled\n\t\t\t\tscriptCompiled: integration.scriptCompiled\n\t\t\t\tscriptError: integration.scriptError\n\t\t\t\t_updatedAt: new Date\n\t\t\t\t_updatedBy: RocketChat.models.Users.findOne @userId, {fields: {username: 1}}\n\n\t\treturn RocketChat.models.Integrations.findOne(integrationId)\n","Meteor.methods\n\tdeleteIncomingIntegration: (integrationId) ->\n\t\tintegration = null\n\n\t\tif RocketChat.authz.hasPermission @userId, 'manage-integrations'\n\t\t\tintegration = RocketChat.models.Integrations.findOne(integrationId)\n\t\telse if RocketChat.authz.hasPermission @userId, 'manage-own-integrations'\n\t\t\tintegration = RocketChat.models.Integrations.findOne(integrationId, { fields : {\"_createdBy._id\": @userId} })\n\t\telse\n\t\t\tthrow new Meteor.Error 'not_authorized'\n\n\t\tif not integration?\n\t\t\tthrow new Meteor.Error 'error-invalid-integration', 'Invalid integration', { method: 'deleteIncomingIntegration' }\n\n\t\tRocketChat.models.Integrations.remove _id: integrationId\n\n\t\treturn true\n","Meteor.methods\n\taddOutgoingIntegration: (integration) ->\n\t\tif integration.channel?.trim? and integration.channel.trim() is ''\n\t\t\tdelete integration.channel\n\n\t\tif (not RocketChat.authz.hasPermission @userId, 'manage-integrations') and\n\t\tnot (RocketChat.authz.hasPermission @userId, 'manage-own-integrations') and\n\t\tnot (RocketChat.authz.hasPermission @userId, 'manage-integrations', 'bot') and\n\t\tnot (RocketChat.authz.hasPermission @userId, 'manage-own-integrations', 'bot')\n\t\t\tthrow new Meteor.Error 'not_authorized'\n\n\t\tif integration.username.trim() is ''\n\t\t\tthrow new Meteor.Error 'error-invalid-username', 'Invalid username', { method: 'addOutgoingIntegration' }\n\n\t\tif not Match.test integration.urls, [String]\n\t\t\tthrow new Meteor.Error 'error-invalid-urls', 'Invalid URLs', { method: 'addOutgoingIntegration' }\n\n\t\tfor url, index in integration.urls\n\t\t\tdelete integration.urls[index] if url.trim() is ''\n\n\t\tintegration.urls = _.without integration.urls, [undefined]\n\n\t\tif integration.urls.length is 0\n\t\t\tthrow new Meteor.Error 'error-invalid-urls', 'Invalid URLs', { method: 'addOutgoingIntegration' }\n\n\t\tchannels = if integration.channel then _.map(integration.channel.split(','), (channel) -> s.trim(channel)) else []\n\n\t\tfor channel in channels\n\t\t\tif channel[0] not in ['@', '#']\n\t\t\t\tthrow new Meteor.Error 'error-invalid-channel-start-with-chars', 'Invalid channel. Start with @ or #', { method: 'updateIncomingIntegration' }\n\n\t\tif integration.triggerWords?\n\t\t\tif not Match.test integration.triggerWords, [String]\n\t\t\t\tthrow new Meteor.Error 'error-invalid-triggerWords', 'Invalid triggerWords', { method: 'addOutgoingIntegration' }\n\n\t\t\tfor triggerWord, index in integration.triggerWords\n\t\t\t\tdelete integration.triggerWords[index] if triggerWord.trim() is ''\n\n\t\t\tintegration.triggerWords = _.without integration.triggerWords, [undefined]\n\n\t\tif integration.scriptEnabled is true and integration.script? and integration.script.trim() isnt ''\n\t\t\ttry\n\t\t\t\tbabelOptions = Babel.getDefaultOptions()\n\t\t\t\tbabelOptions.externalHelpers = false\n\n\t\t\t\tintegration.scriptCompiled = Babel.compile(integration.script, babelOptions).code\n\t\t\t\tintegration.scriptError = undefined\n\t\t\tcatch e\n\t\t\t\tintegration.scriptCompiled = undefined\n\t\t\t\tintegration.scriptError = _.pick e, 'name', 'message', 'pos', 'loc', 'codeFrame'\n\n\n\t\tfor channel in channels\n\t\t\trecord = undefined\n\t\t\tchannelType = channel[0]\n\t\t\tchannel = channel.substr(1)\n\n\t\t\tswitch channelType\n\t\t\t\twhen '#'\n\t\t\t\t\trecord = RocketChat.models.Rooms.findOne\n\t\t\t\t\t\t$or: [\n\t\t\t\t\t\t\t{_id: channel}\n\t\t\t\t\t\t\t{name: channel}\n\t\t\t\t\t\t]\n\t\t\t\twhen '@'\n\t\t\t\t\trecord = RocketChat.models.Users.findOne\n\t\t\t\t\t\t$or: [\n\t\t\t\t\t\t\t{_id: channel}\n\t\t\t\t\t\t\t{username: channel}\n\t\t\t\t\t\t]\n\n\t\t\tif record is undefined\n\t\t\t\tthrow new Meteor.Error 'error-invalid-room', 'Invalid room', { method: 'addOutgoingIntegration' }\n\n\t\t\tif record.usernames? and\n\t\t\t(not RocketChat.authz.hasPermission @userId, 'manage-integrations') and\n\t\t\t(RocketChat.authz.hasPermission @userId, 'manage-own-integrations') and\n\t\t\tMeteor.user()?.username not in record.usernames\n\t\t\t\tthrow new Meteor.Error 'error-invalid-channel', 'Invalid Channel', { method: 'addOutgoingIntegration' }\n\n\t\tuser = RocketChat.models.Users.findOne({username: integration.username})\n\n\t\tif not user?\n\t\t\tthrow new Meteor.Error 'error-invalid-user', 'Invalid user', { method: 'addOutgoingIntegration' }\n\n\t\tintegration.type = 'webhook-outgoing'\n\t\tintegration.userId = user._id\n\t\tintegration._createdAt = new Date\n\t\tintegration._createdBy = RocketChat.models.Users.findOne @userId, {fields: {username: 1}}\n\n\t\tintegration._id = RocketChat.models.Integrations.insert integration\n\n\t\treturn integration\n","Meteor.methods\n\tupdateOutgoingIntegration: (integrationId, integration) ->\n\n\t\tif integration.username.trim() is ''\n\t\t\tthrow new Meteor.Error 'error-invalid-username', 'Invalid username', { method: 'updateOutgoingIntegration' }\n\n\t\tif not Match.test integration.urls, [String]\n\t\t\tthrow new Meteor.Error 'error-invalid-urls', 'Invalid URLs', { method: 'updateOutgoingIntegration' }\n\n\t\tfor url, index in integration.urls\n\t\t\tdelete integration.urls[index] if url.trim() is ''\n\n\t\tintegration.urls = _.without integration.urls, [undefined]\n\n\t\tif integration.urls.length is 0\n\t\t\tthrow new Meteor.Error 'error-invalid-urls', 'Invalid URLs', { method: 'updateOutgoingIntegration' }\n\n\t\tif _.isString(integration.channel)\n\t\t\tintegration.channel = integration.channel.trim()\n\t\telse\n\t\t\tintegration.channel = undefined\n\n\t\tchannels = if integration.channel then _.map(integration.channel.split(','), (channel) -> s.trim(channel)) else []\n\n\t\tfor channel in channels\n\t\t\tif channel[0] not in ['@', '#']\n\t\t\t\tthrow new Meteor.Error 'error-invalid-channel-start-with-chars', 'Invalid channel. Start with @ or #', { method: 'updateIncomingIntegration' }\n\n\t\tif not integration.token? or integration.token?.trim() is ''\n\t\t\tthrow new Meteor.Error 'error-invalid-token', 'Invalid token', { method: 'updateOutgoingIntegration' }\n\n\t\tif integration.triggerWords?\n\t\t\tif not Match.test integration.triggerWords, [String]\n\t\t\t\tthrow new Meteor.Error 'error-invalid-triggerWords', 'Invalid triggerWords', { method: 'updateOutgoingIntegration' }\n\n\t\t\tfor triggerWord, index in integration.triggerWords\n\t\t\t\tdelete integration.triggerWords[index] if triggerWord.trim() is ''\n\n\t\t\tintegration.triggerWords = _.without integration.triggerWords, [undefined]\n\n\t\tcurrentIntegration = null\n\n\t\tif RocketChat.authz.hasPermission @userId, 'manage-integrations'\n\t\t\tcurrentIntegration = RocketChat.models.Integrations.findOne(integrationId)\n\t\telse if RocketChat.authz.hasPermission @userId, 'manage-own-integrations'\n\t\t\tcurrentIntegration = RocketChat.models.Integrations.findOne({\"_id\": integrationId, \"_createdBy._id\": @userId})\n\t\telse\n\t\t\tthrow new Meteor.Error 'not_authorized'\n\n\t\tif not currentIntegration?\n\t\t\tthrow new Meteor.Error 'invalid_integration', '[methods] updateOutgoingIntegration -> integration not found'\n\n\t\tif integration.scriptEnabled is true and integration.script? and integration.script.trim() isnt ''\n\t\t\ttry\n\t\t\t\tbabelOptions = Babel.getDefaultOptions()\n\t\t\t\tbabelOptions.externalHelpers = false\n\n\t\t\t\tintegration.scriptCompiled = Babel.compile(integration.script, babelOptions).code\n\t\t\t\tintegration.scriptError = undefined\n\t\t\tcatch e\n\t\t\t\tintegration.scriptCompiled = undefined\n\t\t\t\tintegration.scriptError = _.pick e, 'name', 'message', 'pos', 'loc', 'codeFrame'\n\n\n\t\tfor channel in channels\n\t\t\trecord = undefined\n\t\t\tchannelType = channel[0]\n\t\t\tchannel = channel.substr(1)\n\n\t\t\tswitch channelType\n\t\t\t\twhen '#'\n\t\t\t\t\trecord = RocketChat.models.Rooms.findOne\n\t\t\t\t\t\t$or: [\n\t\t\t\t\t\t\t{_id: channel}\n\t\t\t\t\t\t\t{name: channel}\n\t\t\t\t\t\t]\n\t\t\t\twhen '@'\n\t\t\t\t\trecord = RocketChat.models.Users.findOne\n\t\t\t\t\t\t$or: [\n\t\t\t\t\t\t\t{_id: channel}\n\t\t\t\t\t\t\t{username: channel}\n\t\t\t\t\t\t]\n\n\t\t\tif record is undefined\n\t\t\t\tthrow new Meteor.Error 'error-invalid-room', 'Invalid room', { method: 'updateOutgoingIntegration' }\n\n\t\t\tif record.usernames? and\n\t\t\t(not RocketChat.authz.hasPermission @userId, 'manage-integrations') and\n\t\t\t(RocketChat.authz.hasPermission @userId, 'manage-own-integrations') and\n\t\t\tMeteor.user()?.username not in record.usernames\n\t\t\t\tthrow new Meteor.Error 'error-invalid-channel', 'Invalid Channel', { method: 'updateOutgoingIntegration' }\n\n\t\tuser = RocketChat.models.Users.findOne({username: integration.username})\n\n\t\tif not user?\n\t\t\tthrow new Meteor.Error 'error-invalid-user', 'Invalid user', { method: 'updateOutgoingIntegration' }\n\n\t\tRocketChat.models.Integrations.update integrationId,\n\t\t\t$set:\n\t\t\t\tenabled: integration.enabled\n\t\t\t\tname: integration.name\n\t\t\t\tavatar: integration.avatar\n\t\t\t\temoji: integration.emoji\n\t\t\t\talias: integration.alias\n\t\t\t\tchannel: channels\n\t\t\t\tusername: integration.username\n\t\t\t\tuserId: user._id\n\t\t\t\turls: integration.urls\n\t\t\t\ttoken: integration.token\n\t\t\t\tscript: integration.script\n\t\t\t\tscriptEnabled: integration.scriptEnabled\n\t\t\t\tscriptCompiled: integration.scriptCompiled\n\t\t\t\tscriptError: integration.scriptError\n\t\t\t\ttriggerWords: integration.triggerWords\n\t\t\t\t_updatedAt: new Date\n\t\t\t\t_updatedBy: RocketChat.models.Users.findOne @userId, {fields: {username: 1}}\n\n\t\treturn RocketChat.models.Integrations.findOne(integrationId)\n","Meteor.methods\n\tdeleteOutgoingIntegration: (integrationId) ->\n\t\tintegration = null\n\n\t\tif RocketChat.authz.hasPermission(@userId, 'manage-integrations') or RocketChat.authz.hasPermission(@userId, 'manage-integrations', 'bot')\n\t\t\tintegration = RocketChat.models.Integrations.findOne(integrationId)\n\t\telse if RocketChat.authz.hasPermission(@userId, 'manage-own-integrations') or RocketChat.authz.hasPermission(@userId, 'manage-own-integrations', 'bot')\n\t\t\tintegration = RocketChat.models.Integrations.findOne(integrationId, { fields : {\"_createdBy._id\": @userId} })\n\t\telse\n\t\t\tthrow new Meteor.Error 'not_authorized'\n\n\t\tif not integration?\n\t\t\tthrow new Meteor.Error 'error-invalid-integration', 'Invalid integration', { method: 'deleteOutgoingIntegration' }\n\n\t\tRocketChat.models.Integrations.remove _id: integrationId\n\n\t\treturn true\n","vm = Npm.require('vm')\n\ncompiledScripts = {}\n\ngetIntegrationScript = (integration) ->\n\tcompiledScript = compiledScripts[integration._id]\n\tif compiledScript? and +compiledScript._updatedAt is +integration._updatedAt\n\t\treturn compiledScript.script\n\n\tscript = integration.scriptCompiled\n\tvmScript = undefined\n\tsandbox =\n\t\t_: _\n\t\ts: s\n\t\tconsole: console\n\t\tStore:\n\t\t\tset: (key, val) ->\n\t\t\t\treturn store[key] = val\n\t\t\tget: (key) ->\n\t\t\t\treturn store[key]\n\n\ttry\n\t\tlogger.incoming.info 'will evaluate script'\n\t\tlogger.incoming.debug script\n\n\t\tvmScript = vm.createScript script, 'script.js'\n\n\t\tvmScript.runInNewContext sandbox\n\n\t\tif sandbox.Script?\n\t\t\tcompiledScripts[integration._id] =\n\t\t\t\tscript: new sandbox.Script()\n\t\t\t\t_updatedAt: integration._updatedAt\n\n\t\t\treturn compiledScripts[integration._id].script\n\tcatch e\n\t\tlogger.incoming.error \"[Error evaluating Script:]\"\n\t\tlogger.incoming.error script.replace(/^/gm, '  ')\n\t\tlogger.incoming.error \"[Stack:]\"\n\t\tlogger.incoming.error e.stack.replace(/^/gm, '  ')\n\t\tthrow RocketChat.API.v1.failure 'error-evaluating-script'\n\n\tif not sandbox.Script?\n\t\tthrow RocketChat.API.v1.failure 'class-script-not-found'\n\n\nApi = new Restivus\n\tenableCors: true\n\tapiPath: 'hooks/'\n\tauth:\n\t\tuser: ->\n\t\t\tif @bodyParams?.payload?\n\t\t\t\t@bodyParams = JSON.parse @bodyParams.payload\n\n\t\t\t@integration = RocketChat.models.Integrations.findOne\n\t\t\t\t_id: @request.params.integrationId\n\t\t\t\ttoken: decodeURIComponent @request.params.token\n\n\t\t\tif not @integration?\n\t\t\t\tlogger.incoming.info \"Invalid integration id\", @request.params.integrationId, \"or token\", @request.params.token\n\t\t\t\treturn\n\n\t\t\tuser = RocketChat.models.Users.findOne\n\t\t\t\t_id: @integration.userId\n\n\t\t\treturn user: user\n\n\ncreateIntegration = (options, user) ->\n\tlogger.incoming.info 'Add integration'\n\tlogger.incoming.debug options\n\n\tMeteor.runAsUser user._id, =>\n\t\tswitch options['event']\n\t\t\twhen 'newMessageOnChannel'\n\t\t\t\toptions.data ?= {}\n\n\t\t\t\tif options.data.channel_name? and options.data.channel_name.indexOf('#') is -1\n\t\t\t\t\toptions.data.channel_name = '#' + options.data.channel_name\n\n\t\t\t\tMeteor.call 'addOutgoingIntegration',\n\t\t\t\t\tusername: 'rocket.cat'\n\t\t\t\t\turls: [options.target_url]\n\t\t\t\t\tname: options.name\n\t\t\t\t\tchannel: options.data.channel_name\n\t\t\t\t\ttriggerWords: options.data.trigger_words\n\n\t\t\twhen 'newMessageToUser'\n\t\t\t\tif options.data.username.indexOf('@') is -1\n\t\t\t\t\toptions.data.username = '@' + options.data.username\n\n\t\t\t\tMeteor.call 'addOutgoingIntegration',\n\t\t\t\t\tusername: 'rocket.cat'\n\t\t\t\t\turls: [options.target_url]\n\t\t\t\t\tname: options.name\n\t\t\t\t\tchannel: options.data.username\n\t\t\t\t\ttriggerWords: options.data.trigger_words\n\n\treturn RocketChat.API.v1.success()\n\n\nremoveIntegration = (options, user) ->\n\tlogger.incoming.info 'Remove integration'\n\tlogger.incoming.debug options\n\n\tintegrationToRemove = RocketChat.models.Integrations.findOne urls: options.target_url\n\tMeteor.runAsUser user._id, =>\n\t\tMeteor.call 'deleteOutgoingIntegration', integrationToRemove._id\n\n\treturn RocketChat.API.v1.success()\n\n\nexecuteIntegrationRest = ->\n\tlogger.incoming.info 'Post integration'\n\tlogger.incoming.debug '@urlParams', @urlParams\n\tlogger.incoming.debug '@bodyParams', @bodyParams\n\n\tif @integration.enabled isnt true\n\t\treturn {} =\n\t\t\tstatusCode: 503\n\t\t\tbody: 'Service Unavailable'\n\n\tdefaultValues =\n\t\tchannel: @integration.channel\n\t\talias: @integration.alias\n\t\tavatar: @integration.avatar\n\t\temoji: @integration.emoji\n\n\n\tif @integration.scriptEnabled is true and @integration.scriptCompiled? and @integration.scriptCompiled.trim() isnt ''\n\t\tscript = undefined\n\t\ttry\n\t\t\tscript = getIntegrationScript(@integration)\n\t\tcatch e\n\t\t\treturn e\n\n\t\trequest =\n\t\t\turl:\n\t\t\t\thash: @request._parsedUrl.hash\n\t\t\t\tsearch: @request._parsedUrl.search\n\t\t\t\tquery: @queryParams\n\t\t\t\tpathname: @request._parsedUrl.pathname\n\t\t\t\tpath: @request._parsedUrl.path\n\t\t\turl_raw: @request.url\n\t\t\turl_params: @urlParams\n\t\t\tcontent: @bodyParams\n\t\t\tcontent_raw: @request._readableState?.buffer?.toString()\n\t\t\theaders: @request.headers\n\t\t\tuser:\n\t\t\t\t_id: @user._id\n\t\t\t\tname: @user.name\n\t\t\t\tusername: @user.username\n\n\t\ttry\n\t\t\tresult = script.process_incoming_request({ request: request })\n\n\t\t\tif result?.error?\n\t\t\t\treturn RocketChat.API.v1.failure result.error\n\n\t\t\t@bodyParams = result?.content\n\n\t\t\tlogger.incoming.debug 'result', @bodyParams\n\t\tcatch e\n\t\t\tlogger.incoming.error \"[Error running Script:]\"\n\t\t\tlogger.incoming.error @integration.scriptCompiled.replace(/^/gm, '  ')\n\t\t\tlogger.incoming.error \"[Stack:]\"\n\t\t\tlogger.incoming.error e.stack.replace(/^/gm, '  ')\n\t\t\treturn RocketChat.API.v1.failure 'error-running-script'\n\n\tif not @bodyParams?\n\t\treturn RocketChat.API.v1.failure 'body-empty'\n\n\t@bodyParams.bot =\n\t\ti: @integration._id\n\n\ttry\n\t\tmessage = processWebhookMessage @bodyParams, @user, defaultValues\n\n\t\tif _.isEmpty message\n\t\t\treturn RocketChat.API.v1.failure 'unknown-error'\n\n\t\treturn RocketChat.API.v1.success()\n\tcatch e\n\t\treturn RocketChat.API.v1.failure e.error\n\n\naddIntegrationRest = ->\n\treturn createIntegration @bodyParams, @user\n\n\nremoveIntegrationRest = ->\n\treturn removeIntegration @bodyParams, @user\n\n\nintegrationSampleRest = ->\n\tlogger.incoming.info 'Sample Integration'\n\n\treturn {} =\n\t\tstatusCode: 200\n\t\tbody: [\n\t\t\ttoken: Random.id(24)\n\t\t\tchannel_id: Random.id()\n\t\t\tchannel_name: 'general'\n\t\t\ttimestamp: new Date\n\t\t\tuser_id: Random.id()\n\t\t\tuser_name: 'rocket.cat'\n\t\t\ttext: 'Sample text 1'\n\t\t\ttrigger_word: 'Sample'\n\t\t,\n\t\t\ttoken: Random.id(24)\n\t\t\tchannel_id: Random.id()\n\t\t\tchannel_name: 'general'\n\t\t\ttimestamp: new Date\n\t\t\tuser_id: Random.id()\n\t\t\tuser_name: 'rocket.cat'\n\t\t\ttext: 'Sample text 2'\n\t\t\ttrigger_word: 'Sample'\n\t\t,\n\t\t\ttoken: Random.id(24)\n\t\t\tchannel_id: Random.id()\n\t\t\tchannel_name: 'general'\n\t\t\ttimestamp: new Date\n\t\t\tuser_id: Random.id()\n\t\t\tuser_name: 'rocket.cat'\n\t\t\ttext: 'Sample text 3'\n\t\t\ttrigger_word: 'Sample'\n\t\t]\n\n\nintegrationInfoRest = ->\n\tlogger.incoming.info 'Info integration'\n\n\treturn {} =\n\t\tstatusCode: 200\n\t\tbody:\n\t\t\tsuccess: true\n\n\nRocketChat.API.v1.addRoute 'integrations.create', authRequired: true,\n\tpost: ->\n\t\treturn createIntegration @bodyParams, @user\n\n\nRocketChat.API.v1.addRoute 'integrations.remove', authRequired: true,\n\tpost: ->\n\t\treturn removeIntegration @bodyParams, @user\n\n\nApi.addRoute ':integrationId/:userId/:token', authRequired: true, {post: executeIntegrationRest, get: executeIntegrationRest}\nApi.addRoute ':integrationId/:token', authRequired: true, {post: executeIntegrationRest, get: executeIntegrationRest}\n\nApi.addRoute 'sample/:integrationId/:userId/:token', authRequired: true, {get: integrationSampleRest}\nApi.addRoute 'sample/:integrationId/:token', authRequired: true, {get: integrationSampleRest}\n\nApi.addRoute 'info/:integrationId/:userId/:token', authRequired: true, {get: integrationInfoRest}\nApi.addRoute 'info/:integrationId/:token', authRequired: true, {get: integrationInfoRest}\n\nApi.addRoute 'add/:integrationId/:userId/:token', authRequired: true, {post: addIntegrationRest}\nApi.addRoute 'add/:integrationId/:token', authRequired: true, {post: addIntegrationRest}\n\nApi.addRoute 'remove/:integrationId/:userId/:token', authRequired: true, {post: removeIntegrationRest}\nApi.addRoute 'remove/:integrationId/:token', authRequired: true, {post: removeIntegrationRest}\n","vm = Npm.require('vm')\n\ncompiledScripts = {}\n\ngetIntegrationScript = (integration) ->\n\tcompiledScript = compiledScripts[integration._id]\n\tif compiledScript? and +compiledScript._updatedAt is +integration._updatedAt\n\t\treturn compiledScript.script\n\n\tscript = integration.scriptCompiled\n\tvmScript = undefined\n\tstore = {}\n\tsandbox =\n\t\t_: _\n\t\ts: s\n\t\tconsole: console\n\t\tStore:\n\t\t\tset: (key, val) ->\n\t\t\t\treturn store[key] = val\n\t\t\tget: (key) ->\n\t\t\t\treturn store[key]\n\t\tHTTP: (method, url, options) ->\n\t\t\ttry\n\t\t\t\treturn {} =\n\t\t\t\t\tresult: HTTP.call method, url, options\n\t\t\tcatch e\n\t\t\t\treturn {} =\n\t\t\t\t\terror: e\n\n\ttry\n\t\tlogger.outgoing.info 'will evaluate script'\n\t\tlogger.outgoing.debug script\n\n\t\tvmScript = vm.createScript script, 'script.js'\n\n\t\tvmScript.runInNewContext sandbox\n\n\t\tif sandbox.Script?\n\t\t\tcompiledScripts[integration._id] =\n\t\t\t\tscript: new sandbox.Script()\n\t\t\t\t_updatedAt: integration._updatedAt\n\n\t\t\treturn compiledScripts[integration._id].script\n\tcatch e\n\t\tlogger.outgoing.error \"[Error evaluating Script:]\"\n\t\tlogger.outgoing.error script.replace(/^/gm, '  ')\n\t\tlogger.outgoing.error \"[Stack:]\"\n\t\tlogger.outgoing.error e.stack.replace(/^/gm, '  ')\n\t\tthrow new Meteor.Error 'error-evaluating-script'\n\n\tif not sandbox.Script?\n\t\tlogger.outgoing.error \"[Class 'Script' not found]\"\n\t\tthrow new Meteor.Error 'class-script-not-found'\n\n\ntriggers = {}\n\nhasScriptAndMethod = (integration, method) ->\n\tif integration.scriptEnabled isnt true or not integration.scriptCompiled? or integration.scriptCompiled.trim() is ''\n\t\treturn false\n\n\tscript = undefined\n\ttry\n\t\tscript = getIntegrationScript(integration)\n\tcatch e\n\t\treturn\n\n\treturn script[method]?\n\nexecuteScript = (integration, method, params) ->\n\tscript = undefined\n\ttry\n\t\tscript = getIntegrationScript(integration)\n\tcatch e\n\t\treturn\n\n\tif not script[method]?\n\t\tlogger.outgoing.error \"[Method '#{method}' not found]\"\n\t\treturn\n\n\ttry\n\t\tresult = script[method](params)\n\n\t\tlogger.outgoing.debug 'result', result\n\n\t\treturn result\n\tcatch e\n\t\tlogger.incoming.error \"[Error running Script:]\"\n\t\tlogger.incoming.error integration.scriptCompiled.replace(/^/gm, '  ')\n\t\tlogger.incoming.error \"[Stack:]\"\n\t\tlogger.incoming.error e.stack.replace(/^/gm, '  ')\n\t\treturn\n\n\nRocketChat.models.Integrations.find({type: 'webhook-outgoing'}).observe\n\tadded: (record) ->\n\t\tif _.isEmpty(record.channel)\n\t\t\tchannels = [ '__any' ]\n\t\telse\n\t\t\tchannels = [].concat(record.channel)\n\n\t\tfor channel in channels\n\t\t\ttriggers[channel] ?= {}\n\t\t\ttriggers[channel][record._id] = record\n\n\tchanged: (record) ->\n\t\tif _.isEmpty(record.channel)\n\t\t\tchannels = [ '__any' ]\n\t\telse\n\t\t\tchannels = [].concat(record.channel)\n\n\t\tfor channel in channels\n\t\t\ttriggers[channel] ?= {}\n\t\t\ttriggers[channel][record._id] = record\n\n\tremoved: (record) ->\n\t\tif _.isEmpty(record.channel)\n\t\t\tchannels = [ '__any' ]\n\t\telse\n\t\t\tchannels = [].concat(record.channel)\n\n\t\tfor channel in channels\n\t\t\tdelete triggers[channel][record._id]\n\n\nExecuteTriggerUrl = (url, trigger, message, room, tries=0) ->\n\tword = undefined\n\tif trigger.triggerWords?.length > 0\n\t\tfor triggerWord in trigger.triggerWords\n\t\t\tif message.msg.indexOf(triggerWord) is 0\n\t\t\t\tword = triggerWord\n\t\t\t\tbreak\n\n\t\t# Stop if there are triggerWords but none match\n\t\tif not word?\n\t\t\treturn\n\n\tdata =\n\t\ttoken: trigger.token\n\t\tchannel_id: room._id\n\t\tchannel_name: room.name\n\t\ttimestamp: message.ts\n\t\tuser_id: message.u._id\n\t\tuser_name: message.u.username\n\t\ttext: message.msg\n\n\tif message.alias?\n\t\tdata.alias = message.alias\n\n\tif message.bot?\n\t\tdata.bot = message.bot\n\telse\n\t\tdata.bot = false\n\n\tif word?\n\t\tdata.trigger_word = word\n\n\tsendMessage = (message) ->\n\t\tuser = RocketChat.models.Users.findOneByUsername(trigger.username)\n\n\t\tmessage.bot =\n\t\t\ti: trigger._id\n\n\t\tdefaultValues =\n\t\t\talias: trigger.alias\n\t\t\tavatar: trigger.avatar\n\t\t\temoji: trigger.emoji\n\n\t\tif room.t is 'd'\n\t\t\tmessage.channel = '@'+room._id\n\t\telse\n\t\t\tmessage.channel = '#'+room._id\n\n\t\tmessage = processWebhookMessage message, user, defaultValues\n\n\n\topts =\n\t\tparams: {}\n\t\tmethod: 'POST'\n\t\turl: url\n\t\tdata: data\n\t\tauth: undefined\n\t\tnpmRequestOptions:\n\t\t\trejectUnauthorized: !RocketChat.settings.get 'Allow_Invalid_SelfSigned_Certs'\n\t\t\tstrictSSL: !RocketChat.settings.get 'Allow_Invalid_SelfSigned_Certs'\n\t\theaders:\n\t\t\t'User-Agent': 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2227.0 Safari/537.36'\n\n\tif hasScriptAndMethod(trigger, 'prepare_outgoing_request')\n\t\tsandbox =\n\t\t\trequest: opts\n\n\t\topts = executeScript trigger, 'prepare_outgoing_request', sandbox\n\n\tif not opts?\n\t\treturn\n\n\tif opts.message?\n\t\tsendMessage opts.message\n\n\tif not opts.url? or not opts.method?\n\t\treturn\n\n\tHTTP.call opts.method, opts.url, opts, (error, result) ->\n\t\tscriptResult = undefined\n\t\tif hasScriptAndMethod(trigger, 'process_outgoing_response')\n\t\t\tsandbox =\n\t\t\t\trequest: opts\n\t\t\t\tresponse:\n\t\t\t\t\terror: error\n\t\t\t\t\tstatus_code: result.statusCode\n\t\t\t\t\tcontent: result.data\n\t\t\t\t\tcontent_raw: result.content\n\t\t\t\t\theaders: result.headers\n\n\t\t\tscriptResult = executeScript trigger, 'process_outgoing_response', sandbox\n\n\t\t\tif scriptResult?.content\n\t\t\t\tsendMessage scriptResult.content\n\t\t\t\treturn\n\n\t\t\tif scriptResult is false\n\t\t\t\treturn\n\n\t\tif not result? or result.statusCode not in [200, 201, 202]\n\t\t\tif error?\n\t\t\t\tlogger.outgoing.error error\n\t\t\tif result?\n\t\t\t\tlogger.outgoing.error result\n\n\t\t\tif result.statusCode is 410\n\t\t\t\tRocketChat.models.Integrations.remove _id: trigger._id\n\t\t\t\treturn\n\n\t\t\tif result.statusCode is 500\n\t\t\t\tlogger.outgoing.error 'Request Error [500]', url\n\t\t\t\tlogger.outgoing.error result.content\n\t\t\t\treturn\n\n\t\t\tif tries <= 6\n\t\t\t\t# Try again in 0.1s, 1s, 10s, 1m40s, 16m40s, 2h46m40s and 27h46m40s\n\t\t\t\tMeteor.setTimeout ->\n\t\t\t\t\tExecuteTriggerUrl url, trigger, message, room, tries+1\n\t\t\t\t, Math.pow(10, tries+2)\n\n\t\t\treturn\n\n\t\t# process outgoing webhook response as a new message\n\t\tif result?.statusCode in [200, 201, 202]\n\t\t\tif result?.data?.text? or result?.data?.attachments?\n\t\t\t\tsendMessage result.data\n\n\nExecuteTrigger = (trigger, message, room) ->\n\tfor url in trigger.urls\n\t\tExecuteTriggerUrl url, trigger, message, room\n\n\nExecuteTriggers = (message, room) ->\n\tif not room?\n\t\treturn\n\n\ttriggersToExecute = []\n\n\tswitch room.t\n\t\twhen 'd'\n\t\t\tid = room._id.replace(message.u._id, '')\n\n\t\t\tusername = _.without room.usernames, message.u.username\n\t\t\tusername = username[0]\n\n\t\t\tif triggers['@'+id]?\n\t\t\t\ttriggersToExecute.push trigger for key, trigger of triggers['@'+id]\n\n\t\t\tif id isnt username and triggers['@'+username]?\n\t\t\t\ttriggersToExecute.push trigger for key, trigger of triggers['@'+username]\n\n\t\twhen 'c'\n\t\t\tif triggers.__any?\n\t\t\t\ttriggersToExecute.push trigger for key, trigger of triggers.__any\n\n\t\t\tif triggers['#'+room._id]?\n\t\t\t\ttriggersToExecute.push trigger for key, trigger of triggers['#'+room._id]\n\n\t\t\tif room._id isnt room.name and triggers['#'+room.name]?\n\t\t\t\ttriggersToExecute.push trigger for key, trigger of triggers['#'+room.name]\n\n\t\telse\n\t\t\tif triggers['#'+room._id]?\n\t\t\t\ttriggersToExecute.push trigger for key, trigger of triggers['#'+room._id]\n\n\t\t\tif room._id isnt room.name and triggers['#'+room.name]?\n\t\t\t\ttriggersToExecute.push trigger for key, trigger of triggers['#'+room.name]\n\n\n\tfor triggerToExecute in triggersToExecute\n\t\tif triggerToExecute.enabled is true\n\t\t\tExecuteTrigger triggerToExecute, message, room\n\n\treturn message\n\n\nRocketChat.callbacks.add 'afterSaveMessage', ExecuteTriggers, RocketChat.callbacks.priority.LOW, 'ExecuteTriggers'\n","this.processWebhookMessage = function(messageObj, user, defaultValues) {\n\tvar attachment, channel, channels, channelType, i, len, message, ref, rid, room, roomUser, ret;\n\tret = [];\n\n\tif (!defaultValues) {\n\t\tdefaultValues = {\n\t\t\tchannel: '',\n\t\t\talias: '',\n\t\t\tavatar: '',\n\t\t\temoji: ''\n\t\t};\n\t}\n\n\tchannel = messageObj.channel || defaultValues.channel;\n\n\tchannels = [].concat(channel);\n\n\tfor (channel of channels) {\n\t\tchannelType = channel[0];\n\n\t\tchannel = channel.substr(1);\n\n\t\tswitch (channelType) {\n\t\t\tcase '#':\n\t\t\t\troom = RocketChat.models.Rooms.findOne({\n\t\t\t\t\t$or: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t_id: channel\n\t\t\t\t\t\t}, {\n\t\t\t\t\t\t\tname: channel\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t});\n\t\t\t\tif (!_.isObject(room)) {\n\t\t\t\t\tthrow new Meteor.Error('invalid-channel');\n\t\t\t\t}\n\t\t\t\trid = room._id;\n\t\t\t\tif (room.t === 'c') {\n\t\t\t\t\tMeteor.runAsUser(user._id, function() {\n\t\t\t\t\t\treturn Meteor.call('joinRoom', room._id);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase '@':\n\t\t\t\troomUser = RocketChat.models.Users.findOne({\n\t\t\t\t\t$or: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t_id: channel\n\t\t\t\t\t\t}, {\n\t\t\t\t\t\t\tusername: channel\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}) || {};\n\t\t\t\trid = [user._id, roomUser._id].sort().join('');\n\t\t\t\troom = RocketChat.models.Rooms.findOne({\n\t\t\t\t\t_id: {\n\t\t\t\t\t\t$in: [rid, channel]\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tif (!_.isObject(roomUser) && !_.isObject(room)) {\n\t\t\t\t\tthrow new Meteor.Error('invalid-channel');\n\t\t\t\t}\n\t\t\t\tif (!room) {\n\t\t\t\t\tMeteor.runAsUser(user._id, function() {\n\t\t\t\t\t\tMeteor.call('createDirectMessage', roomUser.username);\n\t\t\t\t\t\troom = RocketChat.models.Rooms.findOne(rid);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tthrow new Meteor.Error('invalid-channel-type');\n\t\t}\n\n\t\tif (messageObj.attachments && !_.isArray(messageObj.attachments)) {\n\t\t\tconsole.log('Attachments should be Array, ignoring value'.red, messageObj.attachments);\n\t\t\tmessageObj.attachments = undefined;\n\t\t}\n\n\t\tmessage = {\n\t\t\talias: messageObj.username || messageObj.alias || defaultValues.alias,\n\t\t\tmsg: _.trim(messageObj.text || messageObj.msg || ''),\n\t\t\tattachments: messageObj.attachments,\n\t\t\tparseUrls: messageObj.parseUrls !== undefined ? messageObj.parseUrls : !messageObj.attachments,\n\t\t\tbot: messageObj.bot,\n\t\t\tgroupable: false\n\t\t};\n\n\t\tif (!_.isEmpty(messageObj.icon_url) || !_.isEmpty(messageObj.avatar)) {\n\t\t\tmessage.avatar = messageObj.icon_url || messageObj.avatar;\n\t\t} else if (!_.isEmpty(messageObj.icon_emoji) || !_.isEmpty(messageObj.emoji)) {\n\t\t\tmessage.emoji = messageObj.icon_emoji || messageObj.emoji;\n\t\t} else if (!_.isEmpty(defaultValues.avatar)) {\n\t\t\tmessage.avatar = defaultValues.avatar;\n\t\t} else if (!_.isEmpty(defaultValues.emoji)) {\n\t\t\tmessage.emoji = defaultValues.emoji;\n\t\t}\n\n\t\tif (_.isArray(message.attachments)) {\n\t\t\tref = message.attachments;\n\t\t\tfor (i = 0, len = ref.length; i < len; i++) {\n\t\t\t\tattachment = ref[i];\n\t\t\t\tif (attachment.msg) {\n\t\t\t\t\tattachment.text = _.trim(attachment.msg);\n\t\t\t\t\tdelete attachment.msg;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tvar messageReturn = RocketChat.sendMessage(user, message, room);\n\t\tret.push({ channel: channel, message: messageReturn });\n\t}\n\treturn ret;\n};\n"]}