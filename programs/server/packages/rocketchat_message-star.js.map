{"version":3,"sources":["meteor://ğŸ’»app/packages/rocketchat_message-star/server/settings.coffee","meteor://ğŸ’»app/packages/rocketchat_message-star/server/starMessage.coffee","meteor://ğŸ’»app/packages/rocketchat_message-star/server/publications/starredMessages.coffee","meteor://ğŸ’»app/packages/rocketchat_message-star/server/startup/indexes.coffee"],"names":[],"mappings":"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","file":"/packages/rocketchat_message-star.js","sourcesContent":["Meteor.startup ->\n\tRocketChat.settings.add 'Message_AllowStarring', true, { type: 'boolean', group: 'Message', public: true }\n","Meteor.methods\n\tstarMessage: (message) ->\n\t\tif not Meteor.userId()\n\t\t\tthrow new Meteor.Error('error-invalid-user', \"Invalid user\", { method: 'starMessage' })\n\n\t\tif not RocketChat.settings.get 'Message_AllowStarring'\n\t\t\tthrow new Meteor.Error 'error-action-not-allowed', 'Message starring not allowed', { method: 'pinMessage', action: 'Message_starring' }\n\n\t\troom = RocketChat.models.Rooms.findOne({ _id: message.rid })\n\n\t\tif Array.isArray(room.usernames) && room.usernames.indexOf(Meteor.user().username) is -1\n\t\t\treturn false\n\n\t\tRocketChat.models.Messages.updateUserStarById(message._id, Meteor.userId(), message.starred)\n","Meteor.publish 'starredMessages', (rid, limit=50) ->\n\tunless this.userId\n\t\treturn this.ready()\n\n\tpublication = @\n\n\tuser = RocketChat.models.Users.findOneById this.userId\n\tunless user\n\t\treturn this.ready()\n\n\tcursorHandle = RocketChat.models.Messages.findStarredByUserAtRoom(this.userId, rid, { sort: { ts: -1 }, limit: limit }).observeChanges\n\t\tadded: (_id, record) ->\n\t\t\tpublication.added('rocketchat_starred_message', _id, record)\n\n\t\tchanged: (_id, record) ->\n\t\t\tpublication.changed('rocketchat_starred_message', _id, record)\n\n\t\tremoved: (_id) ->\n\t\t\tpublication.removed('rocketchat_starred_message', _id)\n\n\t@ready()\n\t@onStop ->\n\t\tcursorHandle.stop()\n","Meteor.startup ->\n\tMeteor.defer ->\n\t\tRocketChat.models.Messages.tryEnsureIndex { 'starred._id': 1 }, { sparse: 1 }\n"]}