{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat_channel-settings/server/functions/saveRoomType.coffee","meteor://ðŸ’»app/packages/rocketchat_channel-settings/server/functions/saveRoomTopic.coffee","meteor://ðŸ’»app/packages/rocketchat_channel-settings/server/functions/saveRoomName.coffee","meteor://ðŸ’»app/packages/rocketchat_channel-settings/server/functions/saveRoomDescription.coffee","meteor://ðŸ’»app/packages/rocketchat_channel-settings/server/methods/saveRoomSettings.coffee","meteor://ðŸ’»app/packages/rocketchat_channel-settings/server/models/Messages.coffee","meteor://ðŸ’»app/packages/rocketchat_channel-settings/server/models/Rooms.coffee"],"names":[],"mappings":"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","file":"/packages/rocketchat_channel-settings.js","sourcesContent":["RocketChat.saveRoomType = (rid, roomType) ->\n\tunless Match.test rid, String\n\t\tthrow new Meteor.Error 'invalid-room', 'Invalid room', { function: 'RocketChat.saveRoomType' }\n\n\tif roomType not in ['c', 'p']\n\t\tthrow new Meteor.Error 'error-invalid-room-type', 'error-invalid-room-type', { type: roomType }\n\n\treturn RocketChat.models.Rooms.setTypeById(rid, roomType) and RocketChat.models.Subscriptions.updateTypeByRoomId(rid, roomType)\n","RocketChat.saveRoomTopic = (rid, roomTopic, user) ->\n\tunless Match.test rid, String\n\t\tthrow new Meteor.Error 'invalid-room', 'Invalid room', { function: 'RocketChat.saveRoomTopic' }\n\n\troomTopic = s.escapeHTML(roomTopic)\n\n\tupdate = RocketChat.models.Rooms.setTopicById(rid, roomTopic)\n\n\tRocketChat.models.Messages.createRoomSettingsChangedWithTypeRoomIdMessageAndUser 'room_changed_topic', rid, roomTopic, user\n\n\treturn update\n","RocketChat.saveRoomName = (rid, name) ->\n\tif not Meteor.userId()\n\t\tthrow new Meteor.Error('error-invalid-user', \"Invalid user\", { function: 'RocketChat.saveRoomName' })\n\n\troom = RocketChat.models.Rooms.findOneById rid\n\n\tif room.t not in ['c', 'p']\n\t\tthrow new Meteor.Error 'error-not-allowed', 'Not allowed', { function: 'RocketChat.saveRoomName' }\n\n\tunless RocketChat.authz.hasPermission(Meteor.userId(), 'edit-room', rid)\n\t\tthrow new Meteor.Error 'error-not-allowed', 'Not allowed', { function: 'RocketChat.saveRoomName' }\n\n\ttry\n\t\tnameValidation = new RegExp '^' + RocketChat.settings.get('UTF8_Names_Validation') + '$'\n\tcatch\n\t\tnameValidation = new RegExp '^[0-9a-zA-Z-_.]+$'\n\n\tif not nameValidation.test name\n\t\tthrow new Meteor.Error 'error-invalid-room-name', name + ' is not a valid room name. Use only letters, numbers, hyphens and underscores', { function: 'RocketChat.saveRoomName', room_name: name }\n\n\n\t# name = _.slugify name\n\n\tif name is room.name\n\t\treturn\n\n\t# avoid duplicate names\n\tif RocketChat.models.Rooms.findOneByName name\n\t\tthrow new Meteor.Error 'error-duplicate-channel-name', 'A channel with name \\'' + name + '\\' exists', { function: 'RocketChat.saveRoomName', channel_name: name }\n\n\tRocketChat.models.Rooms.setNameById rid, name\n\tRocketChat.models.Subscriptions.updateNameAndAlertByRoomId rid, name\n\n\treturn name\n","RocketChat.saveRoomDescription = (rid, roomDescription, user) ->\n\tunless Match.test rid, String\n\t\tthrow new Meteor.Error 'invalid-room', 'Invalid room', { function: 'RocketChat.saveRoomDescription' }\n\n\troomDescription = s.escapeHTML(roomDescription)\n\n\tupdate = RocketChat.models.Rooms.setDescriptionById rid, roomDescription\n\n\tRocketChat.models.Messages.createRoomSettingsChangedWithTypeRoomIdMessageAndUser 'room_changed_description', rid, roomDescription, user\n\n\treturn update\n","Meteor.methods\n\tsaveRoomSettings: (rid, setting, value) ->\n\t\tunless Match.test rid, String\n\t\t\tthrow new Meteor.Error 'error-invalid-room', 'Invalid room', { method: 'saveRoomSettings' }\n\n\t\tif setting not in ['roomName', 'roomTopic', 'roomDescription', 'roomType', 'default']\n\t\t\tthrow new Meteor.Error 'error-invalid-settings', 'Invalid settings provided', { method: 'saveRoomSettings' }\n\n\t\tunless RocketChat.authz.hasPermission(Meteor.userId(), 'edit-room', rid)\n\t\t\tthrow new Meteor.Error 'error-action-not-allowed', 'Editing room is not allowed', { method: 'saveRoomSettings', action: 'Editing_room' }\n\n\t\tif setting is 'default' and not RocketChat.authz.hasPermission(@userId, 'view-room-administration')\n\t\t\tthrow new Meteor.Error 'error-action-not-allowed', 'Viewing room administration is not allowed', { method: 'saveRoomSettings', action: 'Viewing_room_administration' }\n\n\t\troom = RocketChat.models.Rooms.findOneById rid\n\t\tif room?\n\t\t\tswitch setting\n\t\t\t\twhen 'roomName'\n\t\t\t\t\tname = RocketChat.saveRoomName rid, value\n\t\t\t\t\tRocketChat.models.Messages.createRoomRenamedWithRoomIdRoomNameAndUser rid, name, Meteor.user()\n\t\t\t\twhen 'roomTopic'\n\t\t\t\t\tif value isnt room.topic\n\t\t\t\t\t\tRocketChat.saveRoomTopic(rid, value, Meteor.user())\n\t\t\t\twhen 'roomDescription'\n\t\t\t\t\tif value isnt room.description\n\t\t\t\t\t\tRocketChat.saveRoomDescription rid, value, Meteor.user()\n\t\t\t\twhen 'roomType'\n\t\t\t\t\tif value isnt room.t\n\t\t\t\t\t\tRocketChat.saveRoomType(rid, value, Meteor.user())\n\t\t\t\t\t\tif value is 'c'\n\t\t\t\t\t\t\tmessage = TAPi18n.__('Channel')\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tmessage = TAPi18n.__('Private_Group')\n\t\t\t\t\t\tRocketChat.models.Messages.createRoomSettingsChangedWithTypeRoomIdMessageAndUser 'room_changed_privacy', rid, message, Meteor.user()\n\t\t\t\twhen 'default'\n\t\t\t\t\tRocketChat.models.Rooms.saveDefaultById rid, value\n\n\t\treturn { result: true, rid: room._id }\n","RocketChat.models.Messages.createRoomSettingsChangedWithTypeRoomIdMessageAndUser = (type, roomId, message, user, extraData) ->\n\treturn @createWithTypeRoomIdMessageAndUser type, roomId, message, user, extraData\n\nRocketChat.models.Messages.createRoomRenamedWithRoomIdRoomNameAndUser = (roomId, roomName, user, extraData) ->\n\treturn @createWithTypeRoomIdMessageAndUser 'r', roomId, roomName, user, extraData\n","RocketChat.models.Rooms.setDescriptionById = (_id, description) ->\n\tquery =\n\t\t_id: _id\n\n\tupdate =\n\t\t$set:\n\t\t\tdescription: description\n\n\treturn @update query, update\n"]}