{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat_message-mark-as-unread/server/logger.js","meteor://ðŸ’»app/packages/rocketchat_message-mark-as-unread/server/unreadMessages.coffee"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uH;;;;;;;;;;;;;;;;;;;ACTA,MAAM,CAAC,OAAP,CACC;AAAA,kBAAgB,SAAC,kBAAD;AACf;AAAA,QAAG,OAAU,CAAC,MAAP,EAAP;AACC,YAAU,UAAM,CAAC,KAAP,CAAa,oBAAb,EAAmC,cAAnC,EAAmD;AAAA,QAAE,QAAQ,gBAAV;OAAnD,CAAV,CADD;KAAA;AAAA,IAGA,kBAAkB,UAAU,CAAC,MAAM,CAAC,QAAQ,CAAC,WAA3B,CAAuC,kBAAkB,CAAC,GAA1D,EAA+D;AAAA,MAAC,QAAQ;AAAA,QAAC,GAAG,CAAJ;AAAA,QAAO,KAAK,CAAZ;AAAA,QAAe,MAAM,CAArB;AAAA,QAAwB,IAAI,CAA5B;OAAT;KAA/D,CAHlB;AAIA,QAAO,uBAAP;AACC,YAAU,UAAM,CAAC,KAAP,CAAa,0BAAb,EAAyC,aAAzC,EAAwD;AAAA,QAAE,QAAQ,gBAAV;AAAA,QAA4B,QAAQ,iBAApC;OAAxD,CAAV,CADD;KAJA;AAOA,QAAG,MAAM,CAAC,MAAP,OAAmB,eAAe,CAAC,CAAC,CAAC,GAAxC;AACC,YAAU,UAAM,CAAC,KAAP,CAAa,0BAAb,EAAyC,aAAzC,EAAwD;AAAA,QAAE,QAAQ,gBAAV;AAAA,QAA4B,QAAQ,iBAApC;OAAxD,CAAV,CADD;KAPA;AAAA,IAUA,WAAW,UAAU,CAAC,MAAM,CAAC,aAAa,CAAC,wBAAhC,CAAyD,eAAe,CAAC,GAAzE,EAA8E,MAAM,CAAC,MAAP,EAA9E,CAA8F,CAAC,EAV1G;AAWA,QAAG,kBAAkB,CAAC,EAAnB,IAAyB,QAA5B;AACC,YAAM,CAAC,UAAU,CAAC,KAAlB,CAAwB,8CAAxB;AACA,aAFD;KAXA;AAAA,IAeA,MAAM,CAAC,UAAU,CAAC,KAAlB,CAAwB,iCAAiC,eAAe,CAAC,EAAjD,GAAsD,sBAA9E,CAfA;WAgBA,UAAU,CAAC,MAAM,CAAC,aAAa,CAAC,4BAAhC,CAA6D,eAAe,CAAC,GAA7E,EAAkF,MAAM,CAAC,MAAP,EAAlF,EAAmG,eAAe,CAAC,EAAnH,EAjBe;EAAA,CAAhB;CADD","file":"/packages/rocketchat_message-mark-as-unread.js","sourcesContent":["/* globals logger:true */\n/* exported logger */\n\nlogger = new Logger('MessageMarkAsUnread', {\n\tsections: {\n\t\tconnection: 'Connection',\n\t\tevents: 'Events'\n\t}\n});\n","Meteor.methods\n\tunreadMessages: (firstUnreadMessage) ->\n\t\tif not Meteor.userId()\n\t\t\tthrow new Meteor.Error 'error-invalid-user', 'Invalid user', { method: 'unreadMessages' }\n\n\t\toriginalMessage = RocketChat.models.Messages.findOneById firstUnreadMessage._id, {fields: {u: 1, rid: 1, file: 1, ts: 1}}\n\t\tif not originalMessage?\n\t\t\tthrow new Meteor.Error 'error-action-not-allowed', 'Not allowed', { method: 'unreadMessages', action: 'Unread_messages' }\n\n\t\tif Meteor.userId() is originalMessage.u._id\n\t\t\tthrow new Meteor.Error 'error-action-not-allowed', 'Not allowed', { method: 'unreadMessages', action: 'Unread_messages' }\n\n\t\tlastSeen = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(originalMessage.rid, Meteor.userId()).ls\n\t\tif firstUnreadMessage.ts >= lastSeen\n\t\t\tlogger.connection.debug('Provided message is already marked as unread')\n\t\t\treturn\n\n\t\tlogger.connection.debug('Updating unread  message of ' + originalMessage.ts + ' as the first unread')\n\t\tRocketChat.models.Subscriptions.setAsUnreadByRoomIdAndUserId(originalMessage.rid, Meteor.userId(), originalMessage.ts)\n"]}