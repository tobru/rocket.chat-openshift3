{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat_spotify/lib/spotify.coffee"],"names":[],"mappings":"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","file":"/packages/rocketchat_spotify.js","sourcesContent":["###\n# Spotify a named function that will process Spotify links or syntaxes (ex: spotify:track:1q6IK1l4qpYykOaWaLJkWG)\n# @param {Object} message - The message object\n###\n\nclass Spotify\n\tprocess = (message, source, callback) ->\n\t\tif _.trim source\n\t\t\t# Separate text in code blocks and non code blocks\n\t\t\tmsgParts = source.split /(```\\w*[\\n ]?[\\s\\S]*?```+?)|(`(?:[^`]+)`)/\n\n\t\t\tfor part, index in msgParts\n\t\t\t\t# Verify if this part is code\n\t\t\t\tif part?.length? > 0\n\t\t\t\t\tcodeMatch = part.match /(?:```(\\w*)[\\n ]?([\\s\\S]*?)```+?)|(?:`(?:[^`]+)`)/\n\t\t\t\t\tif not codeMatch?\n\t\t\t\t\t\tcallback message, msgParts, index, part\n\n\t@transform: (message) ->\n\t\turls = []\n\t\tif Array.isArray message.urls\n\t\t\turls = urls.concat message.urls\n\n\t\tchanged = false\n\n\t\tprocess message, message.msg, (message, msgParts, index, part) ->\n\t\t\tre = /(?:^|\\s)spotify:([^:\\s]+):([^:\\s]+)(?::([^:\\s]+))?(?::(\\S+))?(?:\\s|$)/g\n\t\t\twhile match = re.exec(part)\n\t\t\t\tdata = _.filter match.slice(1), (value) ->\n\t\t\t\t\treturn value?\n\t\t\t\tpath = _.map data, (value) ->\n\t\t\t\t\treturn _.escape(value)\n\t\t\t\t.join '/'\n\t\t\t\turl = 'https://open.spotify.com/' + path\n\t\t\t\turls.push {'url': url, 'source': 'spotify:' + data.join ':'}\n\t\t\t\tchanged = true\n\n\t\t# Re-mount message\n\t\tif changed\n\t\t\tmessage.urls = urls\n\n\t\treturn message\n\n\t@render: (message) ->\n\t\tprocess message, message.html, (message, msgParts, index, part) ->\n\t\t\tif Array.isArray message.urls\n\t\t\t\tfor item in message.urls\n\t\t\t\t\tif item.source\n\t\t\t\t\t\tquotedSource = item.source.replace /[\\\\^$.*+?()[\\]{}|]/g, '\\\\$&'\n\t\t\t\t\t\tre = new RegExp '(^|\\\\s)' + quotedSource + '(\\\\s|$)', 'g'\n\t\t\t\t\t\tmsgParts[index] = part.replace re, '$1<a href=\"' + item.url + '\" target=\"_blank\">' + item.source + '</a>$2'\n\t\t\t\tmessage.html = msgParts.join ''\n\n\t\treturn message\n\nRocketChat.callbacks.add 'beforeSaveMessage', Spotify.transform, RocketChat.callbacks.priority.LOW\nRocketChat.callbacks.add 'renderMessage', Spotify.render\nRocketChat.Spotify = Spotify\n"]}