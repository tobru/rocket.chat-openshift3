{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat_mentions/server.coffee"],"names":[],"mappings":"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","file":"/packages/rocketchat_mentions.js","sourcesContent":["###\n# Mentions is a named function that will process Mentions\n# @param {Object} message - The message object\n###\n\nclass MentionsServer\n\tconstructor: (message) ->\n\t\t# If message starts with /me, replace it for text formatting\n\t\tmentions = []\n\t\tmsgMentionRegex = new RegExp '(?:^|\\\\s|\\\\n)(?:@)(' + RocketChat.settings.get('UTF8_Names_Validation') + ')', 'g'\n\t\tmessage.msg.replace msgMentionRegex, (match, mention) ->\n\t\t\tmentions.push mention\n\t\tif mentions.length isnt 0\n\t\t\tmentions = _.unique mentions\n\t\t\tverifiedMentions = []\n\t\t\tmentions.forEach (mention) ->\n\t\t\t\tif mention is 'all'\n\t\t\t\t\tmessageMaxAll = RocketChat.settings.get('Message_MaxAll')\n\t\t\t\t\tif messageMaxAll > 0\n\t\t\t\t\t\tallChannel = RocketChat.models.Rooms.findOneById message.rid\n\t\t\t\t\t\tif allChannel.usernames.length <= messageMaxAll\n\t\t\t\t\t\t\tverifiedMention =\n\t\t\t\t\t\t\t\t_id: mention\n\t\t\t\t\t\t\t\tusername: mention\n\t\t\t\t\telse\n\t\t\t\t\t\tverifiedMention =\n\t\t\t\t\t\t\t_id: mention\n\t\t\t\t\t\t\tusername: mention\n\t\t\t\telse\n\t\t\t\t\tverifiedMention = Meteor.users.findOne({username: mention}, {fields: {_id: 1, username: 1}})\n\n\t\t\t\tverifiedMentions.push verifiedMention if verifiedMention?\n\t\t\tif verifiedMentions.length isnt 0\n\t\t\t\tmessage.mentions = verifiedMentions\n\n\t\tchannels = []\n\t\tmsgChannelRegex = new RegExp '(?:^|\\\\s|\\\\n)(?:#)(' + RocketChat.settings.get('UTF8_Names_Validation') + ')', 'g'\n\t\tmessage.msg.replace msgChannelRegex, (match, mention) ->\n\t\t\tchannels.push mention\n\n\t\tif channels.length isnt 0\n\t\t\tchannels = _.unique channels\n\t\t\tverifiedChannels = []\n\t\t\tchannels.forEach (mention) ->\n\t\t\t\tverifiedChannel = RocketChat.models.Rooms.findOneByNameAndType(mention, 'c', { fields: {_id: 1, name: 1 } })\n\t\t\t\tverifiedChannels.push verifiedChannel if verifiedChannel?\n\n\t\t\tif verifiedChannels.length isnt 0\n\t\t\t\tmessage.channels = verifiedChannels\n\t\treturn message\n\nRocketChat.callbacks.add 'beforeSaveMessage', MentionsServer, RocketChat.callbacks.priority.HIGH\n"]}