{"version":3,"sources":["meteor://ðŸ’»app/cas_rocketchat.js","meteor://ðŸ’»app/cas_server.js"],"names":[],"mappings":"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","file":"/packages/rocketchat_cas.js","sourcesContent":["/* globals logger:true */\n\nlogger = new Logger('CAS', {});\n\nMeteor.startup(function() {\n\tRocketChat.settings.addGroup('CAS', function() {\n\t\tthis.add('CAS_enabled', false, { type: 'boolean', group: 'CAS', public: true });\n\t\tthis.add('CAS_base_url', '', { type: 'string', group: 'CAS', public: true });\n\t\tthis.add('CAS_login_url', '', { type: 'string', group: 'CAS', public: true });\n\t\tthis.add('CAS_version', '1.0', { type: 'select', values: [{ key: '1.0', i18nLabel: '1.0'}], group: 'CAS' });\n\n\t\tthis.section('CAS Login Layout', function() {\n\t\t\tthis.add('CAS_popup_width', '810', { type: 'string', group: 'CAS', public: true });\n\t\t\tthis.add('CAS_popup_height', '610', { type: 'string', group: 'CAS', public: true });\n\t\t\tthis.add('CAS_button_label_text', 'CAS', { type: 'string', group: 'CAS'});\n\t\t\tthis.add('CAS_button_label_color', '#FFFFFF', { type: 'color', group: 'CAS'});\n\t\t\tthis.add('CAS_button_color', '#13679A', { type: 'color', group: 'CAS'});\n\t\t\tthis.add('CAS_autoclose', true, { type: 'boolean', group: 'CAS'});\n\t\t});\n\t});\n});\n\nvar timer;\n\nfunction updateServices(/*record*/) {\n\tif (typeof timer !== 'undefined') {\n\t\tMeteor.clearTimeout(timer);\n\t}\n\n\ttimer = Meteor.setTimeout(function() {\n\t\tvar data = {\n\t\t\t// These will pe passed to 'node-cas' as options\n\t\t\tenabled:          RocketChat.settings.get('CAS_enabled'),\n\t\t\tbase_url:         RocketChat.settings.get('CAS_base_url'),\n\t\t\tlogin_url:        RocketChat.settings.get('CAS_login_url'),\n\t\t\t// Rocketchat Visuals\n\t\t\tbuttonLabelText:  RocketChat.settings.get('CAS_button_label_text'),\n\t\t\tbuttonLabelColor: RocketChat.settings.get('CAS_button_label_color'),\n\t\t\tbuttonColor:      RocketChat.settings.get('CAS_button_color'),\n\t\t\twidth:            RocketChat.settings.get('CAS_popup_width'),\n\t\t\theight:           RocketChat.settings.get('CAS_popup_height'),\n\t\t\tautoclose:        RocketChat.settings.get('CAS_autoclose')\n\t\t};\n\n\t\t// Either register or deregister the CAS login service based upon its configuration\n\t\tif (data.enabled) {\n\t\t\tlogger.info('Enabling CAS login service');\n\t\t\tServiceConfiguration.configurations.upsert({service: 'cas'}, { $set: data });\n\t\t} else {\n\t\t\tlogger.info('Disabling CAS login service');\n\t\t\tServiceConfiguration.configurations.remove({service: 'cas'});\n\t\t}\n\t}, 2000);\n}\n\nfunction check_record(record) {\n\tif (/^CAS_.+/.test(record._id)) {\n\t\tupdateServices(record);\n\t}\n}\n\nRocketChat.models.Settings.find().observe({\n\tadded: check_record,\n\tchanged: check_record,\n\tremoved: check_record\n});\n","/* globals RoutePolicy, logger */\n/* jshint newcap: false */\n\nvar fiber = Npm.require('fibers');\nvar url = Npm.require('url');\nvar CAS = Npm.require('cas');\n\nvar _casCredentialTokens = {};\n\nRoutePolicy.declare('/_cas/', 'network');\n\nvar closePopup = function(res) {\n\tres.writeHead(200, {'Content-Type': 'text/html'});\n\tvar content = '<html><head><script>window.close()</script></head></html>';\n\tres.end(content, 'utf-8');\n};\n\nvar casTicket = function(req, token, callback) {\n\n\t// get configuration\n\tif (!RocketChat.settings.get('CAS_enabled')) {\n\t\tlogger.error('Got ticket validation request, but CAS is not enabled');\n\t\tcallback();\n\t}\n\n\t// get ticket and validate.\n\tvar parsedUrl = url.parse(req.url, true);\n\tvar ticketId = parsedUrl.query.ticket;\n\tvar baseUrl = RocketChat.settings.get('CAS_base_url');\n\tlogger.debug('Using CAS_base_url: ' + baseUrl);\n\n\tvar cas = new CAS({\n\t\tbase_url: baseUrl,\n\t\tservice: Meteor.absoluteUrl() + '_cas/' + token\n\t});\n\n\tcas.validate(ticketId, function(err, status, username) {\n\t\tif (err) {\n\t\t\tlogger.error('error when trying to validate ' + err.message);\n\t\t} else if (status) {\n\t\t\tlogger.info('Validated user: ' + username);\n\t\t\t_casCredentialTokens[token] = { id: username };\n\t\t} else {\n\t\t\tlogger.error('Unable to validate ticket: ' + ticketId);\n\t\t}\n\n\t\tcallback();\n\t});\n\n\treturn;\n};\n\nvar middleware = function(req, res, next) {\n\t// Make sure to catch any exceptions because otherwise we'd crash\n\t// the runner\n\ttry {\n\t\tvar barePath = req.url.substring(0, req.url.indexOf('?'));\n\t\tvar splitPath = barePath.split('/');\n\n\t\t// Any non-cas request will continue down the default\n\t\t// middlewares.\n\t\tif (splitPath[1] !== '_cas') {\n\t\t\tnext();\n\t\t\treturn;\n\t\t}\n\n\t\t// get auth token\n\t\tvar credentialToken = splitPath[2];\n\t\tif (!credentialToken) {\n\t\t\tclosePopup(res);\n\t\t\treturn;\n\t\t}\n\n\t\t// validate ticket\n\t\tcasTicket(req, credentialToken, function() {\n\t\t\tclosePopup(res);\n\t\t});\n\n\t} catch (err) {\n\t\tlogger.error('Unexpected error : ' + err.message);\n\t\tclosePopup(res);\n\t}\n};\n\n// Listen to incoming OAuth http requests\nWebApp.connectHandlers.use(function(req, res, next) {\n\t// Need to create a fiber since we're using synchronous http calls and nothing\n\t// else is wrapping this in a fiber automatically\n\tfiber(function() {\n\t\tmiddleware(req, res, next);\n\t}).run();\n});\n\nvar _hasCredential = function(credentialToken) {\n\treturn _.has(_casCredentialTokens, credentialToken);\n};\n\n/*\n * Retrieve token and delete it to avoid replaying it.\n */\nvar _retrieveCredential = function(credentialToken) {\n\tvar result = _casCredentialTokens[credentialToken];\n\tdelete _casCredentialTokens[credentialToken];\n\treturn result;\n};\n\n/*\n * Register a server-side login handle.\n * It is call after Accounts.callLoginMethod() is call from client.\n *\n */\nAccounts.registerLoginHandler(function(options) {\n\n\tif (!options.cas) {\n\t\treturn undefined;\n\t}\n\n\tif (!_hasCredential(options.cas.credentialToken)) {\n\t\tthrow new Meteor.Error(Accounts.LoginCancelledError.numericError,\n\t\t'no matching login attempt found');\n\t}\n\n\tvar result = _retrieveCredential(options.cas.credentialToken);\n\toptions = { profile: { name: result.id } };\n\n\t// Search existing user by its external service id\n\tlogger.debug('Looking up user with username: ' + result.id);\n\tvar user = Meteor.users.findOne({ 'services.cas.external_id': result.id });\n\n\tif (user) {\n\t\tlogger.debug('Using existing user for \\'' + result.id + '\\' with id: ' + user._id);\n\t} else {\n\n\t\t// Define new user\n\t\tvar newUser = {\n\t\t\tusername: result.id,\n\t\t\tactive: true,\n\t\t\tglobalRoles: ['user'],\n\t\t\tservices: {\n\t\t\t\tcas: {\n\t\t\t\t\texternal_id: result.id\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t// Create the user\n\t\tlogger.debug('User \\'' + result.id + '\\'does not exist yet, creating it');\n\t\tvar userId = Accounts.insertUserDoc({}, newUser);\n\n\t\t// Fetch and use it\n\t\tuser = Meteor.users.findOne(userId);\n\t\tlogger.debug('Created new user for \\'' + result.id + '\\' with id: ' + user._id);\n\n\t\tlogger.debug('Joining user to default channels');\n\t\tMeteor.runAsUser(user._id, function() {\n\t\t\tMeteor.call('joinDefaultChannels');\n\t\t});\n\n\t}\n\n\treturn { userId: user._id };\n});\n"]}