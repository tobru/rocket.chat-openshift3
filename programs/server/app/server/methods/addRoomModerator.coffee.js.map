{"version":3,"sources":["meteor://ðŸ’»app/server/methods/addRoomModerator.coffee"],"names":[],"mappings":";;;;;;;;;AAAA,MAAM,CAAC,OAAP,CACC;AAAA,oBAAkB,SAAC,GAAD,EAAM,MAAN;AACjB;AAAA,eAAa,CAAC,MAAP,EAAP;AACC,YAAU,UAAM,CAAC,KAAP,CAAa,oBAAb,EAAmC,cAAnC,EAAmD;AAAA,QAAE,QAAQ,kBAAV;OAAnD,CAAV,CADD;KAAA;AAAA,IAGA,MAAM,GAAN,EAAW,MAAX,CAHA;AAAA,IAIA,MAAM,MAAN,EAAc,MAAd,CAJA;AAMA,mBAAiB,CAAC,KAAK,CAAC,aAAjB,CAA+B,MAAM,CAAC,MAAP,EAA/B,EAAgD,eAAhD,EAAiE,GAAjE,CAAP;AACC,YAAU,UAAM,CAAC,KAAP,CAAa,mBAAb,EAAkC,aAAlC,EAAiD;AAAA,QAAE,QAAQ,kBAAV;OAAjD,CAAV,CADD;KANA;AAAA,IASA,eAAe,UAAU,CAAC,MAAM,CAAC,aAAa,CAAC,wBAAhC,CAAyD,GAAzD,EAA8D,MAA9D,CATf;AAUA,QAAO,oBAAP;AACC,YAAU,UAAM,CAAC,KAAP,CAAa,oBAAb,EAAmC,cAAnC,EAAmD;AAAA,QAAE,QAAQ,kBAAV;OAAnD,CAAV,CADD;KAVA;AAAA,IAaA,UAAU,CAAC,MAAM,CAAC,aAAa,CAAC,WAAhC,CAA4C,YAAY,CAAC,GAAzD,EAA8D,WAA9D,CAbA;AAAA,IAeA,OAAO,UAAU,CAAC,MAAM,CAAC,KAAK,CAAC,WAAxB,CAAoC,MAApC,CAfP;AAAA,IAgBA,WAAW,UAAU,CAAC,MAAM,CAAC,KAAK,CAAC,WAAxB,CAAoC,MAAM,CAAC,MAAP,EAApC,CAhBX;AAAA,IAiBA,UAAU,CAAC,MAAM,CAAC,QAAQ,CAAC,4CAA3B,CAAwE,GAAxE,EAA6E,IAA7E,EACC;AAAA,SACC;AAAA,aAAK,QAAQ,CAAC,GAAd;AAAA,QACA,UAAU,QAAQ,CAAC,QADnB;OADD;AAAA,MAGA,MAAM,WAHN;KADD,CAjBA;AAuBA,QAAG,UAAU,CAAC,QAAQ,CAAC,GAApB,CAAwB,iBAAxB,CAAH;AACC,gBAAU,CAAC,aAAa,CAAC,SAAzB,CAAmC,cAAnC,EAAmD;AAAA,QAAE,MAAM,OAAR;AAAA,QAAiB,KAAK,WAAtB;AAAA,QAAmC,GAAG;AAAA,UAAE,KAAK,IAAI,CAAC,GAAZ;AAAA,UAAiB,UAAU,IAAI,CAAC,QAAhC;SAAtC;AAAA,QAAkF,OAAO,GAAzF;OAAnD,EADD;KAvBA;AA0BA,WAAO,IAAP,CA3BiB;EAAA,CAAlB;CADD","file":"/server/methods/addRoomModerator.coffee.js","sourcesContent":["Meteor.methods\n\taddRoomModerator: (rid, userId) ->\n\t\tunless Meteor.userId()\n\t\t\tthrow new Meteor.Error 'error-invalid-user', 'Invalid user', { method: 'addRoomModerator' }\n\n\t\tcheck rid, String\n\t\tcheck userId, String\n\n\t\tunless RocketChat.authz.hasPermission Meteor.userId(), 'set-moderator', rid\n\t\t\tthrow new Meteor.Error 'error-not-allowed', 'Not allowed', { method: 'addRoomModerator' }\n\n\t\tsubscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId rid, userId\n\t\tunless subscription?\n\t\t\tthrow new Meteor.Error 'error-invalid-room', 'Invalid room', { method: 'addRoomModerator' }\n\n\t\tRocketChat.models.Subscriptions.addRoleById(subscription._id, 'moderator')\n\n\t\tuser = RocketChat.models.Users.findOneById userId\n\t\tfromUser = RocketChat.models.Users.findOneById Meteor.userId()\n\t\tRocketChat.models.Messages.createSubscriptionRoleAddedWithRoomIdAndUser rid, user,\n\t\t\tu:\n\t\t\t\t_id: fromUser._id\n\t\t\t\tusername: fromUser.username\n\t\t\trole: 'moderator'\n\n\t\tif RocketChat.settings.get('UI_DisplayRoles')\n\t\t\tRocketChat.Notifications.notifyAll('roles-change', { type: 'added', _id: 'moderator', u: { _id: user._id, username: user.username }, scope: rid });\n\n\t\treturn true\n"]}