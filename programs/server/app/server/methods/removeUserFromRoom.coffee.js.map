{"version":3,"sources":["meteor://ðŸ’»app/server/methods/removeUserFromRoom.coffee"],"names":[],"mappings":";;;;;;;;;AAAA;;AAAA,MAAM,CAAC,OAAP,CACC;AAAA,sBAAoB,SAAC,IAAD;AACnB;AAAA,QAAG,OAAU,CAAC,MAAP,EAAP;AACC,YAAU,UAAM,CAAC,KAAP,CAAa,oBAAb,EAAmC,cAAnC,EAAmD;AAAA,QAAE,QAAQ,oBAAV;OAAnD,CAAV,CADD;KAAA;AAAA,IAGA,SAAS,MAAM,CAAC,MAAP,EAHT;AAAA,IAIA,MAAM,IAAN,EAAY,KAAK,CAAC,eAAN,CAAsB;AAAA,MAAE,KAAK,MAAP;AAAA,MAAe,UAAU,MAAzB;KAAtB,CAAZ,CAJA;AAMA,mBAAiB,CAAC,KAAK,CAAC,aAAjB,CAA+B,MAA/B,EAAuC,aAAvC,EAAsD,IAAI,CAAC,GAA3D,CAAP;AACC,YAAU,UAAM,CAAC,KAAP,CAAa,mBAAb,EAAkC,aAAlC,EAAiD;AAAA,QAAE,QAAQ,oBAAV;OAAjD,CAAV,CADD;KANA;AAAA,IASA,OAAO,UAAU,CAAC,MAAM,CAAC,KAAK,CAAC,WAAxB,CAAoC,IAAI,CAAC,GAAzC,CATP;AAWA,cAAG,IAAI,CAAC,QAAL,+BAAsB,IAAI,CAAE,mBAAN,IAAmB,EAAzC,UAAH;AACC,YAAU,UAAM,CAAC,KAAP,CAAa,wBAAb,EAAuC,0BAAvC,EAAmE;AAAA,QAAE,QAAQ,oBAAV;OAAnE,CAAV,CADD;KAXA;AAAA,IAcA,cAAc,UAAU,CAAC,MAAM,CAAC,KAAK,CAAC,iBAAxB,CAA0C,IAAI,CAAC,QAA/C,CAdd;AAAA,IAgBA,UAAU,CAAC,MAAM,CAAC,KAAK,CAAC,kBAAxB,CAA2C,IAAI,CAAC,GAAhD,EAAqD,IAAI,CAAC,QAA1D,CAhBA;AAAA,IAkBA,UAAU,CAAC,MAAM,CAAC,aAAa,CAAC,uBAAhC,CAAwD,IAAI,CAAC,GAA7D,EAAkE,WAAW,CAAC,GAA9E,CAlBA;AAoBA,gBAAG,IAAI,CAAC,EAAL,KAAY,GAAZ,aAAiB,GAApB;AACC,gBAAU,CAAC,KAAK,CAAC,mBAAjB,CAAqC,WAAW,CAAC,GAAjD,EAAsD,CAAC,WAAD,EAAc,OAAd,CAAtD,EAA8E,IAAI,CAAC,GAAnF,EADD;KApBA;AAAA,IAuBA,WAAW,UAAU,CAAC,MAAM,CAAC,KAAK,CAAC,WAAxB,CAAoC,MAApC,CAvBX;AAAA,IAwBA,UAAU,CAAC,MAAM,CAAC,QAAQ,CAAC,kCAA3B,CAA8D,IAAI,CAAC,GAAnE,EAAwE,WAAxE,EACC;AAAA,SACC;AAAA,aAAK,QAAQ,CAAC,GAAd;AAAA,QACA,UAAU,QAAQ,CAAC,QADnB;OADD;KADD,CAxBA;AA6BA,WAAO,IAAP,CA9BmB;EAAA,CAApB;CADD","file":"/server/methods/removeUserFromRoom.coffee.js","sourcesContent":["Meteor.methods\n\tremoveUserFromRoom: (data) ->\n\t\tif not Meteor.userId()\n\t\t\tthrow new Meteor.Error 'error-invalid-user', 'Invalid user', { method: 'removeUserFromRoom' }\n\n\t\tfromId = Meteor.userId()\n\t\tcheck(data, Match.ObjectIncluding({ rid: String, username: String }))\n\n\t\tunless RocketChat.authz.hasPermission(fromId, 'remove-user', data.rid)\n\t\t\tthrow new Meteor.Error 'error-not-allowed', 'Not allowed', { method: 'removeUserFromRoom' }\n\n\t\troom = RocketChat.models.Rooms.findOneById data.rid\n\n\t\tif data.username not in (room?.usernames or [])\n\t\t\tthrow new Meteor.Error 'error-user-not-in-room', 'User is not in this room', { method: 'removeUserFromRoom' }\n\n\t\tremovedUser = RocketChat.models.Users.findOneByUsername data.username\n\n\t\tRocketChat.models.Rooms.removeUsernameById data.rid, data.username\n\n\t\tRocketChat.models.Subscriptions.removeByRoomIdAndUserId data.rid, removedUser._id\n\n\t\tif room.t in [ 'c', 'p' ]\n\t\t\tRocketChat.authz.removeUserFromRoles(removedUser._id, ['moderator', 'owner'], data.rid)\n\n\t\tfromUser = RocketChat.models.Users.findOneById fromId\n\t\tRocketChat.models.Messages.createUserRemovedWithRoomIdAndUser data.rid, removedUser,\n\t\t\tu:\n\t\t\t\t_id: fromUser._id\n\t\t\t\tusername: fromUser.username\n\n\t\treturn true\n"]}