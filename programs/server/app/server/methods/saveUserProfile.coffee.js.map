{"version":3,"sources":["meteor://ðŸ’»app/server/methods/saveUserProfile.coffee"],"names":[],"mappings":";;;;;;;;;AAAA,MAAM,CAAC,OAAP,CACC;AAAA,mBAAiB,SAAC,QAAD;AAChB;AAAA,mBAAiB,CAAC,QAAQ,CAAC,GAApB,CAAwB,iCAAxB,CAAP;AACC,YAAU,UAAM,CAAC,KAAP,CAAa,mBAAb,EAAkC,aAAlC,EAAiD;AAAA,QAAE,QAAQ,iBAAV;OAAjD,CAAV,CADD;KAAA;AAGA,eAAa,CAAC,MAAP,EAAP;AACC,YAAU,UAAM,CAAC,KAAP,CAAa,oBAAb,EAAmC,cAAnC,EAAmD;AAAA,QAAE,QAAQ,iBAAV;OAAnD,CAAV,CADD;KAHA;AAAA,IAMA,OAAO,UAAU,CAAC,MAAM,CAAC,KAAK,CAAC,WAAxB,CAAoC,MAAM,CAAC,MAAP,EAApC,CANP;AAAA,IAQA,gBAAgB,SAAC,IAAD,EAAO,eAAP;AACf;AAAA,YAAQ,CAAC,IAAF,oFAA+B,CAAE,iCAAjC,CAAP;AACC,eAAO,IAAP,CADD;OAAA;AAGA;AACC,eAAO,KAAP,CADD;OAHA;AAAA,MAMA,YAAY,QAAQ,CAAC,cAAT,CAAwB,IAAxB,EAA8B;AAAA,QAAE,QAAQ,eAAV;AAAA,QAA2B,WAAW,SAAtC;OAA9B,CANZ;AAOA,UAAG,SAAS,CAAC,KAAb;AACC,eAAO,KAAP,CADD;OAPA;AASA,aAAO,IAAP,CAVe;IAAA,CARhB;AAoBA,QAAG,4BAAH;AACC,wBAAO,CAAc,IAAd,EAAoB,QAAQ,CAAC,eAA7B,CAAP;AACC,cAAU,UAAM,CAAC,KAAP,CAAa,wBAAb,EAAuC,kBAAvC,EAA2D;AAAA,UAAE,QAAQ,iBAAV;SAA3D,CAAV,CADD;OAAA;AAAA,MAEA,QAAQ,CAAC,WAAT,CAAqB,MAAM,CAAC,MAAP,EAArB,EAAsC,QAAQ,CAAC,WAA/C,EAA4D;AAAA,QAAE,QAAQ,KAAV;OAA5D,CAFA,CADD;KApBA;AAyBA,QAAG,yBAAH;AACC,YAAM,CAAC,IAAP,CAAY,aAAZ,EAA2B,QAAQ,CAAC,QAApC,EADD;KAzBA;AA4BA,QAAG,yBAAH;AACC,YAAM,CAAC,IAAP,CAAY,aAAZ,EAA2B,QAAQ,CAAC,QAApC,EADD;KA5BA;AA+BA,QAAG,sBAAH;AACC,wBAAO,CAAc,IAAd,EAAoB,QAAQ,CAAC,eAA7B,CAAP;AACC,cAAU,UAAM,CAAC,KAAP,CAAa,wBAAb,EAAuC,kBAAvC,EAA2D;AAAA,UAAE,QAAQ,iBAAV;SAA3D,CAAV,CADD;OAAA;AAAA,MAEA,MAAM,CAAC,IAAP,CAAY,UAAZ,EAAwB,QAAQ,CAAC,KAAjC,CAFA,CADD;KA/BA;AAAA,IAoCA,UAAU,EApCV;AAAA,IAsCA,UAAU,CAAC,MAAM,CAAC,KAAK,CAAC,UAAxB,CAAmC,MAAM,CAAC,MAAP,EAAnC,EAAoD,OAApD,CAtCA;AAwCA,WAAO,IAAP,CAzCgB;EAAA,CAAjB;CADD","file":"/server/methods/saveUserProfile.coffee.js","sourcesContent":["Meteor.methods\n\tsaveUserProfile: (settings) ->\n\t\tunless RocketChat.settings.get(\"Accounts_AllowUserProfileChange\")\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', { method: 'saveUserProfile' })\n\n\t\tunless Meteor.userId()\n\t\t\tthrow new Meteor.Error 'error-invalid-user', 'Invalid user', { method: 'saveUserProfile' }\n\n\t\tuser = RocketChat.models.Users.findOneById Meteor.userId()\n\n\t\tcheckPassword = (user, currentPassword) ->\n\t\t\tunless s.trim(user?.services?.password?.bcrypt)\n\t\t\t\treturn true\n\n\t\t\tunless currentPassword\n\t\t\t\treturn false\n\n\t\t\tpassCheck = Accounts._checkPassword(user, { digest: currentPassword, algorithm: 'sha-256' });\n\t\t\tif passCheck.error\n\t\t\t\treturn false\n\t\t\treturn true\n\n\t\tif settings.newPassword?\n\t\t\tunless checkPassword user, settings.currentPassword\n\t\t\t\tthrow new Meteor.Error('error-invalid-password', 'Invalid password', { method: 'saveUserProfile' })\n\t\t\tAccounts.setPassword Meteor.userId(), settings.newPassword, { logout: false }\n\n\t\tif settings.realname?\n\t\t\tMeteor.call 'setRealName', settings.realname\n\n\t\tif settings.username?\n\t\t\tMeteor.call 'setUsername', settings.username\n\n\t\tif settings.email?\n\t\t\tunless checkPassword user, settings.currentPassword\n\t\t\t\tthrow new Meteor.Error('error-invalid-password', 'Invalid password', { method: 'saveUserProfile' })\n\t\t\tMeteor.call 'setEmail', settings.email\n\n\t\tprofile = {}\n\n\t\tRocketChat.models.Users.setProfile Meteor.userId(), profile\n\n\t\treturn true\n"]}