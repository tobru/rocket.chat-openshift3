{"version":3,"sources":["meteor://ðŸ’»app/server/methods/getAvatarSuggestion.coffee"],"names":[],"mappings":";;;;;;;;;AAAA,IAAC,2BAAD,GAA8B,SAAC,IAAD;AAC7B;AAAA,YAAU,EAAV;AAEA,MAAG,wEAAgC,UAAU,CAAC,QAAQ,CAAC,GAApB,CAAwB,yBAAxB,CAAnC;AACC,WAAO,CAAC,IAAR,CACC;AAAA,eAAS,UAAT;AAAA,MACA,KAAK,gCAA8B,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,EAArD,GAAwD,qBAD7D;KADD,EADD;GAFA;AAOA,MAAG,6EAAmC,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,OAArB,KAAkC,8FAArE,IAAwK,UAAU,CAAC,QAAQ,CAAC,GAApB,CAAwB,uBAAxB,CAA3K;AACC,WAAO,CAAC,IAAR,CACC;AAAA,eAAS,QAAT;AAAA,MACA,KAAK,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,OAD1B;KADD,EADD;GAPA;AAYA,MAAG,8EAAoC,UAAU,CAAC,QAAQ,CAAC,GAApB,CAAwB,uBAAxB,CAAvC;AACC,WAAO,CAAC,IAAR,CACC;AAAA,eAAS,QAAT;AAAA,MACA,KAAK,2CAAyC,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,QAA9D,GAAuE,QAD5E;KADD,EADD;GAZA;AAiBA,MAAG,kFAAwC,UAAU,CAAC,QAAQ,CAAC,GAApB,CAAwB,yBAAxB,CAA3C;AACC,WAAO,CAAC,IAAR,CACC;AAAA,eAAS,UAAT;AAAA,MACA,KAAK,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,UAD5B;KADD,EADD;GAjBA;AAsBA,MAAG,8FAAoD,UAAU,CAAC,QAAQ,CAAC,GAApB,CAAwB,wBAAxB,CAAvD;AACC,WAAO,CAAC,IAAR,CACC;AAAA,eAAS,SAAT;AAAA,MACA,KAAK,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,uBAD3B;KADD,EADD;GAtBA;AA2BA,MAAG,gFAAsC,UAAU,CAAC,QAAQ,CAAC,GAApB,CAAwB,uBAAxB,CAAzC;AACC,WAAO,CAAC,IAAR,CACC;AAAA,eAAS,QAAT;AAAA,MACA,KAAK,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,UAD1B;KADD,EADD;GA3BA;AAgCA,MAAG,gFAAsC,MAAM,CAAC,QAAQ,CAAC,QAAD,CAAO,CAAC,SAAhE;AACC,WAAO,CAAC,IAAR,CACC;AAAA,eAAS,WAAT;AAAA,MACA,KAAK,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,OAD7B;KADD,EADD;GAhCA;AAqCA,0CAAc,CAAE,gBAAb,GAAsB,CAAzB;AACC;AAAA;sBAAA;UAA8B,KAAK,CAAC,QAAN,KAAkB;AAC/C,eAAO,CAAC,IAAR,CACC;AAAA,mBAAS,UAAT;AAAA,UACA,KAAK,QAAQ,CAAC,QAAT,CAAkB,KAAK,CAAC,OAAxB,EAAiC;AAAA,YAAC,WAAS,KAAV;AAAA,YAAiB,MAAM,GAAvB;AAAA,YAA4B,QAAQ,IAApC;WAAjC,CADL;SADD;OADD;AAAA;AAKA;AAAA;sBAAA;UAA8B,KAAK,CAAC,QAAN,KAAoB;AACjD,eAAO,CAAC,IAAR,CACC;AAAA,mBAAS,UAAT;AAAA,UACA,KAAK,QAAQ,CAAC,QAAT,CAAkB,KAAK,CAAC,OAAxB,EAAiC;AAAA,YAAC,WAAS,KAAV;AAAA,YAAiB,MAAM,GAAvB;AAAA,YAA4B,QAAQ,IAApC;WAAjC,CADL;SADD;OADD;AAAA,KAND;GArCA;AAAA,EAgDA,eAAe,EAhDf;AAiDA;wBAAA;AACC;AACC,eAAS,IAAI,CAAC,GAAL,CAAS,MAAM,CAAC,GAAhB,EAAqB;AAAA,2BAAmB;AAAA,UAAC,UAAU,QAAX;SAAnB;OAArB,CAAT;AACA,UAAG,MAAM,CAAC,UAAP,KAAqB,GAAxB;AACC,eAAO,UAAQ,MAAM,CAAC,OAAQ,gBAAvB,GAAuC,UAA9C;AAAA,QACA,QAAQ,OAAO,MAAM,CAAC,OAAd,EAAuB,QAAvB,CAAgC,CAAC,QAAjC,CAA0C,QAA1C,CADR;AAAA,QAEA,MAAM,CAAC,IAAP,GAAc,IAFd;AAAA,QAGA,MAAM,CAAC,WAAP,GAAqB,MAAM,CAAC,OAAQ,gBAHpC;AAAA,QAIA,YAAa,OAAM,CAAC,OAAP,CAAb,GAA+B,MAJ/B,CADD;OAFD;KAAA;AAQM,iBARN;KADD;AAAA,GAjDA;AA6DA,SAAO,YAAP,CA9D6B;AAAA,CAA9B;;AAAA,MAiEM,CAAC,OAAP,CACC;AAAA,uBAAqB;AACpB;AAAA,QAAG,OAAU,CAAC,MAAP,EAAP;AACC,YAAU,UAAM,CAAC,KAAP,CAAa,oBAAb,EAAmC,cAAnC,EAAmD;AAAA,QAAE,QAAQ,qBAAV;OAAnD,CAAV,CADD;KAAA;AAAA,IAGA,IAAC,QAAD,EAHA;AAAA,IAKA,OAAO,MAAM,CAAC,IAAP,EALP;WAOA,2BAA2B,IAA3B,EARoB;EAAA,CAArB;CADD,CAjEA","file":"/server/methods/getAvatarSuggestion.coffee.js","sourcesContent":["@getAvatarSuggestionForUser = (user) ->\n\tavatars = []\n\n\tif user.services.facebook?.id? and RocketChat.settings.get 'Accounts_OAuth_Facebook'\n\t\tavatars.push\n\t\t\tservice: 'facebook'\n\t\t\turl: \"https://graph.facebook.com/#{user.services.facebook.id}/picture?type=large\"\n\n\tif user.services.google?.picture? and user.services.google.picture isnt \"https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg\" and RocketChat.settings.get 'Accounts_OAuth_Google'\n\t\tavatars.push\n\t\t\tservice: 'google'\n\t\t\turl: user.services.google.picture\n\n\tif user.services.github?.username? and RocketChat.settings.get 'Accounts_OAuth_Github'\n\t\tavatars.push\n\t\t\tservice: 'github'\n\t\t\turl: \"https://avatars.githubusercontent.com/#{user.services.github.username}?s=200\"\n\n\tif user.services.linkedin?.pictureUrl? and RocketChat.settings.get 'Accounts_OAuth_Linkedin'\n\t\tavatars.push\n\t\t\tservice: 'linkedin'\n\t\t\turl: user.services.linkedin.pictureUrl\n\n\tif user.services.twitter?.profile_image_url_https? and RocketChat.settings.get 'Accounts_OAuth_Twitter'\n\t\tavatars.push\n\t\t\tservice: 'twitter'\n\t\t\turl: user.services.twitter.profile_image_url_https\n\n\tif user.services.gitlab?.avatar_url? and RocketChat.settings.get 'Accounts_OAuth_Gitlab'\n\t\tavatars.push\n\t\t\tservice: 'gitlab'\n\t\t\turl: user.services.gitlab.avatar_url\n\n\tif user.services.sandstorm?.picture? and Meteor.settings.public.sandstorm\n\t\tavatars.push\n\t\t\tservice: 'sandstorm'\n\t\t\turl: user.services.sandstorm.picture\n\n\tif user.emails?.length > 0\n\t\tfor email in user.emails when email.verified is true\n\t\t\tavatars.push\n\t\t\t\tservice: 'gravatar'\n\t\t\t\turl: Gravatar.imageUrl(email.address, {default: '404', size: 200, secure: true})\n\n\t\tfor email in user.emails when email.verified isnt true\n\t\t\tavatars.push\n\t\t\t\tservice: 'gravatar'\n\t\t\t\turl: Gravatar.imageUrl(email.address, {default: '404', size: 200, secure: true})\n\n\tvalidAvatars = {}\n\tfor avatar in avatars\n\t\ttry\n\t\t\tresult = HTTP.get avatar.url, npmRequestOptions: {encoding: 'binary'}\n\t\t\tif result.statusCode is 200\n\t\t\t\tblob = \"data:#{result.headers['content-type']};base64,\"\n\t\t\t\tblob += Buffer(result.content, 'binary').toString('base64')\n\t\t\t\tavatar.blob = blob\n\t\t\t\tavatar.contentType = result.headers['content-type']\n\t\t\t\tvalidAvatars[avatar.service] = avatar\n\t\tcatch e\n\t\t\t# ...\n\n\treturn validAvatars\n\n\nMeteor.methods\n\tgetAvatarSuggestion: ->\n\t\tif not Meteor.userId()\n\t\t\tthrow new Meteor.Error 'error-invalid-user', 'Invalid user', { method: 'getAvatarSuggestion' }\n\n\t\t@unblock()\n\n\t\tuser = Meteor.user()\n\n\t\tgetAvatarSuggestionForUser user\n"]}