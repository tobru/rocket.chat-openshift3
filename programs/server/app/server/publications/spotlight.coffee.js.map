{"version":3,"sources":["meteor://ðŸ’»app/server/publications/spotlight.coffee"],"names":[],"mappings":";;;;;;;;;AAAA,MAAM,CAAC,OAAP,CAAe,WAAf,EAA4B,SAAC,QAAD,EAAW,OAAX,EAAoB,QAApB;AAC3B;AAAA,MAAO,qBAAJ,IAAwB,2FAA3B;AACC,WAAO,IAAI,CAAC,KAAL,EAAP,CADD;GAAA;AAAA,EAGA,OAAO,IAHP;AAAA,EAIA,iBAAiB,IAJjB;AAAA,EAKA,iBAAiB,IALjB;AAAA,EAOA,iBAAiB,UAAU,CAAC,MAAM,CAAC,KAAK,CAAC,yBAAxB,CAAsD,WAAO,QAAQ,CAAC,IAAI,CAAC,MAArB,EAA6B,GAA7B,CAAtD,EAAyF;AAAA,IAAE,OAAO,EAAT;AAAA,IAAa,QAAQ;AAAA,MAAE,MAAM,CAAR;AAAA,MAAW,UAAU,CAArB;AAAA,MAAwB,QAAQ,CAAhC;KAArB;AAAA,IAA0D,MAAM;AAAA,MAAE,MAAM,CAAR;KAAhE;GAAzF,CAAuK,CAAC,cAAxK,CAChB;AAAA,WAAO,SAAC,EAAD,EAAK,MAAL;AACN;AAAA,aAAO;AAAA,QAAE,MAAM,GAAR;AAAA,QAAa,KAAK,EAAlB;AAAA,QAAsB,UAAU,MAAM,CAAC,QAAvC;AAAA,QAAiD,MAAM,MAAM,CAAC,QAAP,GAAkB,KAAlB,GAA0B,MAAM,CAAC,IAAxF;AAAA,QAA8F,QAAQ,MAAM,CAAC,MAA7G;OAAP;aACA,IAAI,CAAC,KAAL,CAAW,qBAAX,EAAkC,EAAlC,EAAsC,IAAtC,EAFM;IAAA,CAAP;AAAA,IAGA,SAAS,SAAC,EAAD;aACR,IAAI,CAAC,OAAL,CAAa,qBAAb,EAAoC,EAApC,EADQ;IAAA,CAHT;GADgB,CAPjB;AAAA,EAcA,iBAAiB,UAAU,CAAC,MAAM,CAAC,KAAK,CAAC,4BAAxB,CAAqD,QAAQ,CAAC,IAAI,CAAC,MAAnE,EAA2E,CAAC,GAAD,CAA3E,EAAkF;AAAA,IAAE,OAAO,EAAT;AAAA,IAAa,QAAQ;AAAA,MAAE,GAAG,CAAL;AAAA,MAAQ,MAAM,CAAd;KAArB;AAAA,IAAwC,MAAM;AAAA,MAAC,MAAM,CAAP;KAA9C;GAAlF,CAA2I,CAAC,cAA5I,CAChB;AAAA,WAAO,SAAC,EAAD,EAAK,MAAL;AACN;AAAA,aAAO;AAAA,QAAE,MAAM,GAAR;AAAA,QAAa,KAAK,EAAlB;AAAA,QAAsB,MAAM,MAAM,CAAC,IAAnC;AAAA,QAAyC,GAAG,MAAM,CAAC,CAAnD;OAAP;aACA,IAAI,CAAC,KAAL,CAAW,qBAAX,EAAkC,EAAlC,EAAsC,IAAtC,EAFM;IAAA,CAAP;AAAA,IAGA,SAAS,SAAC,EAAD;aACR,IAAI,CAAC,OAAL,CAAa,qBAAb,EAAoC,EAApC,EADQ;IAAA,CAHT;GADgB,CAdjB;AAAA,EAqBA,IAAI,CAAC,KAAL,EArBA;SAuBA,IAAI,CAAC,MAAL,CAAY;;MACX,cAAc,CAAE,IAAhB;KAAA;oCACA,cAAc,CAAE,IAAhB,YAFW;EAAA,CAAZ,EAxB2B;AAAA,CAA5B","file":"/server/publications/spotlight.coffee.js","sourcesContent":["Meteor.publish 'spotlight', (selector, options, collName) ->\n\tif not this.userId? or not selector?.name?.$regex?\n\t\treturn this.ready()\n\n\tself = this\n\tsubHandleUsers = null\n\tsubHandleRooms = null\n\n\tsubHandleUsers = RocketChat.models.Users.findUsersByNameOrUsername(new RegExp(selector.name.$regex, 'i'), { limit: 10, fields: { name: 1, username: 1, status: 1 }, sort: { name: 1 } }).observeChanges\n\t\tadded: (id, fields) ->\n\t\t\tdata = { type: 'u', uid: id, username: fields.username, name: fields.username + ' - ' + fields.name, status: fields.status }\n\t\t\tself.added(\"autocompleteRecords\", id, data)\n\t\tremoved: (id) ->\n\t\t\tself.removed(\"autocompleteRecords\", id)\n\n\tsubHandleRooms = RocketChat.models.Rooms.findByNameContainingAndTypes(selector.name.$regex, ['c'], { limit: 10, fields: { t: 1, name: 1 }, sort: {name: 1}}).observeChanges\n\t\tadded: (id, fields) ->\n\t\t\tdata = { type: 'r', rid: id, name: fields.name, t: fields.t }\n\t\t\tself.added(\"autocompleteRecords\", id, data)\n\t\tremoved: (id) ->\n\t\t\tself.removed(\"autocompleteRecords\", id)\n\n\tthis.ready()\n\n\tthis.onStop ->\n\t\tsubHandleUsers?.stop()\n\t\tsubHandleRooms?.stop()\n"]}