{"version":3,"sources":["meteor://ðŸ’»app/server/publications/channelAutocomplete.coffee"],"names":[],"mappings":";;;;;;;;;AAAA,MAAM,CAAC,OAAP,CAAe,qBAAf,EAAsC,SAAC,IAAD;AACrC;AAAA,WAAW,CAAC,MAAZ;AACC,WAAO,IAAI,CAAC,KAAL,EAAP,CADD;GAAA;AAAA,EAGA,MAAM,IAHN;AAAA,EAKA,UACC;AAAA,YACC;AAAA,WAAK,CAAL;AAAA,MACA,MAAM,CADN;KADD;AAAA,IAGA,OAAO,CAHP;AAAA,IAIA,MACC;AAAA,YAAM,CAAN;KALD;GAND;AAAA,EAaA,UAAU,EAbV;AAcA,MAAG,WAAc,CAAC,KAAK,CAAC,aAAjB,CAA+B,IAAI,CAAC,MAApC,EAA4C,aAA5C,CAAJ,IAAmE,UAAU,CAAC,KAAK,CAAC,aAAjB,CAA+B,IAAI,CAAC,MAApC,EAA4C,kBAA5C,CAAtE;AACC,cAAU,CAAC,CAAC,KAAF,CAAQ,UAAU,CAAC,MAAM,CAAC,aAAa,CAAC,YAAhC,CAA6C,IAAI,CAAC,MAAlD,CAAyD,CAAC,KAA1D,EAAR,EAA2E,KAA3E,CAAV,CADD;GAdA;AAAA,EAiBA,gBAAgB;WAAA,SAAC,GAAD;AACf,aAAO,UAAU,CAAC,KAAK,CAAC,aAAjB,CAA+B,KAAI,CAAC,MAApC,EAA4C,aAA5C,KAA8D,CAAC,UAAU,CAAC,KAAK,CAAC,aAAjB,CAA+B,KAAI,CAAC,MAApC,EAA4C,kBAA5C,KAAoE,OAAO,CAAC,OAAR,CAAgB,GAAhB,MAA0B,EAA/F,CAArE,CADe;IAAA;EAAA,QAjBhB;AAAA,EAoBA,eAAe,UAAU,CAAC,MAAM,CAAC,KAAK,CAAC,4BAAxB,CAAqD,IAArD,EAA2D,CAAC,GAAD,CAA3D,EAAkE,OAAlE,CAA0E,CAAC,cAA3E,CACd;AAAA,WAAO,SAAC,GAAD,EAAM,MAAN;AACN,UAAG,cAAc,GAAd,CAAH;eACC,GAAG,CAAC,KAAJ,CAAU,sBAAV,EAAkC,GAAlC,EAAuC,MAAvC,EADD;OADM;IAAA,CAAP;AAAA,IAGA,SAAS,SAAC,GAAD,EAAM,MAAN;AACR,UAAG,cAAc,GAAd,CAAH;eACC,GAAG,CAAC,OAAJ,CAAY,sBAAZ,EAAoC,GAApC,EAAyC,MAAzC,EADD;OADQ;IAAA,CAHT;AAAA,IAMA,SAAS,SAAC,GAAD,EAAM,MAAN;AACR,UAAG,cAAc,GAAd,CAAH;eACC,GAAG,CAAC,OAAJ,CAAY,sBAAZ,EAAoC,GAApC,EAAyC,MAAzC,EADD;OADQ;IAAA,CANT;GADc,CApBf;AAAA,EA+BA,IAAC,MAAD,EA/BA;AAAA,EAgCA,IAAC,OAAD,CAAQ;WACP,YAAY,CAAC,IAAb,GADO;EAAA,CAAR,CAhCA,CADqC;AAAA,CAAtC","file":"/server/publications/channelAutocomplete.coffee.js","sourcesContent":["Meteor.publish 'channelAutocomplete', (name) ->\n\tunless this.userId\n\t\treturn this.ready()\n\n\tpub = this\n\n\toptions =\n\t\tfields:\n\t\t\t_id: 1\n\t\t\tname: 1\n\t\tlimit: 5\n\t\tsort:\n\t\t\tname: 1\n\n\troomIds = []\n\tif not RocketChat.authz.hasPermission(this.userId, 'view-c-room') and RocketChat.authz.hasPermission(this.userId, 'view-joined-room')\n\t\troomIds = _.pluck RocketChat.models.Subscriptions.findByUserId(this.userId).fetch(), 'rid'\n\n\thasPermission = (_id) =>\n\t\treturn RocketChat.authz.hasPermission(this.userId, 'view-c-room') or (RocketChat.authz.hasPermission(this.userId, 'view-joined-room') and roomIds.indexOf(_id) isnt -1)\n\n\tcursorHandle = RocketChat.models.Rooms.findByNameContainingAndTypes(name, ['c'], options).observeChanges\n\t\tadded: (_id, record) ->\n\t\t\tif hasPermission(_id)\n\t\t\t\tpub.added('channel-autocomplete', _id, record)\n\t\tchanged: (_id, record) ->\n\t\t\tif hasPermission(_id)\n\t\t\t\tpub.changed('channel-autocomplete', _id, record)\n\t\tremoved: (_id, record) ->\n\t\t\tif hasPermission(_id)\n\t\t\t\tpub.removed('channel-autocomplete', _id, record)\n\n\t@ready()\n\t@onStop ->\n\t\tcursorHandle.stop()\n\treturn\n"]}