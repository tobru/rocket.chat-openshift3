{"version":3,"sources":["meteor://ðŸ’»app/server/startup/migrations/v042.coffee"],"names":[],"mappings":";;;;;;;;;AAAA,UAAU,CAAC,UAAU,CAAC,GAAtB,CACC;AAAA,WAAS,EAAT;AAAA,EACA,IAAI;AACH;AAAA,YAAQ,UAAU,CAAC,wBAAX,GAA0C,SAAK,CAAC,UAAN,CAAiB,cAAjB,CAAlD;AAAA,IACA,SAAS,UAAU,CAAC,yBAAX,GAA2C,SAAK,CAAC,UAAN,CAAiB,eAAjB,CADpD;AAAA,IAEA,OAAO;AAAA,MACN,eAAe,aADT;AAAA,MAEN,eAAe,SAFT;AAAA,MAGN,kBAAkB,YAHZ;AAAA,MAIN,kBAAkB,YAJZ;AAAA,MAKN,mBAAmB,aALb;AAAA,MAMN,mBAAmB,aANb;AAAA,MAON,mBAAmB,aAPb;KAFP;AAYA;SAAA;sBAAA;AACC,UAAO;;gBAAP;AACC,kBAAU,KAAK,CAAC,OAAN,CAAc;AAAA,UAAC,KAAK,IAAN;SAAd,CAAV;AACA,YAAG,eAAH;AACC,sBAAY,UAAU,CAAC,MAAM,CAAC,IAAI,CAAC,SAAvB,CAAiC,OAAO,CAAC,WAAzC,CAAZ;AAAA,UACA,UAAU,CAAC,QAAQ,CAAC,UAApB,CAA+B,YAAU,IAAzC,CADA;AAAA,UAEA,UAAU,CAAC,QAAQ,CAAC,UAApB,CAA+B,YAAU,EAAzC,EAA+C;AAAA,YAC9C,KAAK,aAAW,EAAX,GAAc,GAAd,GAAiB,SADwB;AAAA,YAE9C,YAAY,UAAU,CAAC,MAAM,CAAC,MAAO,IAAG,CAAC,UAFK;WAA/C,CAFA;AAAA,UAMA,OAAO,CAAC,GAAR,GAAc,EANd;AAAA,UAOA,OAAO,CAAC,QAAR,GAAmB,EAPnB;AAAA,UAQA,KAAK,CAAC,MAAN,CAAa,OAAb,CARA;AAAA,UASA,KAAK,CAAC,MAAN,CAAa;AAAA,YAAC,KAAK,IAAN;WAAb,CATA;AAAA,uBAUA,MAAM,CAAC,MAAP,CAAc;AAAA,YAAC,UAAU,IAAX;WAAd,EAAgC;AAAA,YAAC,MAAM;AAAA,cAAC,UAAU,EAAX;aAAP;WAAhC,EAAwD;AAAA,YAAC,OAAO,IAAR;WAAxD,EAVA,CADD;SAAA;+BAAA;SAFD;OAAA;6BAAA;OADD;AAAA;mBAbG;EAAA,CADJ;CADD","file":"/server/startup/migrations/v042.coffee.js","sourcesContent":["RocketChat.Migrations.add\n\tversion: 42\n\tup: ->\n\t\tfiles = RocketChat.__migration_assets_files = new Mongo.Collection('assets.files')\n\t\tchunks = RocketChat.__migration_assets_chunks = new Mongo.Collection('assets.chunks')\n\t\tlist = {\n\t\t\t'favicon.ico': 'favicon_ico'\n\t\t\t'favicon.svg': 'favicon'\n\t\t\t'favicon_64.png': 'favicon_64'\n\t\t\t'favicon_96.png': 'favicon_96'\n\t\t\t'favicon_128.png': 'favicon_128'\n\t\t\t'favicon_192.png': 'favicon_192'\n\t\t\t'favicon_256.png': 'favicon_256'\n\t\t}\n\n\t\tfor from, to of list\n\t\t\tif not files.findOne({_id: to})?\n\t\t\t\toldFile = files.findOne({_id: from})\n\t\t\t\tif oldFile?\n\t\t\t\t\textension = RocketChat.Assets.mime.extension(oldFile.contentType)\n\t\t\t\t\tRocketChat.settings.removeById \"Assets_#{from}\"\n\t\t\t\t\tRocketChat.settings.updateById \"Assets_#{to}\", {\n\t\t\t\t\t\turl: \"/assets/#{to}.#{extension}\"\n\t\t\t\t\t\tdefaultUrl: RocketChat.Assets.assets[to].defaultUrl\n\t\t\t\t\t}\n\t\t\t\t\toldFile._id = to\n\t\t\t\t\toldFile.filename = to\n\t\t\t\t\tfiles.insert(oldFile)\n\t\t\t\t\tfiles.remove({_id: from})\n\t\t\t\t\tchunks.update({files_id: from}, {$set: {files_id: to}}, {multi: true})\n\n"]}