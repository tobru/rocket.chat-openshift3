{"version":3,"sources":["meteor://ðŸ’»app/server/startup/migrations/v033.coffee"],"names":[],"mappings":";;;;;;;;;AAAA,UAAU,CAAC,UAAU,CAAC,GAAtB,CACC;AAAA,WAAS,EAAT;AAAA,EACA,IAAI;AACH;AAAA,kBAAc,8IAAd;AAAA,IAEA,eAAe,UAAU,CAAC,MAAM,CAAC,YAAY,CAAC,IAA/B,CAAoC;AAAA,MAClD,KAAK;QACJ;AAAA,UAAC,QAAQ;AAAA,YAAC,SAAS,KAAV;WAAT;AAAA,UAA2B,8BAA8B;AAAA,YAAC,SAAS,IAAV;WAAzD;SADI,EAEJ;AAAA,UAAC,QAAQ;AAAA,YAAC,SAAS,KAAV;WAAT;AAAA,UAA2B,8BAA8B;AAAA,YAAC,SAAS,IAAV;WAAzD;SAFI,EAGJ;AAAA,UAAC,QAAQ;AAAA,YAAC,SAAS,KAAV;WAAT;AAAA,UAA2B,+BAA+B;AAAA,YAAC,SAAS,IAAV;WAA1D;SAHI;OAD6C;KAApC,CAMb,CAAC,KANY,EAFf;AAAA,IAWA,YAAY,CAAC,OAAb,CAAqB,SAAC,WAAD;AACpB;AAAA,eAAS,EAAT;AACA,UAAG,WAAW,CAAC,4BAAf;AACC,kBAAU,WAAW,CAAC,4BAAZ,GAA2C,MAArD,CADD;OADA;AAIA,UAAG,WAAW,CAAC,4BAAf;AACC,kBAAU,WAAW,CAAC,4BAAZ,GAA2C,MAArD,CADD;OAJA;AAOA,UAAG,WAAW,CAAC,6BAAf;AACC,kBAAU,WAAW,CAAC,6BAAZ,GAA4C,MAAtD,CADD;OAPA;aAUA,UAAU,CAAC,MAAM,CAAC,YAAY,CAAC,MAA/B,CAAsC,WAAW,CAAC,GAAlD,EACC;AAAA,cACC;AAAA,kBAAQ,cAAc,MAAM,CAAC,OAAP,CAAe,KAAf,EAAsB,KAAtB,CAAtB;SADD;OADD,EAXoB;IAAA,CAArB,CAXA;AAAA,IA2BA,SACC;AAAA,cACC;AAAA,sCAA8B,CAA9B;AAAA,QACA,8BAA8B,CAD9B;AAAA,QAEA,+BAA+B,CAF/B;OADD;KA5BD;AAAA,IAiCA,UAAU,CAAC,MAAM,CAAC,YAAY,CAAC,MAA/B,CAAsC,EAAtC,EAA0C,MAA1C,EAAkD;AAAA,MAAC,OAAO,IAAR;KAAlD,CAjCA;AAAA,IAmCA,SACC;AAAA,YACC;AAAA,iBAAS,IAAT;OADD;KApCD;WAuCA,UAAU,CAAC,MAAM,CAAC,YAAY,CAAC,MAA/B,CAAsC;AAAA,MAAC,SAAS;AAAA,QAAC,SAAS,KAAV;OAAV;KAAtC,EAAmE,MAAnE,EAA2E;AAAA,MAAC,OAAO,IAAR;KAA3E,EAxCG;EAAA,CADJ;CADD","file":"/server/startup/migrations/v033.coffee.js","sourcesContent":["RocketChat.Migrations.add\n\tversion: 33\n\tup: ->\n\t\tscriptAlert = \"/**\\n * This scrit is out-of-date, convert to the new format\\n * (https://github.com/RocketChat/Rocket.Chat/wiki/WebHook-Scripting)\\n**/\\n\\n\"\n\n\t\tintegrations = RocketChat.models.Integrations.find({\n\t\t\t$or: [\n\t\t\t\t{script: {$exists: false}, processIncomingRequestScript: {$exists: true}}\n\t\t\t\t{script: {$exists: false}, prepareOutgoingRequestScript: {$exists: true}}\n\t\t\t\t{script: {$exists: false}, processOutgoingResponseScript: {$exists: true}}\n\t\t\t]\n\t\t}).fetch()\n\n\n\t\tintegrations.forEach (integration) ->\n\t\t\tscript = ''\n\t\t\tif integration.processIncomingRequestScript\n\t\t\t\tscript += integration.processIncomingRequestScript + '\\n\\n'\n\n\t\t\tif integration.prepareOutgoingRequestScript\n\t\t\t\tscript += integration.prepareOutgoingRequestScript + '\\n\\n'\n\n\t\t\tif integration.processOutgoingResponseScript\n\t\t\t\tscript += integration.processOutgoingResponseScript + '\\n\\n'\n\n\t\t\tRocketChat.models.Integrations.update integration._id,\n\t\t\t\t$set:\n\t\t\t\t\tscript: scriptAlert + script.replace(/^/gm, '// ')\n\n\n\t\tupdate =\n\t\t\t$unset:\n\t\t\t\tprocessIncomingRequestScript: 1\n\t\t\t\tprepareOutgoingRequestScript: 1\n\t\t\t\tprocessOutgoingResponseScript: 1\n\n\t\tRocketChat.models.Integrations.update {}, update, {multi: true}\n\n\t\tupdate =\n\t\t\t$set:\n\t\t\t\tenabled: true\n\n\t\tRocketChat.models.Integrations.update {enabled: {$exists: false}}, update, {multi: true}\n"]}