{"version":3,"sources":["meteor://ðŸ’»app/server/startup/migrations/v036.coffee"],"names":[],"mappings":";;;;;;;;;AAAA;;AAAA,MAAM,GAAG,CAAC,OAAJ,CAAY,KAAZ,CAAN;;AAAA,UACU,CAAC,UAAU,CAAC,GAAtB,CACC;AAAA,WAAS,EAAT;AAAA,EACA,IAAI;AACH;AAAA,kBAAc,UAAU,CAAC,MAAM,CAAC,QAAQ,CAAC,OAA3B,CAAmC;AAAA,WAAK,qBAAL;KAAnC,CAAd;AAEA,QAAO,0DAAP;AACC,aADD;KAFA;AAAA,IAKA,QAAQ,WAAW,CAAC,KAAK,CAAC,KAAlB,CAAwB,wBAAxB,CALR;AAMA,QAAG,mBAAW,KAAK,CAAC,MAAN,KAAgB,CAA9B;AACC,mBAAa,KAAM,GAAnB;AACA,UAAG,UAAW,GAAX,KAAiB,GAApB;AACC,qBAAa,GAAG,CAAC,OAAJ,CAAY,MAAM,CAAC,WAAP,EAAZ,EAAkC,UAAlC,CAAb,CADD;OADA;AAIA;AACC,cAAM,CAAC,OAAP,CAAe;iBACd,MAAM,CAAC,UAAP,CAAkB;AACjB;AAAA,qBAAS,IAAI,CAAC,GAAL,CAAS,UAAT,EAAqB;AAAA,iCAAmB;AAAA,gBAAC,UAAU,QAAX;eAAnB;aAArB,CAAT;AACA,gBAAG,MAAM,CAAC,UAAP,KAAqB,GAAxB;qBACC,UAAU,CAAC,MAAM,CAAC,QAAlB,CAA2B,MAAM,CAAC,OAAlC,EAA2C,MAAM,CAAC,OAAQ,gBAA1D,EAA2E,MAA3E,EADD;aAFiB;UAAA,CAAlB,EAIE,KAJF,EADc;QAAA,CAAf,EADD;OAAA;AAQC,QADK,UACL;AAAA,eAAO,CAAC,GAAR,CAAY,CAAZ,EARD;OALD;KANA;WAsBA,UAAU,CAAC,MAAM,CAAC,QAAQ,CAAC,MAA3B,CAAkC;AAAA,WAAK,qBAAL;KAAlC,EAvBG;EAAA,CADJ;CADD,CADA","file":"/server/startup/migrations/v036.coffee.js","sourcesContent":["url = Npm.require 'url'\nRocketChat.Migrations.add\n\tversion: 36\n\tup: ->\n\t\tloginHeader = RocketChat.models.Settings.findOne _id: 'Layout_Login_Header'\n\n\t\tif not loginHeader?.value?\n\t\t\treturn\n\n\t\tmatch = loginHeader.value.match(/<img\\ssrc=['\"]([^'\"]+)/)\n\t\tif match? and match.length is 2\n\t\t\trequestUrl = match[1]\n\t\t\tif requestUrl[0] is '/'\n\t\t\t\trequestUrl = url.resolve(Meteor.absoluteUrl(), requestUrl)\n\n\t\t\ttry\n\t\t\t\tMeteor.startup ->\n\t\t\t\t\tMeteor.setTimeout ->\n\t\t\t\t\t\tresult = HTTP.get requestUrl, npmRequestOptions: {encoding: 'binary'}\n\t\t\t\t\t\tif result.statusCode is 200\n\t\t\t\t\t\t\tRocketChat.Assets.setAsset(result.content, result.headers['content-type'], 'logo')\n\t\t\t\t\t, 30000\n\t\t\tcatch e\n\t\t\t\tconsole.log e\n\n\n\t\tRocketChat.models.Settings.remove _id: 'Layout_Login_Header'\n"]}