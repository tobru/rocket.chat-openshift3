{"version":3,"sources":["meteor://ðŸ’»app/server/startup/migrations/v007.coffee"],"names":[],"mappings":";;;;;;;;;AAAA,UAAU,CAAC,UAAU,CAAC,GAAtB,CACC;AAAA,WAAS,CAAT;AAAA,EACA,IAAI;AAEH;AAAA,WAAO,CAAC,GAAR,CAAY,2BAAZ;AAAA,IACA,QAAQ,UAAU,CAAC,MAAM,CAAC,QAAQ,CAAC,IAA3B,CAAgC;AAAA,MAAE,UAAU;AAAA,QAAE,SAAS,IAAX;OAAZ;KAAhC,CADR;AAAA,IAEA,QAAQ,KAAK,CAAC,KAAN,EAFR;AAAA,IAGA,KAAK,CAAC,OAAN,CAAc,SAAC,OAAD,EAAU,KAAV;AACb,aAAO,CAAC,GAAR,CAAc,CAAC,QAAQ,CAAT,IAAW,KAAX,GAAgB,KAA9B;AAAA,MAEA,OAAO,CAAC,IAAR,GAAe,OAAO,CAAC,IAAI,CAAC,GAAb,CAAiB,SAAC,GAAD;AAC/B,YAAG,CAAC,CAAC,QAAF,CAAW,GAAX,CAAH;AACC,iBAAO;AAAA,YAAC,KAAK,GAAN;WAAP,CADD;SAAA;AAEA,eAAO,GAAP,CAH+B;MAAA,CAAjB,CAFf;aAOA,MAAM,CAAC,eAAP,CAAuB,OAAvB,EARa;IAAA,CAAd,CAHA;WAaA,OAAO,CAAC,GAAR,CAAY,KAAZ,EAfG;EAAA,CADJ;CADD","file":"/server/startup/migrations/v007.coffee.js","sourcesContent":["RocketChat.Migrations.add\n\tversion: 7\n\tup: ->\n\n\t\tconsole.log 'Populate urls in messages'\n\t\tquery = RocketChat.models.Messages.find({ 'urls.0': { $exists: true } })\n\t\tcount = query.count()\n\t\tquery.forEach (message, index) ->\n\t\t\tconsole.log \"#{index + 1} / #{count}\"\n\n\t\t\tmessage.urls = message.urls.map (url) ->\n\t\t\t\tif _.isString url\n\t\t\t\t\treturn {url: url}\n\t\t\t\treturn url\n\n\t\t\tOEmbed.RocketUrlParser message\n\n\t\tconsole.log 'End'\n"]}