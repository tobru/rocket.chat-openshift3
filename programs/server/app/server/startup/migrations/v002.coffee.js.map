{"version":3,"sources":["meteor://ðŸ’»app/server/startup/migrations/v002.coffee"],"names":[],"mappings":";;;;;;;;;AAAA,UAAU,CAAC,UAAU,CAAC,GAAtB,CACC;AAAA,WAAS,CAAT;AAAA,EACA,IAAI;WACH,UAAU,CAAC,MAAM,CAAC,KAAK,CAAC,IAAxB,CAA6B;AAAA,MAAC,cAAc;AAAA,QAAC,SAAS,KAAV;OAAf;AAAA,MAAiC,UAAU;AAAA,QAAC,SAAS,IAAV;OAA3C;KAA7B,CAAyF,CAAC,OAA1F,CAAkG,SAAC,IAAD;AACjG;AAAA,gBAAU,2BAA2B,IAA3B,CAAV;AAAA,MAEA,WAAW,MAAM,CAAC,IAAP,CAAY,OAAZ,CAFX;AAIA,UAAG,QAAQ,CAAC,MAAT,KAAmB,CAAtB;AACC,eADD;OAJA;AAAA,MAOA,UAAU,QAAS,GAPnB;AAAA,MAQA,OAAO,CAAC,GAAR,CAAY,IAAI,CAAC,QAAjB,EAA2B,IAA3B,EAAiC,OAAjC,CARA;AAAA,MAUA,UAAU,OAAQ,SAAQ,CAAC,IAV3B;AAAA,MAYA,MAAuB,cAAc,CAAC,YAAf,CAA4B,OAA5B,CAAvB,EAAC,iBAAD,EAAQ,6BAZR;AAAA,MAcA,KAAK,cAAc,CAAC,cAAf,CAAkC,WAAO,KAAP,EAAc,QAAd,CAAlC,CAdL;AAAA,MAeA,KAAK,4BAA4B,CAAC,iBAA7B,CAAkD,IAAI,CAAC,QAAN,GAAe,MAAhE,EAAuE,WAAvE,CAfL;AAAA,MAgBA,EAAE,CAAC,EAAH,CAAM,KAAN,EAAa,MAAM,CAAC,eAAP,CAAuB;eACnC,UAAU,CAAC,MAAM,CAAC,KAAK,CAAC,eAAxB,CAAwC,IAAI,CAAC,GAA7C,EAAkD,OAAlD,EADmC;MAAA,CAAvB,CAAb,CAhBA;aAmBA,EAAE,CAAC,IAAH,CAAQ,EAAR,EApBiG;IAAA,CAAlG,EADG;EAAA,CADJ;CADD","file":"/server/startup/migrations/v002.coffee.js","sourcesContent":["RocketChat.Migrations.add\n\tversion: 2\n\tup: ->\n\t\tRocketChat.models.Users.find({avatarOrigin: {$exists: false}, username: {$exists: true}}).forEach (user) ->\n\t\t\tavatars = getAvatarSuggestionForUser user\n\n\t\t\tservices = Object.keys avatars\n\n\t\t\tif services.length is 0\n\t\t\t\treturn\n\n\t\t\tservice = services[0]\n\t\t\tconsole.log user.username, '->', service\n\n\t\t\tdataURI = avatars[service].blob\n\n\t\t\t{image, contentType} = RocketChatFile.dataURIParse dataURI\n\n\t\t\trs = RocketChatFile.bufferToStream new Buffer(image, 'base64')\n\t\t\tws = RocketChatFileAvatarInstance.createWriteStream \"#{user.username}.jpg\", contentType\n\t\t\tws.on 'end', Meteor.bindEnvironment ->\n\t\t\t\tRocketChat.models.Users.setAvatarOrigin user._id, service\n\n\t\t\trs.pipe(ws)\n"]}