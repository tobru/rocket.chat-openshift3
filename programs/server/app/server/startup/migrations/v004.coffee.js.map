{"version":3,"sources":["meteor://ðŸ’»app/server/startup/migrations/v004.coffee"],"names":[],"mappings":";;;;;;;;;AAAA,UAAU,CAAC,UAAU,CAAC,GAAtB,CACC;AAAA,WAAS,CAAT;AAAA,EACA,IAAI;AAEH,cAAU,CAAC,MAAM,CAAC,QAAQ,CAAC,YAA3B,CAAwC,OAAxC;AAAA,IACA,UAAU,CAAC,MAAM,CAAC,aAAa,CAAC,YAAhC,CAA6C,SAA7C,CADA;AAAA,IAIA,OAAO,CAAC,GAAR,CAAY,mBAAZ,CAJA;AAAA,IAKA,UAAU,CAAC,MAAM,CAAC,aAAa,CAAC,MAAhC,CAAuC;AAAA,MAAC,IAAI;AAAA,QAAC,SAAS,IAAV;OAAL;KAAvC,EAA8D;AAAA,MAAC,SAAS;AAAA,QAAC,IAAI,MAAL;OAAV;KAA9D,EAAuF;AAAA,MAAC,OAAO,IAAR;KAAvF,CALA;AAAA,IAQA,OAAO,CAAC,GAAR,CAAY,oCAAZ,CARA;AAAA,IASA,UAAU,CAAC,MAAM,CAAC,KAAK,CAAC,IAAxB,CAA6B;AAAA,MAAC,MAAM,EAAP;KAA7B,CAAwC,CAAC,OAAzC,CAAiD,SAAC,IAAD;AAChD;AAAA,aAAO,MAAM,CAAC,EAAP,EAAW,CAAC,WAAZ,EAAP;AAAA,MACA,UAAU,CAAC,MAAM,CAAC,KAAK,CAAC,WAAxB,CAAoC,IAAI,CAAC,GAAzC,EAA8C,IAA9C,CADA;aAEA,UAAU,CAAC,MAAM,CAAC,aAAa,CAAC,MAAhC,CAAuC;AAAA,QAAC,KAAK,IAAI,CAAC,GAAX;OAAvC,EAAwD;AAAA,QAAC,MAAM;AAAA,UAAC,MAAM,IAAP;SAAP;OAAxD,EAA8E;AAAA,QAAC,OAAO,IAAR;OAA9E,EAHgD;IAAA,CAAjD,CATA;AAAA,IAeA,OAAO,CAAC,GAAR,CAAY,0BAAZ,CAfA;AAAA,IAgBA,UAAU,CAAC,MAAM,CAAC,KAAK,CAAC,IAAxB,EAA8B,CAAC,OAA/B,CAAuC,SAAC,IAAD;aACtC,UAAU,CAAC,MAAM,CAAC,KAAK,CAAC,IAAxB,CAA6B;AAAA,QAAC,MAAM,IAAI,CAAC,IAAZ;AAAA,QAAkB,KAAK;AAAA,UAAC,KAAK,IAAI,CAAC,GAAX;SAAvB;OAA7B,CAAqE,CAAC,OAAtE,CAA8E,SAAC,IAAD;AAC7E;AAAA,eAAO,IAAI,CAAC,IAAL,GAAY,GAAZ,GAAkB,MAAM,CAAC,EAAP,CAAU,CAAV,CAAY,CAAC,WAAb,EAAzB;AAAA,QACA,UAAU,CAAC,MAAM,CAAC,KAAK,CAAC,WAAxB,CAAoC,IAAI,CAAC,GAAzC,EAA8C,IAA9C,CADA;eAEA,UAAU,CAAC,MAAM,CAAC,aAAa,CAAC,MAAhC,CAAuC;AAAA,UAAC,KAAK,IAAI,CAAC,GAAX;SAAvC,EAAwD;AAAA,UAAC,MAAM;AAAA,YAAC,MAAM,IAAP;WAAP;SAAxD,EAA8E;AAAA,UAAC,OAAO,IAAR;SAA9E,EAH6E;MAAA,CAA9E,EADsC;IAAA,CAAvC,CAhBA;WAuBA,OAAO,CAAC,GAAR,CAAY,KAAZ,EAzBG;EAAA,CADJ;CADD","file":"/server/startup/migrations/v004.coffee.js","sourcesContent":["RocketChat.Migrations.add\n\tversion: 4\n\tup: ->\n\n\t\tRocketChat.models.Messages.tryDropIndex 'rid_1'\n\t\tRocketChat.models.Subscriptions.tryDropIndex 'u._id_1'\n\n\n\t\tconsole.log 'Rename rn to name'\n\t\tRocketChat.models.Subscriptions.update({rn: {$exists: true}}, {$rename: {rn: 'name'}}, {multi: true})\n\n\n\t\tconsole.log 'Adding names to rooms without name'\n\t\tRocketChat.models.Rooms.find({name: ''}).forEach (item) ->\n\t\t\tname = Random.id().toLowerCase()\n\t\t\tRocketChat.models.Rooms.setNameById item._id, name\n\t\t\tRocketChat.models.Subscriptions.update {rid: item._id}, {$set: {name: name}}, {multi: true}\n\n\n\t\tconsole.log 'Making room names unique'\n\t\tRocketChat.models.Rooms.find().forEach (room) ->\n\t\t\tRocketChat.models.Rooms.find({name: room.name, _id: {$ne: room._id}}).forEach (item) ->\n\t\t\t\tname = room.name + '-' + Random.id(2).toLowerCase()\n\t\t\t\tRocketChat.models.Rooms.setNameById item._id, name\n\t\t\t\tRocketChat.models.Subscriptions.update {rid: item._id}, {$set: {name: name}}, {multi: true}\n\n\n\t\tconsole.log 'End'\n"]}