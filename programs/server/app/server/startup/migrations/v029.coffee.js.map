{"version":3,"sources":["meteor://ðŸ’»app/server/startup/migrations/v029.coffee"],"names":[],"mappings":";;;;;;;;;AAAA,UAAU,CAAC,UAAU,CAAC,GAAtB,CACC;AAAA,WAAS,EAAT;AAAA,EACA,IAAI;AACH;AAAA,mFAAyD,CAAE,cAA3D;AAAA,IACA,iFAAyD,CAAE,cAD3D;AAAA,IAEA,+EAAuD,CAAE,cAFzD;AAAA,IAGA,iGAAyE,CAAE,cAH3E;AAKA,QAAG,sBAAc,QAAQ,CAAC,IAAT,OAAqB,EAAtC;AACC,iBAAW,QAAQ,CAAC,OAAT,CAAiB,cAAjB,EAAiC,EAAjC,CAAX;AAAA,MACA,UAAU,CAAC,MAAM,CAAC,QAAQ,CAAC,MAA3B,CACC;AAAA,aAAK,WAAL;OADD,EAGC;AAAA,cACC;AAAA,iBAAO,QAAP;SADD;AAAA,QAEA,cACC;AAAA,qBAAW,QAAX;SAHD;OAHD,CADA,CADD;KALA;AAeA,QAAG,aAAY,IAAf;AACC,gBAAU,CAAC,MAAM,CAAC,QAAQ,CAAC,MAA3B,CACC;AAAA,aAAK,iBAAL;OADD,EAGC;AAAA,cACC;AAAA,iBAAO,KAAP;SADD;AAAA,QAEA,cACC;AAAA,qBAAW,QAAX;SAHD;OAHD,EADD;KAfA;AAwBA,QAAG,qBAAa,OAAO,CAAC,IAAR,OAAoB,EAApC;AACC,gBAAU,CAAC,MAAM,CAAC,QAAQ,CAAC,MAA3B,CACC;AAAA,aAAK,kBAAL;OADD,EAGC;AAAA,cACC;AAAA,iBAAO,OAAP;SADD;AAAA,QAEA,cACC;AAAA,qBAAW,QAAX;SAHD;OAHD;AAAA,MAQA,UAAU,CAAC,MAAM,CAAC,QAAQ,CAAC,MAA3B,CACC;AAAA,aAAK,qBAAL;OADD,EAGC;AAAA,cACC;AAAA,iBAAO,EAAP;SADD;AAAA,QAEA,cACC;AAAA,qBAAW,QAAX;SAHD;OAHD,CARA;AAAA,MAgBA,UAAU,CAAC,MAAM,CAAC,QAAQ,CAAC,MAA3B,CACC;AAAA,aAAK,8BAAL;OADD,EAGC;AAAA,cACC;AAAA,iBAAO,EAAP;SADD;AAAA,QAEA,cACC;AAAA,qBAAW,QAAX;SAHD;OAHD,CAhBA,CADD;KAxBA;AAiDA,QAAG,8BAAsB,gBAAgB,CAAC,IAAjB,OAA6B,EAAtD;AACC,gBAAU,CAAC,MAAM,CAAC,QAAQ,CAAC,MAA3B,CACC;AAAA,aAAK,2BAAL;OADD,EAGC;AAAA,cACC;AAAA,iBAAO,gBAAP;SADD;AAAA,QAEA,cACC;AAAA,qBAAW,QAAX;SAHD;OAHD;AAAA,MAQA,UAAU,CAAC,MAAM,CAAC,QAAQ,CAAC,MAA3B,CACC;AAAA,aAAK,+BAAL;OADD,EAGC;AAAA,cACC;AAAA,iBAAO,IAAP;SADD;AAAA,QAEA,cACC;AAAA,qBAAW,QAAX;SAHD;OAHD,CARA,CADD;KAjDA;AAAA,IAmEA,UAAU,CAAC,MAAM,CAAC,QAAQ,CAAC,MAA3B,CAAkC;AAAA,MAAC,KAAK,UAAN;KAAlC,CAnEA;AAAA,IAoEA,UAAU,CAAC,MAAM,CAAC,QAAQ,CAAC,MAA3B,CAAkC;AAAA,MAAC,KAAK,UAAN;KAAlC,CApEA;AAAA,IAqEA,UAAU,CAAC,MAAM,CAAC,QAAQ,CAAC,MAA3B,CAAkC;AAAA,MAAC,KAAK,SAAN;KAAlC,CArEA;WAsEA,UAAU,CAAC,MAAM,CAAC,QAAQ,CAAC,MAA3B,CAAkC;AAAA,MAAC,KAAK,kBAAN;KAAlC,EAvEG;EAAA,CADJ;CADD","file":"/server/startup/migrations/v029.coffee.js","sourcesContent":["RocketChat.Migrations.add\n\tversion: 29\n\tup: ->\n\t\tLDAP_Url = RocketChat.models.Settings.findOne('LDAP_Url')?.value\n\t\tLDAP_TLS = RocketChat.models.Settings.findOne('LDAP_TLS')?.value\n\t\tLDAP_DN = RocketChat.models.Settings.findOne('LDAP_DN')?.value\n\t\tLDAP_Bind_Search = RocketChat.models.Settings.findOne('LDAP_Bind_Search')?.value\n\n\t\tif LDAP_Url? and LDAP_Url.trim() isnt ''\n\t\t\tLDAP_Url = LDAP_Url.replace(/ldaps?:\\/\\//i, '')\n\t\t\tRocketChat.models.Settings.upsert\n\t\t\t\t_id: 'LDAP_Host'\n\t\t\t,\n\t\t\t\t$set:\n\t\t\t\t\tvalue: LDAP_Url\n\t\t\t\t$setOnInsert:\n\t\t\t\t\tcreatedAt: new Date\n\n\t\tif LDAP_TLS is true\n\t\t\tRocketChat.models.Settings.upsert\n\t\t\t\t_id: 'LDAP_Encryption'\n\t\t\t,\n\t\t\t\t$set:\n\t\t\t\t\tvalue: 'tls'\n\t\t\t\t$setOnInsert:\n\t\t\t\t\tcreatedAt: new Date\n\n\t\tif LDAP_DN? and LDAP_DN.trim() isnt ''\n\t\t\tRocketChat.models.Settings.upsert\n\t\t\t\t_id: 'LDAP_Domain_Base'\n\t\t\t,\n\t\t\t\t$set:\n\t\t\t\t\tvalue: LDAP_DN\n\t\t\t\t$setOnInsert:\n\t\t\t\t\tcreatedAt: new Date\n\n\t\t\tRocketChat.models.Settings.upsert\n\t\t\t\t_id: 'LDAP_Username_Field'\n\t\t\t,\n\t\t\t\t$set:\n\t\t\t\t\tvalue: ''\n\t\t\t\t$setOnInsert:\n\t\t\t\t\tcreatedAt: new Date\n\n\t\t\tRocketChat.models.Settings.upsert\n\t\t\t\t_id: 'LDAP_Unique_Identifier_Field'\n\t\t\t,\n\t\t\t\t$set:\n\t\t\t\t\tvalue: ''\n\t\t\t\t$setOnInsert:\n\t\t\t\t\tcreatedAt: new Date\n\n\t\tif LDAP_Bind_Search? and LDAP_Bind_Search.trim() isnt ''\n\t\t\tRocketChat.models.Settings.upsert\n\t\t\t\t_id: 'LDAP_Custom_Domain_Search'\n\t\t\t,\n\t\t\t\t$set:\n\t\t\t\t\tvalue: LDAP_Bind_Search\n\t\t\t\t$setOnInsert:\n\t\t\t\t\tcreatedAt: new Date\n\n\t\t\tRocketChat.models.Settings.upsert\n\t\t\t\t_id: 'LDAP_Use_Custom_Domain_Search'\n\t\t\t,\n\t\t\t\t$set:\n\t\t\t\t\tvalue: true\n\t\t\t\t$setOnInsert:\n\t\t\t\t\tcreatedAt: new Date\n\n\n\t\tRocketChat.models.Settings.remove({_id: 'LDAP_Url'})\n\t\tRocketChat.models.Settings.remove({_id: 'LDAP_TLS'})\n\t\tRocketChat.models.Settings.remove({_id: 'LDAP_DN'})\n\t\tRocketChat.models.Settings.remove({_id: 'LDAP_Bind_Search'})\n"]}