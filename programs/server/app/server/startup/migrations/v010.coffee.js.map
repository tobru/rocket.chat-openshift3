{"version":3,"sources":["meteor://ðŸ’»app/server/startup/migrations/v010.coffee"],"names":[],"mappings":";;;;;;;;;AAAA,UAAU,CAAC,UAAU,CAAC,GAAtB,CACC;AAAA,WAAS,EAAT;AAAA,EACA,IAAI;AACH;AAAA;;OAAA;AAAA;AAAA,IAIA,QAAQ,CAJR;AAAA,IAKA,UAAU,CAAC,MAAM,CAAC,KAAK,CAAC,IAAxB,CAA6B;AAAA,MAAC,eAAe;AAAA,QAAC,SAAS,IAAV;OAAhB;KAA7B,EAA+D;AAAA,MAAC,QAAQ;AAAA,QAAC,WAAW,CAAZ;OAAT;KAA/D,CAAwF,CAAC,OAAzF,CAAiG,SAAC,IAAD;AAChG;AAAA,qBAAe,CAAC,CAAC,IAAF,CAAO,IAAI,CAAC,SAAZ,CAAf;AACA,UAAG,YAAY,CAAC,MAAb,KAAyB,IAAI,CAAC,SAAS,CAAC,MAA3C;AACC;eACA,UAAU,CAAC,MAAM,CAAC,KAAK,CAAC,MAAxB,CAA+B;AAAA,UAAC,KAAK,IAAI,CAAC,GAAX;SAA/B,EAAgD;AAAA,UAAC,MAAM;AAAA,YAAC,WAAW,YAAZ;WAAP;SAAhD,EAFD;OAFgG;IAAA,CAAjG,CALA;WAWA,OAAO,CAAC,GAAR,CAAY,uCAAqC,KAArC,GAA2C,QAAvD,EAZG;EAAA,CADJ;CADD","file":"/server/startup/migrations/v010.coffee.js","sourcesContent":["RocketChat.Migrations.add\n\tversion: 10\n\tup: ->\n\t\t###\n\t\t# Remove duplicated usernames from rooms\n\t\t###\n\n\t\tcount = 0\n\t\tRocketChat.models.Rooms.find({'usernames.0': {$exists: true}}, {fields: {usernames: 1}}).forEach (room) ->\n\t\t\tnewUsernames = _.uniq room.usernames\n\t\t\tif newUsernames.length isnt room.usernames.length\n\t\t\t\tcount++\n\t\t\t\tRocketChat.models.Rooms.update {_id: room._id}, {$set: {usernames: newUsernames}}\n\n\t\tconsole.log \"Removed duplicated usernames from #{count} rooms\"\n"]}