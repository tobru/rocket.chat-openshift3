{"version":3,"sources":["meteor://ðŸ’»app/server/stream/messages.coffee"],"names":[],"mappings":";;;;;;;;;AAAA;;AAAA,IAAC,UAAD,GAAiB,UAAM,CAAC,QAAP,CAAgB,eAAhB,CAAjB;;AAAA,SAES,CAAC,UAAV,CAAqB,MAArB,CAFA;;AAAA,SAIS,CAAC,SAAV,CAAoB,SAAC,SAAD;AACnB;AAAA;AACC,QAAgB,OAAU,CAAC,IAAP,CAAY,eAAZ,EAA6B,SAA7B,EAAwC,IAAI,CAAC,MAA7C,CAApB;AAAA,aAAO,KAAP;KAAA;AAEA,WAAO,IAAP,CAHD;GAAA;AAKC,IADK,UACL;AAAA,WAAO,KAAP,CALD;GADmB;AAAA,CAApB,CAJA;;AAAA,SAYS,CAAC,SAAV,CAAoB,iBAApB,EAAuC,KAAvC,CAZA;;AAAA,SAcS,CAAC,SAAV,CAAoB,iBAApB,EAAuC,SAAC,SAAD,EAAY,GAAZ,EAAiB,OAAjB;AACtC;AAAA;AACC,WAAO,MAAM,CAAC,IAAP,CAAY,eAAZ,EAA6B,GAAG,CAAC,GAAjC,EAAsC,IAAI,CAAC,MAA3C,CAAP;AACA,QAAG,KAAH;AACC,aAAO,KAAP,CADD;KADA;AAAA,IAIA,OAAO,CAAC,eAAR,GAA0B,IAAI,CAAC,SAAS,CAAC,OAAf,CAAuB,IAAI,CAAC,QAA5B,IAAwC,EAJlE;AAAA,IAKA,OAAO,CAAC,QAAR,GAAmB,IAAI,CAAC,CALxB;AAOA,WAAO,IAAP,CARD;GAAA;AAUC,IADK,UACL;AAAA,WAAO,KAAP,CAVD;GADsC;AAAA,CAAvC,CAdA;;AAAA,MA4BM,CAAC,OAAP,CAAe;AACd;AAAA,WAAS,MAAT;AAEA,MAAG,WAAc,CAAC,QAAQ,CAAC,GAApB,CAAwB,0BAAxB,CAAP;AACC,aAAS;AAAA,MAAE,YAAY,CAAd;KAAT,CADD;GAFA;SAKA,UAAU,CAAC,MAAM,CAAC,QAAQ,CAAC,EAA3B,CAA8B,QAA9B,EAAwC;AACvC;AAAA,IADwC,qBAAM,4DAC9C;AAAA,cAAU,UAAU,CAAC,MAAM,CAAC,QAAQ,CAAC,iBAA3B,CAA6C,IAA7C,EAAmD,IAAK,GAAxD,EAA4D,MAA5D,CAAV;AAEA;SAAA;0BAAA;AACC,UAAG,MAAM,CAAC,OAAP,KAAoB,IAAvB;AACC,iBAAS,CAAC,IAAV,CAAe,iBAAf,EAAkC,MAAlC,EAA0C,EAA1C;AAAA,qBACA,SAAS,CAAC,IAAV,CAAe,MAAM,CAAC,GAAtB,EAA2B,MAA3B,EADA,CADD;OAAA;6BAAA;OADD;AAAA;mBAHuC;EAAA,CAAxC,EANc;AAAA,CAAf,CA5BA","file":"/server/stream/messages.coffee.js","sourcesContent":["@msgStream = new Meteor.Streamer 'room-messages'\n\nmsgStream.allowWrite('none')\n\nmsgStream.allowRead (eventName) ->\n\ttry\n\t\treturn false if not Meteor.call 'canAccessRoom', eventName, this.userId\n\n\t\treturn true\n\tcatch e\n\t\treturn false\n\nmsgStream.allowRead('__my_messages__', 'all')\n\nmsgStream.allowEmit '__my_messages__', (eventName, msg, options) ->\n\ttry\n\t\troom = Meteor.call 'canAccessRoom', msg.rid, this.userId\n\t\tif not room\n\t\t\treturn false\n\n\t\toptions.roomParticipant = room.usernames.indexOf(room.username) > -1\n\t\toptions.roomType = room.t\n\n\t\treturn true\n\tcatch e\n\t\treturn false\n\n\nMeteor.startup ->\n\tfields = undefined\n\n\tif not RocketChat.settings.get 'Message_ShowEditedStatus'\n\t\tfields = { 'editedAt': 0 }\n\n\tRocketChat.models.Messages.on 'change', (type, args...) ->\n\t\trecords = RocketChat.models.Messages.getChangedRecords type, args[0], fields\n\n\t\tfor record in records\n\t\t\tif record._hidden isnt true\n\t\t\t\tmsgStream.emit '__my_messages__', record, {}\n\t\t\t\tmsgStream.emit record.rid, record\n"]}